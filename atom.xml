<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Fox Home</title>
  
  <subtitle>清疚</subtitle>
  <link href="https://foolishfox.cn/atom.xml" rel="self"/>
  
  <link href="https://foolishfox.cn/"/>
  <updated>2025-02-21T03:32:09.000Z</updated>
  <id>https://foolishfox.cn/</id>
  
  <author>
    <name>Foolish Fox</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Geant4 综合模板</title>
    <link href="https://foolishfox.cn/posts/202502-g4template.html"/>
    <id>https://foolishfox.cn/posts/202502-g4template.html</id>
    <published>2025-02-21T03:32:09.000Z</published>
    <updated>2025-02-21T03:32:09.000Z</updated>
    
    <content type="html"><![CDATA[<p>几年前在 <a href="https://foolishfox.cn/posts/202204-g4b.html">Geant4 示例</a> 中我介绍了 Windows 下 Geant4 的安装与示例。今天分享一个 Geant4 综合模板，帮助快速开始一个项目，实现了以下功能：</p><ul><li>构建模块化的 TAS 探测器</li><li>统计模拟过程中的核反应信息，包括类型、反应道、产物能量分布、伽马射线母核统计等 (<a href="#1">1</a>, <a href="#2">2</a>)</li><li> 利用 Sensitive Detector 统计粒子在探测器中的沉积能量 (<a href="#3">3</a>)</li><li> 通过 Analysis Manager 保存数据到 ROOT 文件 (<a href="#4">4</a>, <a href="#5">5</a>)</li></ul><p>模板的核心功能时序图如下：</p><pre class="mermaid">sequenceDiagramautonumberpar    RunManager-&gt;&gt;RunStat: Initializationand    RunManager-&gt;&gt;AnalysisManager: InitializationendRunManager-&gt;&gt;+Run: Begin runrect rgb(200, 150, 255)Run-&gt;&gt;SD: Initializationendloop Number of particles    Run-&gt;&gt;+Event: Primary Generator    Event-&gt;&gt;+Step: Particle Transport    loop Particle alive        rect rgb(191, 223, 255)        alt Have secondary particles            Step--&gt;&gt;RunStat: Reaction information        else In SD            Step--&gt;&gt;SD: Step information        end        end        Step-&gt;&gt;Step: Particle Transport    end    Step-&gt;&gt;-Event: E = 0 or been absorbed    rect rgb(200, 150, 255)    SD--&gt;&gt;AnalysisManager: SD statistics    end    Event-&gt;&gt;-Run: End eventendAnalysisManager--&gt;&gt;Output: Data file (root format or others)Run-&gt;&gt;-RunManager: End runRunStat--&gt;&gt;Output: Reaction statistics</pre><style>.mermaid {    background: var(--heo-background) !important;}</style><script type="module">    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';</script><h2 id="主要功能">主要功能 <a class="header-anchor" href="#主要功能">¶</a></h2><h3 id="SD，Hits与Analysis-Manager">SD，Hits 与 Analysis Manager<a class="header-anchor" href="#SD，Hits与Analysis-Manager">¶</a></h3><p>Sensitive detector 和 Hits 是 Geant4 中的重要工具，用于统计粒子径迹在我们感兴趣的区域沉积的能量。在模板中，我们定义了一个 Sensitive detector: <code>TemplateSD</code>，用于划定感兴趣的区域；以及一个 Hits 类: <code>TemplateHit</code>，用于记录所需要的信息（例如沉积能量、粒子类别、名称等）。</p><p>由于不同人员的需求以及工具喜好不同，Geant4 并没有提供一个完备的数据分析工具，但是通过 <code>G4AnalysisManager</code> 实现了对于数据的管理。数据可以分为两类：<code>n-tuple</code> 和 <code>histogram</code>，前者类似于表格，行是每一个事件，列是各种物理信息；后者是对于某一物理量的统计，例如能量分布、角度分布等。<code>G4AnalysisManager</code> 类是<strong>线程安全</strong>的，并且可以自动合并多线程的数据。(<a href="#5">5</a>)</p><p><code>TemplateSD::ProcessHits</code> 函数将 <code>TemplateHit</code> 的信息收集到 <code>TemplateHitsCollection</code> 中，随后在 <code>EventAction::EndOfEventAction</code> 函数中读出，并且通过 <code>analysisManager</code>（<code>G4AnalysisManager</code> 类的实例）保存，最后在 <code>RunAction::EndOfRunAction</code> 中输出到 ROOT 文件中。</p><h3 id="核反应统计">核反应统计 <a class="header-anchor" href="#核反应统计">¶</a></h3><p>统计的过程完全发生在 <code>SteppingAction::UserSteppingAction</code> 方法中，并定义了 <code>RunStat</code> 类进行协助。<code>RunStat</code> 类的主要功能是记录核反应的信息（例如反应类型、反应道与 Q 值）以及核反应产物的信息（例如产物能量、数量，以及伽马射线的母核统计），这些信息在 <code>RunStat::print</code> 中输出到日志文件中，同时也保存在 <code>analysisManager</code> 中。</p><h2 id="示例">示例 <a class="header-anchor" href="#示例">¶</a></h2><h3 id="探测器构建">探测器构建 <a class="header-anchor" href="#探测器构建">¶</a></h3><ul><li> 靶<ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Φ</mi></mrow><annotation encoding="application/x-tex">\Phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">Φ</span></span></span></span> 15 mm</li><li> 样品: 100% <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mn>98</mn></msup><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">o</mi></mrow></mrow><annotation encoding="application/x-tex">^{98}\mathrm{Mo}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">9</span><span class="mord mtight">8</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathrm">M</span><span class="mord mathrm">o</span></span></span></span></span>, 1.5 um 绿色 (红色)</li><li> 衬底: Al, 5 um 绿色 (蓝色)</li></ul></li><li> 探测器<ul><li>Si: 10 mm <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">×</span></span></span></span> 10 mm <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">×</span></span></span></span> 3 mm (白色)</li><li>BGO: 100 mm <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">×</span></span></span></span> 100 mm <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">×</span></span></span></span> 200 mm, 六边形<ul><li>中心：束流孔 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Φ</mi></mrow><annotation encoding="application/x-tex">\Phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">Φ</span></span></span></span> 40 mm (黄色，1 个)</li><li> 外层 (灰色，总计 6 个)</li></ul></li></ul></li><li> 屏蔽<ul><li>PEEK: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Φ</mi></mrow><annotation encoding="application/x-tex">\Phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">Φ</span></span></span></span> 20 ~ 35 mm, 200 mm 长 (青色)</li><li>Pb: 50 mm 厚 (绿色)</li></ul></li></ul><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2025/02/21/67b841b177649.png" alt="探测器侧视图" style="height:300px;"></div><span class="image-caption">探测器侧视图</span></div><h3 id="核反应统计-v2">核反应统计 <a class="header-anchor" href="#核反应统计-v2">¶</a></h3><p>入射粒子为 13 MeV 的质子，反应主要以库伦散射为主，质子非弹主要以 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mn>98</mn></msup><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">o</mi></mrow></mrow><annotation encoding="application/x-tex">^{98}\mathrm{Mo}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">9</span><span class="mord mtight">8</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathrm">M</span><span class="mord mathrm">o</span></span></span></span></span> 的 (n,p) 反应为主，产物为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mn>98</mn></msup><mrow><mi mathvariant="normal">T</mi><mi mathvariant="normal">c</mi></mrow></mrow><annotation encoding="application/x-tex">^{98}\mathrm{Tc}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">9</span><span class="mord mtight">8</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathrm">T</span><span class="mord mathrm">c</span></span></span></span></span></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; Process calls frequency:</span><br><span class="line">         CoulombScat =     103207</span><br><span class="line">     Radioactivation =       2522</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; List of nuclear reactions: </span><br><span class="line">                         As75[264.658] --&gt; N gamma or e- + As75 / Radioactivation:       1   Q =      264.658 keV</span><br><span class="line">                         ...</span><br><span class="line">                                                   gamma --&gt; N gamma or e- / phot:  121754   Q =     -249.463 eV </span><br><span class="line">                                          gamma --&gt; gamma + N gamma or e- / compt:   46219   Q =            0 eV </span><br><span class="line">                                          ...</span><br><span class="line">               proton + Mo98 --&gt; N gamma or e- + neutron + Tc98 / protonInelastic:    5106   Q =     -3.47829 MeV</span><br><span class="line">               ...</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; List of generated particles:</span><br><span class="line">               As75 :        18  Emean =      9.91766 eV (  501.954 meV --&gt;  15.9164 eV )</span><br><span class="line">               ...</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; List of gamma parents:</span><br><span class="line">     0 :            Tc98 up</span><br><span class="line">     ...</span><br></pre></td></tr></tbody></table></figure><h3 id="伽马能谱与母核">伽马能谱与母核 <a class="header-anchor" href="#伽马能谱与母核">¶</a></h3><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2025/02/21/67b8434e12ba3.png" alt="Mo-98的伽马能谱（产物为Mo-98基态）" style="height:300px;"></div><span class="image-caption">Mo-98 的伽马能谱（产物为 Mo-98 基态）</span></div><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2025/02/21/67b8434e57835.png" alt="单块BGO伽马总能谱" style="height:300px;"></div><span class="image-caption">单块 BGO 伽马总能谱</span></div><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2025/02/21/67b8434edd9a6.png" alt="1.607~1.610 MeV伽马射线母核统计" style="height:300px;"></div><span class="image-caption">1.607~1.610 MeV 伽马射线母核统计</span></div><h2 id="跳转链接">跳转链接 <a class="header-anchor" href="#跳转链接">¶</a></h2><div class="flink"><div class="flink-list">      <div class="flink-list-item">        <a href="https://foolishfox.cn/posts/202204-g4b.html" title="Geant4 示例" target="_blank">          <div class="flink-item-icon">            <img class="no-lightbox" src="https://asset.foolishfox.cn/2023/07/22/64bb4e6fc0c4a.png" onerror="this.onerror=null;this.src=&quot;/img/friend_404.gif&quot;" alt="Geant4 示例">          </div>          <div class="flink-item-name">Geant4 示例</div>          <div class="flink-item-desc" title="Windows 下 Geant4 的安装与示例">Windows 下 Geant4 的安装与示例</div>        </a>      </div>      <div class="flink-list-item">        <a href="https://git.foolishfox.cn/fox/G4Template" title="G4Template" target="_blank">          <div class="flink-item-icon">            <img class="no-lightbox" src="https://asset.foolishfox.cn/2025/02/21/67b82e1c1a0d4.png" onerror="this.onerror=null;this.src=&quot;/img/friend_404.gif&quot;" alt="G4Template">          </div>          <div class="flink-item-name">G4Template</div>          <div class="flink-item-desc" title="Geant4 综合模板">Geant4 综合模板</div>        </a>      </div></div></div><h2 id="参考资料">参考资料 <a class="header-anchor" href="#参考资料">¶</a></h2><ol><li><span id="refer-1"><a href="https://geant4-userdoc.web.cern.ch/Doxygen/examples_doc/html/ExampleHadr03.html">Example Hadr03</a></span></li><li><span id="refer-2"><a href="https://geant4-forum.web.cern.ch/t/differences-with-physics-list-choice-in-hadr03-example/11492">Differences with physics list choice in Hadr03 example</a></span></li><li><span id="refer-3"><a href="https://geant4-userdoc.web.cern.ch/Doxygen/examples_doc/html/ExampleB2.html">Example B2</a></span></li><li><span id="refer-4"><a href="https://geant4-userdoc.web.cern.ch/Doxygen/examples_doc/html/ExampleB4.html">Example B4</a></span></li><li><span id="refer-5"><a href="https://indico.cern.ch/event/776050/contributions/3241822/attachments/1789267/2921102/Analysis-v3.pdf">ANALYSIS</a></span></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;几年前在 &lt;a href=&quot;https://foolishfox.cn/posts/202204-g4b.html&quot;&gt;Geant4 示例&lt;/a&gt; 中我介绍了 Windows 下 Geant4 的安装与示例。今天分享一个 Geant4 综合模板，帮助快速开始一个项目，实现了以</summary>
      
    
    
    
    <category term="软件/程序" scheme="https://foolishfox.cn/categories/%E8%BD%AF%E4%BB%B6-%E7%A8%8B%E5%BA%8F/"/>
    
    <category term="Geant4" scheme="https://foolishfox.cn/categories/%E8%BD%AF%E4%BB%B6-%E7%A8%8B%E5%BA%8F/Geant4/"/>
    
    
    <category term="核技术" scheme="https://foolishfox.cn/tags/%E6%A0%B8%E6%8A%80%E6%9C%AF/"/>
    
    <category term="Geant4" scheme="https://foolishfox.cn/tags/Geant4/"/>
    
    <category term="C/C++" scheme="https://foolishfox.cn/tags/C-C/"/>
    
  </entry>
  
  <entry>
    <title>阻止 Bing/Google 收录自建 Gitea 链接</title>
    <link href="https://foolishfox.cn/posts/202501-bing-gitea.html"/>
    <id>https://foolishfox.cn/posts/202501-bing-gitea.html</id>
    <published>2025-01-13T09:30:29.000Z</published>
    <updated>2025-01-13T09:30:29.000Z</updated>
    
    <content type="html"><![CDATA[<style>.imgdiv a {    width: 45%;}</style><p>最近去检查 Bing 和 Google 的网站收录情况，发现收录了一大堆自建的 Gitea 和 Memos 链接，这些链接不太希望直接发布在收索引擎中，而且变换比较快，参考意义不大，所以想阻止被收录。</p><div style="margin: 0 auto; display: flex; justify-content: space-around;" class="imgdiv"><img src="https://asset.foolishfox.cn/2025/01/15/67871e554f9bb.png"><img src="https://asset.foolishfox.cn/2025/01/15/67871e55bb515.png"></div><h2 id="临时删除">临时删除 <a class="header-anchor" href="#临时删除">¶</a></h2><p>如果只需要临时删除这些索引，Google 和 Bing 都提供了入口，不过需要每一定时间手动延期。</p><div style="margin: 0 auto; display: flex; justify-content: space-around;" class="imgdiv"><img src="https://asset.foolishfox.cn/2025/01/15/678722b971b6b.png" alt="Google 管理界面删除索引入口"><img src="https://asset.foolishfox.cn/2025/01/15/678722b9cc279.png" alt="Google 推荐选项"></div><div style="margin: 0 auto; display: flex; justify-content: space-around;" class="imgdiv"><img src="https://asset.foolishfox.cn/2025/01/15/6787231a133f0.png" alt="Bing 管理界面阻止索引入口"><img src="https://asset.foolishfox.cn/2025/01/15/6787231a415e8.png" alt="Bing 推荐选项"></div><h2 id="永久阻止">永久阻止 <a class="header-anchor" href="#永久阻止">¶</a></h2><p>对于使用 docker 部署的 Gitea，按照<a href="https://docs.gitea.com/installation/install-with-docker">官网的安装教程</a>挂载了卷，例如：</p><figure class="highlight yaml"><figcaption><span>docker-compose.yml</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">...</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.io/gitea/gitea:1.23.1</span></span><br><span class="line">    <span class="string">...</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./gitea:/data</span></span><br><span class="line">    <span class="string">...</span></span><br></pre></td></tr></tbody></table></figure><p>容器中的 <code>/data/gitea</code> 目录与宿主机的<code>./gitea/gitea</code> 目录对应，这个目录是用于存放自定义文件的，创建目录 <code>templates/custom</code>，在该目录下创建 <code>header.tmpl</code> 文件，并写入：</p><figure class="highlight html"><figcaption><span>header.tmpl</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"robots"</span> <span class="attr">content</span>=<span class="string">"noindex"</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>重启 Gitea 查看效果即可：</p><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2025/01/15/678721976e722.png" alt="image" style="height:200px;"></div></div><h2 id="搜索过程">搜索过程 <a class="header-anchor" href="#搜索过程">¶</a></h2><p>在 Google 和 Bing 的官方文档中都提到了不要使用 <code>robots.txt</code> 作为屏蔽机制，而推荐了三种方法：</p><ol><li>将 <code>noindex</code> 元标记添加到页面的 <code>&lt;head&gt;</code> 部分，安全性较低，还可能被收录</li><li>禁止访问（例如需要密码），但操作不现实，除非全部私有化仓库</li><li>移除网站，404 Not Found，更不可行</li></ol><p>所以下一步是查找怎么在 Gitea 中找到页面 <code>&lt;head&gt;</code> 部分并且修改。右键查看自建 Gitea 网页的源代码，找到已有的元标记，然后在 <a href="https://github.com/go-gitea/gitea">Gitea 的官方 Github 仓库</a>中搜索，找到包含这部分的文件，即 <code>templates/base/head.tmpl</code>。</p><div style="margin: 0 auto; display: flex; justify-content: space-around;" class="imgdiv"><img src="https://asset.foolishfox.cn/2025/01/15/6787249defcb0.png" alt="Gitea 页面源代码"><img src="https://asset.foolishfox.cn/2025/01/15/678724e4dcc19.png" alt="Github 仓库搜索结果"></div><p>在代码中包含了这样一段：</p><figure class="highlight html"><figcaption><span>templates/base/head.tmpl</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"{{ctx.Locale.Lang}}"</span> <span class="attr">data-theme</span>=<span class="string">"{{UserThemeName .SignedUser}}"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    {{template "base/head_opengraph" .}}</span><br><span class="line">    {{template "base/head_style" .}}</span><br><span class="line">    {{template "custom/header" .}}</span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>结合 Gitea 自定义模板的内容，在自定义目录下创建 <code>templates/custom</code>，并在其中创建 <code>header.tmpl</code> 文件，写入：</p><figure class="highlight html"><figcaption><span>header.tmpl</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"robots"</span> <span class="attr">content</span>=<span class="string">"noindex"</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>即可实现效果。</p><h2 id="参考资料">参考资料 <a class="header-anchor" href="#参考资料">¶</a></h2><ol><li><a href="https://docs.gitea.com/installation/install-with-docker">Installation with Docker</a></li><li><a href="https://support.google.com/webmasters/answer/9689846#block_content">“移除” 工具和 “安全搜索” 举报工具</a></li><li><a href="https://www.bing.com/webmasters/help/block-urls-from-bing-264e560a">Block URLs from Bing</a></li><li><a href="https://github.com/go-gitea/gitea/blob/main/templates/base/head.tmpl">templates/base/head.tmpl</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;style&gt;
.imgdiv a {
    width: 45%;
}
&lt;/style&gt;
&lt;p&gt;最近去检查 Bing 和 Google 的网站收录情况，发现收录了一大堆自建的 Gitea 和 Memos 链接，这些链接不太希望直接发布在收索引擎中，而且变换比较快，参考意义不大</summary>
      
    
    
    
    <category term="软件/程序" scheme="https://foolishfox.cn/categories/%E8%BD%AF%E4%BB%B6-%E7%A8%8B%E5%BA%8F/"/>
    
    <category term="工具" scheme="https://foolishfox.cn/categories/%E8%BD%AF%E4%BB%B6-%E7%A8%8B%E5%BA%8F/%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="网站收录" scheme="https://foolishfox.cn/tags/%E7%BD%91%E7%AB%99%E6%94%B6%E5%BD%95/"/>
    
    <category term="bing" scheme="https://foolishfox.cn/tags/bing/"/>
    
    <category term="google" scheme="https://foolishfox.cn/tags/google/"/>
    
    <category term="gitea" scheme="https://foolishfox.cn/tags/gitea/"/>
    
  </entry>
  
  <entry>
    <title>在 zsh 中自动补全命令参数</title>
    <link href="https://foolishfox.cn/posts/202501-zsh-comp.html"/>
    <id>https://foolishfox.cn/posts/202501-zsh-comp.html</id>
    <published>2025-01-06T06:48:41.000Z</published>
    <updated>2025-01-06T06:48:41.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/skywind3000/z.lua">z.lua</a> 是一个很好的工具，可以快速地进入想要的目录。我在本机 WSL 和多个服务器上都安装了这个程序，但是在执行一些命令（例如 <code>z -c</code>，在当前目录下的子目录中选择）的时候，自动补全有时候可以用，有时候不能用，很不方便。所以我决定自己写一个 <code>zsh</code> 的自动补全脚本。</p><h2 id="实现">实现 <a class="header-anchor" href="#实现">¶</a></h2><p>首先，通过 <code>which z</code> 命令拿到实际的命令执行函数：</p><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2025/01/06/677ba7f259a48.png" alt="image" style="height:100px;"></div></div><p>在 <code>z.lua</code> 脚本中给出了如何对 <code>z</code> 命令进行补全的方法：</p><figure class="highlight zsh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">_zlua_zsh_tab_completion</span></span>() {</span><br><span class="line"><span class="comment"># tab completion</span></span><br><span class="line">(( $+compstate )) &amp;&amp; compstate[insert]=menu <span class="comment"># no expand</span></span><br><span class="line"><span class="built_in">local</span> -a tmp=(<span class="variable">${(f)"$(_zlua --complete "<span class="variable">${words/_zlua/z}</span>")"}</span>)</span><br><span class="line">_describe <span class="string">"directory"</span> tmp -U</span><br><span class="line">}</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">${+functions[compdef]}</span>"</span> -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">compdef _zlua_zsh_tab_completion _zlua 2&gt; /dev/null</span><br><span class="line">compdef <span class="variable">${_ZL_CMD:-z}</span>=_zlua</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></tbody></table></figure><p>其中：</p><ul><li><code>_zlua_zsh_tab_completion</code> 是自动补全函数；</li><li><code>${(f)"$(_zlua --complete "${words/_zlua/z}")"}</code> 是获取补全的内容，并且按照每行分割转化为数组；</li><li><code>_describe</code> 是定义补全的内容，第一个参数是描述，第二个参数是补全的内容；</li><li><code>compdef</code> 是定义自动补全函数，第一个参数是自动补全函数，第二个参数是实际的命令执行函数。</li></ul><p>参照上面的内容写了一个自动补全脚本：</p><figure class="highlight zsh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">_z_comp</span></span>() {</span><br><span class="line">    <span class="built_in">local</span> -a list=(<span class="variable">${(f)"$(_zlua --complete "<span class="variable">${words/_zlua/z}</span>")"}</span>)</span><br><span class="line">    _describe <span class="string">"directory"</span> list -U</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="title">_zc_comp</span></span>() {</span><br><span class="line">    <span class="built_in">local</span> -a list=(<span class="string">"<span class="variable">${(@f)$(fdfind -t d -d 1 .)}</span>"</span>)</span><br><span class="line">    <span class="keyword">for</span> ((i=<span class="number">1</span>;i&lt;=<span class="variable">$#list</span>;i++)){</span><br><span class="line">        list[i]=<span class="variable">${list[i]/\//}</span></span><br><span class="line">    }</span><br><span class="line">    _describe <span class="string">"subdirectory"</span> list -U</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="title">_zlua_comp</span></span>() {</span><br><span class="line">    _arguments -C -S -s \</span><br><span class="line">        <span class="string">'*:enter directory order by frecent:_z_comp'</span>  \</span><br><span class="line">        <span class="string">'-c:enter subdirectory:_zc_comp'</span></span><br><span class="line">}</span><br><span class="line">compdef _zlua_comp _zlua &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">compdef <span class="variable">${_ZL_CMD:-z}</span>=_zlua</span><br></pre></td></tr></tbody></table></figure><p>首先定义了两个补全函数 <code>_z_comp</code> 和 <code>_zc_comp</code>，分别对应 <code>z</code> 和 <code>z -c</code> 命令的补全内容。然后定义了一个 <code>_zlua_comp</code> 函数，通过 <code>_arguments</code> 定义了命令的参数和补全内容。最后通过 <code>compdef</code> 定义了自动补全函数。需要注意的是，<code>_zc_comp</code> 函数中得到的子目录是带有 <code>/</code> 的，所以需要去掉 <code>/</code>，否则可能会进入到所选择子目录下的深度更深的目录：</p><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2025/01/07/677bff470f203.png" alt="image" style="height:100px;"></div></div><p>最后在脚本末尾加入：</p><figure class="highlight zsh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">autoload</span> -Uz compinit &amp;&amp; compinit</span><br></pre></td></tr></tbody></table></figure><p>这样就可以实现自动补全：</p><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2025/01/07/677c022581eb5.gif" alt="image" style="height:150px;"></div></div><h2 id="FZF">FZF<a class="header-anchor" href="#FZF">¶</a></h2><p>如果想要使用 <code>fzf</code>，同样可以参考 <code>z.lua</code> 中的 <code>script_fzf_complete_zsh</code> 脚本，一个示例如下：</p><figure class="highlight zsh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bindkey</span> <span class="string">'\e[0n'</span> kill-whole-line</span><br><span class="line"><span class="function"><span class="title">_z_comp</span></span>() {</span><br><span class="line">    <span class="built_in">local</span> list=$(_zlua -l <span class="variable">${words[2,-1]}</span>)</span><br><span class="line">    <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$list</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">local</span> selected=$(<span class="built_in">print</span> <span class="variable">$list</span> | <span class="variable">${=zlua_fzf}</span> | sed <span class="string">'s/^[0-9,.]* *//'</span>)</span><br><span class="line">        <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$selected</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">cd</span> <span class="variable">${selected}</span></span><br><span class="line">            <span class="built_in">printf</span> <span class="string">'\e[5n'</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="title">_zc_comp</span></span>() {</span><br><span class="line">    <span class="built_in">local</span> -a list=(<span class="string">"<span class="variable">${(@f)$(fdfind -t d -d 1 .)}</span>"</span>)</span><br><span class="line">    <span class="keyword">for</span> ((i=<span class="number">1</span>;i&lt;=<span class="variable">$#list</span>;i++)){</span><br><span class="line">        list[i]=<span class="variable">${list[i]/\//}</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$list</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">local</span> selected=$(<span class="built_in">print</span> <span class="variable">$list</span> | awk -F <span class="string">" "</span> <span class="string">'{for(row=1;row&lt;=NF;row++) print $row;}'</span> | <span class="variable">${=zlua_fzf}</span>)</span><br><span class="line">        <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$selected</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">cd</span> <span class="variable">${selected}</span></span><br><span class="line">            <span class="built_in">printf</span> <span class="string">'\e[5n'</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="title">_zlua_comp</span></span>() {</span><br><span class="line">    _arguments -C -S -s \</span><br><span class="line">        <span class="string">'*:enter directory order by frecent:_z_comp'</span>  \</span><br><span class="line">        <span class="string">'-c:enter subdirectory:_zc_comp'</span></span><br><span class="line">}</span><br><span class="line">compdef _zlua_comp _zlua &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">compdef <span class="variable">${_ZL_CMD:-z}</span>=_zlua</span><br></pre></td></tr></tbody></table></figure><h2 id="参考资料">参考资料 <a class="header-anchor" href="#参考资料">¶</a></h2><ol><li><a href="https://zsh.sourceforge.io/Doc/Release/Completion-System.html">Completion System</a></li><li><a href="https://zhuanlan.zhihu.com/p/466684661">给 zsh 自定义命令添加参数自动补全</a></li><li><a href="https://www.cnblogs.com/wang_yb/p/5969451.html">命令行自动补全原理</a></li><li><a href="https://thevaluable.dev/zsh-completion-guide-examples/">A Guide to the Zsh Completion with Examples</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://github.com/skywind3000/z.lua&quot;&gt;z.lua&lt;/a&gt; 是一个很好的工具，可以快速地进入想要的目录。我在本机 WSL 和多个服务器上都安装了这个程序，但是在执行一些命令（例如 &lt;code&gt;z -c&lt;/code&gt;，在当</summary>
      
    
    
    
    <category term="软件/程序" scheme="https://foolishfox.cn/categories/%E8%BD%AF%E4%BB%B6-%E7%A8%8B%E5%BA%8F/"/>
    
    <category term="工具" scheme="https://foolishfox.cn/categories/%E8%BD%AF%E4%BB%B6-%E7%A8%8B%E5%BA%8F/%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="zsh" scheme="https://foolishfox.cn/tags/zsh/"/>
    
    <category term="shell" scheme="https://foolishfox.cn/tags/shell/"/>
    
    <category term="linux" scheme="https://foolishfox.cn/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>博客成长日志 | 又一次服务器迁移</title>
    <link href="https://foolishfox.cn/posts/202411-migrate-24.html"/>
    <id>https://foolishfox.cn/posts/202411-migrate-24.html</id>
    <published>2024-11-06T13:10:44.000Z</published>
    <updated>2024-11-06T13:10:44.000Z</updated>
    
    <content type="html"><![CDATA[<p>之前本站一直使用的腾讯云轻量应用服务器服务器一次性买了 3 年，这个月月底就要到期了，但是一看续费的价格，十分的美丽。其实服务器的 4 个核心一直负载都不大，但是内存使用经常在 3G 作用，因此综合考虑下决定入手一个 2H4G 的服务器，再通过自定义镜像迁移过去。</p><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/11/06/672b719af0074.png" alt="图1 同配置续费3年的价格" style="height:200px;"></div><span class="image-caption">图 1 同配置续费 3 年的价格</span></div><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/11/06/672b7221cd570.png" alt="图2 双十一活动新购服务器" style="height:200px;"></div><span class="image-caption">图 2 双十一活动新购服务器</span></div><p>但是正当我购置好了服务器，正打算用自定义镜像重装系统的时候，请注意图中两个服务器的硬盘大小，旧的服务器硬盘是 80 GB，虽然我只使用了 40+ GB，但是导出的镜像是完整的 80 GB，而新的服务器硬盘只有 70 GB😒😒😒。</p><p>于是只好手动把所有的内容同步到新的服务器上去了，幸好基本大部分的数据都在 home 目录下，同时万分感谢自己在从阿里云迁移到腾讯云的时候将所有的服务都使用 Docker 进行了容器化，所以一行命令迁移：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r <span class="variable">$HOME</span>/docker user@IP:/home/user</span><br></pre></td></tr></tbody></table></figure><p>然后在新服务器上安装 Docker，启动所有的容器就解决了大部分的工作，仅剩的是一些 Docker 的配置文件，也使用 scp 复制过去就行，两台服务器都在同一个区域，直接使用内网 IP 的传输速度还是挺快的，哪怕有很多的小文件。</p><p>so，that’s all，新的服务器已经<s>（看上去）</s>正常运行。如果算上一次同价续费和拼团赠送的 3 个月有效期，这次又能苟 2 年多，希望不要有什么问题。</p><p>PS：腾讯云最近开放了 IPv6 的测试申请，已经通过了，后面捣鼓一下看看有啥用处。下一期讲一下在 Portainer 里面 TLS 连接远程的 Docker 服务。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;之前本站一直使用的腾讯云轻量应用服务器服务器一次性买了 3 年，这个月月底就要到期了，但是一看续费的价格，十分的美丽。其实服务器的 4 个核心一直负载都不大，但是内存使用经常在 3G 作用，因此综合考虑下决定入手一个 2H4G 的服务器，再通过自定义镜像迁移过去。&lt;/p&gt;
</summary>
      
    
    
    
    <category term="软件/程序" scheme="https://foolishfox.cn/categories/%E8%BD%AF%E4%BB%B6-%E7%A8%8B%E5%BA%8F/"/>
    
    <category term="博客成长日志" scheme="https://foolishfox.cn/categories/%E8%BD%AF%E4%BB%B6-%E7%A8%8B%E5%BA%8F/%E5%8D%9A%E5%AE%A2%E6%88%90%E9%95%BF%E6%97%A5%E5%BF%97/"/>
    
    
    <category term="服务器" scheme="https://foolishfox.cn/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    <category term="Docker" scheme="https://foolishfox.cn/tags/Docker/"/>
    
    <category term="腾讯云" scheme="https://foolishfox.cn/tags/%E8%85%BE%E8%AE%AF%E4%BA%91/"/>
    
  </entry>
  
  <entry>
    <title>独立博客自省问卷 15 题 - 2024</title>
    <link href="https://foolishfox.cn/posts/202410-refle-24.html"/>
    <id>https://foolishfox.cn/posts/202410-refle-24.html</id>
    <published>2024-10-17T11:29:40.000Z</published>
    <updated>2024-10-17T11:29:40.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>以下问卷纯粹自省自娱，自我调侃，勿对号入座。<br>如有不适，请及时关闭浏览器窗口。<br>如有启发，建议每隔一段时间服用一次。<br>From <a href="https://yayu.net/4626.html">独立博客自省问卷 15 题</a></p></blockquote><ol><li>你的博客更新频率是多少？<br>A. 每周更新<br>B. 一周数篇<br>C. 一月 1-2 篇<br>✅ D. 几个月一篇</li></ol><blockquote><p>一直很想写，但是懒…… 发 <a href="https://foolishfox.cn/memos/">Memos</a> 更多了。</p></blockquote><ol start="2"><li>你的博客上次更新是什么时候？<br>A. 本周<br>B. 上周<br>C. 上个月<br>✅ D. 上季度</li></ol><blockquote><p>现在手上还有两三个内容等着写，咕咕咕（<s>这不又水了一篇</s></p></blockquote><ol start="3"><li>你的博客文章是原创的吗？<br>✅ A. 坚持原创<br>B. 部分借鉴<br><a href="http://C.AI">C.AI</a> 帮我写的<br>D. 搬运别人的，而且不署名</li></ol><blockquote><p>坚决抵制<s>学术</s>博客不端，内容原创，参考留名</p></blockquote><ol start="4"><li>你觉得自己的文章对他人有帮助吗？<br>A. 旨在对他人有启示<br>✅ B. 多少有点意义<br>C. 每日每周流水账<br>✅ D. 自我陶醉就好，管他呢</li></ol><blockquote><p>自己以后用得上也是意义</p></blockquote><ol start="5"><li>你上次换博客主题 / 程序是什么时候？<br>A. 上周<br>B. 上个月<br>✅ C. 去年<br>D. 凭良心说，我多年都是一个主题</li></ol><blockquote><p>从 <a href="https://github.com/liuyib/hexo-theme-stun">stun</a> 迁移过来的，主要像侧边栏 <code>widget</code> 之类的自己写太麻烦，最终找了个现成的</p></blockquote><ol start="6"><li>你上一次捣腾博客主题代码是什么时候？<br>A. 昨天，撸代码到凌晨<br>B. 每周必捣腾<br>C. 每月有那么一次<br>✅ D. 一年有那么一次</li></ol><blockquote><p>个人博客的意义在于记录与折腾</p></blockquote><ol start="7"><li>你会对博客主题进行二次开发？<br>A. 直接配置使用，省心不折腾<br>✅ B. 时不时自己改改，搞点新花样，换图片，换字体，爽<br>C. 删除主题作者版权信息，改改样式，然后自我感觉良好<br>D. 改得面目全非，但保留原作者版权信息或注明</li></ol><blockquote><p>同上，有些功能也得自己加，例如首页的 <code>Memos</code> 轮播</p></blockquote><ol start="8"><li>你多久打开自己博客自我陶醉一次？<br>A. 每天数次<br>✅ B. 每周一次<br>C. 看心情<br>D. 一般都是照镜子，不看博客</li></ol><blockquote><p>因为有 <a href="https://foolishfox.cn/link/moments">Moments 朋友圈</a>的存在，每周都会打开看看博友们发了什么新文章</p></blockquote><ol start="9"><li>你近期对自己博客域名什么感受？<br>A. 想搞到一个 .COM 的域名<br>✅ B. 如果域名能再短几个字符就更好了<br>C. 今年才换双拼域名了，明年再看看<br>D. 目前挺好，没想法</li></ol><blockquote><p>现在域名虽然好记，但是确实有点太长了，但是又没有什么缩短的方向，<code>ff.cn</code>？还是 <code>ff.sh.cn</code> 或者 <code>ffox</code> 之类的</p></blockquote><ol start="10"><li>你每天都会看网站的流量统计吗？<br>A. 每天看几次，今天又多了 100PV<br>✅ B. 每周回顾，看看流量趋势<br>C. 记得就看看<br>D. 没有搞流量统计，都是浮云</li></ol><blockquote><p>虽然没什么人，但是自建了 <a href="https://umami.foolishfox.cn/dashboard">Umami</a> 和<a href="https://foolishfox.cn/statistics/">统计</a>，并且每天会自动给我发送报告</p></blockquote><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/10/17/6710f7bc2a765.png" alt="通过<a href=https://sct.ftqq.com/>Server酱</a>发送每日报告"></div><span class="image-caption">通过 <a href="https://sct.ftqq.com/">Server 酱</a>发送每日报告</span></div><ol start="11"><li>你通过博客的广告赚到钱了吗？<br>A. 有，能覆盖建站费用<br>B. 有，但付出大于收入<br>C. 没考虑通过博客流量赚钱<br>✅ D. 拒绝广告，保证阅读体验</li></ol><blockquote><p><s>主要是接不到广告</s></p></blockquote><ol start="12"><li>你去浏览别人的博客 / 网站主要为什么？<br>✅ A. 学习别人分享的知识<br>B. 搬运别人的内容<br>✅ C. 看看别人怎么装修博客，自己也抄一下，感觉都比自己的好<br>D. 不爱看别人博客，自己爱写啥写啥</li></ol><blockquote><p>两者大概三比一吧</p></blockquote><ol start="13"><li>看到别人分享了一篇文章，你打开第一反应是什么？<br>A. 哇，这域名真不错，怎么我没想到<br>B. 哇，这网站速度真快，图片延迟加载丝滑<br>✅ C. 哇，这程序 / 主题不错，我也要抄一抄 / 留言问问哪里搞的<br>✅ D. 看看文章内容</li></ol><blockquote><p>首看内容，然后跑偏……</p></blockquote><ol start="14"><li>你觉得博客哪方面更重要？<br>A. 域名<br>✅ B. 服务器<br>C. 主题<br>✅ D. 内容</li></ol><blockquote><p>首重内容，但是也要能打开😂</p></blockquote><ol start="15"><li>近期通过写博客有哪些新收获？<br>✅ A. 知识面有拓展<br>✅ B. 认识了新朋友<br>✅ C. 写作水平提升<br>D. 通过知识变现</li></ol><blockquote><p>就是主打一个与 Money 无缘</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;以下问卷纯粹自省自娱，自我调侃，勿对号入座。&lt;br&gt;
如有不适，请及时关闭浏览器窗口。&lt;br&gt;
如有启发，建议每隔一段时间服用一次。&lt;br&gt;
From &lt;a href=&quot;https://yayu.net/4626.html&quot;&gt;独立博客自省问卷 15</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>使用油猴脚本优化期刊阅读体验</title>
    <link href="https://foolishfox.cn/posts/202408-journalviewer.html"/>
    <id>https://foolishfox.cn/posts/202408-journalviewer.html</id>
    <published>2024-08-16T04:51:03.000Z</published>
    <updated>2024-08-16T05:46:02.000Z</updated>
    
    <content type="html"><![CDATA[<div class="note info flat"><p>安装浏览器油猴（TemperMonkey）拓展请参考：</p><ol><li><a href="https://zhuanlan.zhihu.com/p/494577326">全网最完整 Tampermonkey 油猴脚本管理器安装教程</a></li><li><a href="https://zhuanlan.zhihu.com/p/128453110">Tampermonkey 油猴插件 —— 安装与使用教程</a></li></ol></div><div class="note danger flat"><p>使用油猴脚本请谨慎辨别安全性，使用前仔细阅读脚本的说明文档。<br>完整代码可以通过 Greasy Fork 获得：<a href="https://greasyfork.org/zh-CN/scripts/503800-journal-viewer">Journal Viewer</a></p></div><p>在 PC 网页端在线阅读一些期刊时，往往会有一些侧边栏占据了很大的空间，极其影响阅读体验。但是通过查看网页元素，可以发现这些侧边栏存在很明显的特征，我们可以通过 JavaScript 代码来获取这些元素并删除，同时调整正文的样式，获取更好的阅读体验。</p><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/08/16/66bede05abd77.png" alt="图1 APS 原始界面" style="height:200px;"></div><span class="image-caption">图 1 APS 原始界面</span></div><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/08/16/66bede0640b52.png" alt="图2 Science Direct 原始界面" style="height:200px;"></div><span class="image-caption">图 2 Science Direct 原始界面</span></div><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/08/16/66bede06be1d5.png" alt="图3 Nature 原始界面" style="height:200px;"></div><span class="image-caption">图 3 Nature 原始界面</span></div><p>对于 APS 旗下的期刊，可以使用以下代码：</p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> aps_sidebar = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"article-sidebar"</span>);</span><br><span class="line">aps_sidebar.<span class="title function_">remove</span>();</span><br><span class="line"><span class="keyword">let</span> aps_content = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"article-content"</span>);</span><br><span class="line">aps_content.<span class="property">style</span>.<span class="property">width</span> = <span class="string">"100%"</span>;</span><br></pre></td></tr></tbody></table></figure><p>效果如下图所示。</p><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/08/16/66bedf9396a9a.png" alt="图4 APS 优化后界面" style="height:200px;"></div><span class="image-caption">图 4 APS 优化后界面</span></div><p>同理可以优化其他期刊。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;note info flat&quot;&gt;&lt;p&gt;安装浏览器油猴（TemperMonkey）拓展请参考：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/494577326&quot;&gt;全网最完整 Tampermonkey </summary>
      
    
    
    
    <category term="软件/程序" scheme="https://foolishfox.cn/categories/%E8%BD%AF%E4%BB%B6-%E7%A8%8B%E5%BA%8F/"/>
    
    <category term="工具" scheme="https://foolishfox.cn/categories/%E8%BD%AF%E4%BB%B6-%E7%A8%8B%E5%BA%8F/%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="TemperMonkey" scheme="https://foolishfox.cn/tags/TemperMonkey/"/>
    
    <category term="油猴" scheme="https://foolishfox.cn/tags/%E6%B2%B9%E7%8C%B4/"/>
    
    <category term="脚本" scheme="https://foolishfox.cn/tags/%E8%84%9A%E6%9C%AC/"/>
    
    <category term="文献" scheme="https://foolishfox.cn/tags/%E6%96%87%E7%8C%AE/"/>
    
    <category term="期刊" scheme="https://foolishfox.cn/tags/%E6%9C%9F%E5%88%8A/"/>
    
  </entry>
  
  <entry>
    <title>使君与府君，到底该怎么喊？</title>
    <link href="https://foolishfox.cn/posts/202407-nameresearch.html"/>
    <id>https://foolishfox.cn/posts/202407-nameresearch.html</id>
    <published>2024-07-04T07:51:10.000Z</published>
    <updated>2024-07-05T07:35:43.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言">前言 <a class="header-anchor" href="#前言">¶</a></h2><p>三国演义中有一段经典剧情青梅煮酒论英雄，说献帝的舅舅董承与刘备暗中结盟欲除去曹操，刘备怕曹操生疑，因此每日浇水种豆。曹操听说后请刘备饮酒，议论天下英雄：</p><blockquote><p>  随至小亭，已设樽俎：盘置青梅，一樽煮酒。二人对坐，开怀畅饮。酒至半酣，忽阴云漠漠，骤雨将至。从人遥指天外龙挂，操与玄德凭栏观之。操曰：“使君知龙之变化否？” 玄德曰：“未知其详。” 操曰：“龙能大能小，能升能隐；大则兴云吐雾，小则隐介藏形；升则飞腾于宇宙之间，隐则潜伏于波涛之内。方今春深，龙乘时变化，犹人得志而纵横四海。龙之为物，可比世之英雄。玄德久历四方，必知当世英雄。请试指言之。” 玄德曰：“备肉眼安识英雄？” 操曰：“休得过谦。” 玄德曰：“备叨恩庇，得仕于朝。天下英雄，实有未知。” 操曰：“既不识其面，亦闻其名。” 玄德曰：“淮南袁术，兵粮足备，可为英雄？” 操笑曰：“冢中枯骨，吾早晚必擒之！” 玄德曰：“河北袁绍，四世三公，门多故吏；今虎踞冀州之地，部下能事者极多，可为英雄？“操笑曰：“袁绍色厉胆薄，好谋无断；干大事而惜身，见小利而忘命：非英雄也。玄德曰：“有一人名称七俊，威镇九州：刘景升可为英雄？” 操曰：“刘表虚名无实，非英雄也。” 玄德曰：“有一人血气方刚，江东领袖 —— 孙伯符乃英雄也？” 操曰：“孙策藉父之名，非英雄也。” 玄德曰：“益州刘季玉，可为英雄乎？” 操曰：“刘璋虽系宗室，乃守户之犬耳，何足为英雄！” 玄德曰：“如张绣、张鲁、韩遂等辈皆何如？” 操鼓掌大笑曰：“此等碌碌小人，何足挂齿！” 玄德曰：“舍此之外，备实不知。” 操曰：“夫英雄者，胸怀大志，腹有良谋，有包藏宇宙之机，吞吐天地之志者也。” 玄德曰：“谁能当之？” 操以手指玄德，后自指，曰：“今天下英雄，惟使君与操耳！” 玄德闻言，吃了一惊，手中所执匙箸，不觉落于地下。时正值天雨将至，雷声大作。玄德乃从容俯首拾箸曰：“一震之威，乃至于此。” 操曰：“丈夫亦畏雷乎？” 玄德曰：“圣人迅雷风烈必变，安得不畏？” 将闻言失箸缘故，轻轻掩饰过了。操遂不疑玄德。</p></blockquote><p>这一段内容在《三国志・蜀志二・先主传》中也有记载 <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>：</p><blockquote><p>  先主未出时，献帝舅车骑将军董承<sub>臣松之按：董承，汉灵帝母董太后之侄，于献帝为丈人。盖古无丈人之名，故谓之舅也。</sub>辞受帝衣带中密诏，当诛曹公。先主未发。是时曹公从容谓先主曰：「今天下英雄，惟<strong>使君</strong>与操耳。本初之徒，不足数也。」</p></blockquote><p>前段时间看小说的时候，和人讨论了这么一个问题，因此去查找了《后汉书》和《三国志》中的原文看看是什么情况，顺带也查看了一下《汉书》中的用法。</p><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/07/04/668657dbe7ee4.jpg" alt="image" style="height:200px;"></div></div><h2 id="使君">使君 <a class="header-anchor" href="#使君">¶</a></h2><p>使君可以理解为身负使命的官员，特别是代表皇帝出使或者巡视地方的官员。元封五年（公元前 107 年），汉武帝将天下划分为 13 州，每州各派刺史一人监察所属州的郡国官员 <sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>。在众多地方官员中，刺史身负皇命，直接向皇帝负责，因此被称为使君，此外监察北军的北军中候，领护西羌的护羌校尉等被皇帝授予特殊使命的官员也被称为使君。</p><p>使君最早出现在汉书中是在《汉书・卷六十六》。武帝末年，各地郡县盗贼群起，武帝任命暴胜之为直指使者，穿著绣衣，持御赐上方斧，故称为绣衣御史。暴胜之巡查各地，追捕盗贼诛杀两千石以下不听从命令的官吏。当暴胜之来到被阳时想要诛杀时任被阳县令王欣，而王欣已经解开衣服趴在案上，跟暴胜之说：“使君手握生杀的权利，已经威震郡国，今天再把我杀了，不足以增添您的权威。不如根据情况有所宽大，表明您的仁义，我愿意以后尽全力报答”。颜师古在此处作注称，暴胜之是皇帝的使者，故称为使君。<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup> 汉书中还有一处称呼使君的地方，出自《汉书・卷七十二》。王莽掌权后，故渤海太守、光禄大夫龚胜辞官回乡。等到王莽篡国，王莽多次派遣五威将帅、使者慰问龚胜，并征召龚胜担任太子师友祭酒，龚胜屡次拒绝，最终绝食而死。<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup></p><p>《后汉书》、《三国志》中有关使君的记载统计如下：</p><ul><li>《后汉书・卷四十六》护羌校尉邓训 <sup class="footnote-ref"><a href="#fn5" id="fnref5">[5]</a></sup></li><li>《后汉书・卷四十六》更始帝使者 <sup class="footnote-ref"><a href="#fn6" id="fnref6">[6]</a></sup></li><li>《后汉书・卷六十一》并州牧郭伋 <sup class="footnote-ref"><a href="#fn7" id="fnref7">[7]</a></sup></li><li>《后汉书・卷七十一》兖州刺史第五种 <sup class="footnote-ref"><a href="#fn8" id="fnref8">[8]</a></sup></li><li>《后汉书・卷八十二》司隶校尉陈禅 <sup class="footnote-ref"><a href="#fn9" id="fnref9">[9]</a></sup></li><li>《后汉书・卷八十八》凉州刺史耿鄙 <sup class="footnote-ref"><a href="#fn10" id="fnref10">[10]</a></sup></li><li>《后汉书・卷八十八》凉州刺史梁鹄 <sup class="footnote-ref"><a href="#fn11" id="fnref11">[11]</a></sup></li><li>《后汉书・卷八十八》凉州刺史左昌 <sup class="footnote-ref"><a href="#fn12" id="fnref12">[12]</a></sup></li><li>《后汉书・卷一百》兖州牧曹操 <sup class="footnote-ref"><a href="#fn13" id="fnref13">[13]</a></sup></li><li>《后汉书・卷一百四》荆州刺史刘表 <sup class="footnote-ref"><a href="#fn14" id="fnref14">[14]</a></sup></li><li>《后汉书・卷一百五》扬州牧袁术 <sup class="footnote-ref"><a href="#fn15" id="fnref15">[15]</a></sup></li><li>《后汉书・卷一百十三》冀州刺史 <sup class="footnote-ref"><a href="#fn16" id="fnref16">[16]</a></sup></li><li>《后汉书・卷一百十七》中郎将任尚 <sup class="footnote-ref"><a href="#fn17" id="fnref17">[17]</a></sup></li><li>《三国志・魏志八》引韦曜《吴书》徐州牧陶谦 <sup class="footnote-ref"><a href="#fn18" id="fnref18">[18]</a></sup></li><li>《三国志・魏志十》兖州牧曹操 <sup class="footnote-ref"><a href="#fn19" id="fnref19">[19]</a></sup></li><li>《三国志・魏志十一》青州牧袁谭 <sup class="footnote-ref"><a href="#fn20" id="fnref20">[20]</a></sup></li><li>《三国志・魏志十四》兖州牧曹操 <sup class="footnote-ref"><a href="#fn21" id="fnref21">[21]</a></sup></li><li>《三国志・魏志二十三》引傅畅《晋诸公赞》代指上司 <sup class="footnote-ref"><a href="#fn22" id="fnref22">[22]</a></sup></li><li>《三国志・魏志二十四》幽州刺史崔林 <sup class="footnote-ref"><a href="#fn23" id="fnref23">[23]</a></sup></li><li>《三国志・魏志二十五》引皇甫谧《列女传》凉州刺史韦康 <sup class="footnote-ref"><a href="#fn24" id="fnref24">[24]</a></sup></li><li>《三国志・魏志二十八》引《魏略》兖州刺史令狐愚 <sup class="footnote-ref"><a href="#fn25" id="fnref25">[25]</a></sup><sup class="footnote-ref"><a href="#fn26" id="fnref26">[26]</a></sup></li><li>《三国志・魏志二十九》冀州刺史裴徽 <sup class="footnote-ref"><a href="#fn27" id="fnref27">[27]</a></sup></li><li>《三国志・魏志三十》辅国将军鲜于辅 <sup class="footnote-ref"><a href="#fn28" id="fnref28">[28]</a></sup></li><li>《三国志・蜀志一》益州牧刘璋 <sup class="footnote-ref"><a href="#fn29" id="fnref29">[29]</a></sup></li><li>《三国志・蜀志二》豫州刺史刘备 <sup class="footnote-ref"><a href="#fn30" id="fnref30">[30]</a></sup></li><li>《三国志・蜀志二》左将军、豫州牧刘备 <sup class="footnote-ref"><a href="#fn1" id="fnref1:1">[1:1]</a></sup></li><li>《三国志・蜀志二》益州牧刘璋 <sup class="footnote-ref"><a href="#fn31" id="fnref31">[31]</a></sup></li><li>《三国志・蜀志十五》尚书邓芝 <sup class="footnote-ref"><a href="#fn32" id="fnref32">[32]</a></sup></li><li>《三国志・吴志一》引张勃《吴录》荆州刺史王叡 <sup class="footnote-ref"><a href="#fn33" id="fnref33">[33]</a></sup></li><li>《三国志・吴志一》引虞溥《江表传》扬州刺史、徐州伯袁术 <sup class="footnote-ref"><a href="#fn34" id="fnref34">[34]</a></sup><sup class="footnote-ref"><a href="#fn35" id="fnref35">[35]</a></sup></li><li>《三国志・吴志四》兖州刺史 <sup class="footnote-ref"><a href="#fn36" id="fnref36">[36]</a></sup></li><li>《三国志・吴志七》豫州牧诸葛瑾 <sup class="footnote-ref"><a href="#fn37" id="fnref37">[37]</a></sup></li><li>《三国志・吴志十五》大司马、扬州牧曹休 <sup class="footnote-ref"><a href="#fn38" id="fnref38">[38]</a></sup></li><li>《三国志・吴志十九》荆州牧诸葛恪 <sup class="footnote-ref"><a href="#fn39" id="fnref39">[39]</a></sup></li></ul><p>上述统计中共出现刺史 13 人、司隶校尉 1 人、州牧 10 人、护羌校尉 1 人、中郎将 1 人、辅国将军 1 人、尚书 1 人、使者 1 人、不明上司 1 人（曹操、袁术、刘璋重复出现总计 4 次）。其中刺史为中央派至地方的监察官；司隶校尉是监察中央和司隶地区 <sup class="footnote-ref"><a href="#fn40" id="fnref40">[40]</a></sup> 官员的监察官 <sup class="footnote-ref"><a href="#fn41" id="fnref41">[41]</a></sup>；州牧由刺史升格而来；护羌校尉管理西羌事务，在晋惠帝元康时期被并入凉州刺史职责中 <sup class="footnote-ref"><a href="#fn42" id="fnref42">[42]</a></sup>；中郎将、辅国将军、尚书职责变化较大，但任尚、鲜于辅等人也应当有监察西羌、鲜卑各部的职责。</p><h2 id="府君">府君 <a class="header-anchor" href="#府君">¶</a></h2><p>府君在汉代多是对国相、太守的尊称，在《后汉书》和《三国志》的例子包括：</p><ul><li>《后汉书・卷三》郁林太守刘外（光武帝刘秀曾祖父，景帝曾孙，长沙定王刘发之孙，舂陵节侯刘买次子）<sup class="footnote-ref"><a href="#fn43" id="fnref43">[43]</a></sup></li><li>《后汉书・卷五》郁林太守刘外 <sup class="footnote-ref"><a href="#fn44" id="fnref44">[44]</a></sup></li><li>《后汉书・卷四十六》上谷太守耿况 <sup class="footnote-ref"><a href="#fn6" id="fnref6:1">[6:1]</a></sup></li><li>《后汉书・卷六十七》沛国相郭府君 <sup class="footnote-ref"><a href="#fn45" id="fnref45">[45]</a></sup></li><li>《后汉书・卷六十九》彭城太守孙萌 <sup class="footnote-ref"><a href="#fn46" id="fnref46">[46]</a></sup></li><li>《后汉书・卷七十三》南阳太守阮况 <sup class="footnote-ref"><a href="#fn47" id="fnref47">[47]</a></sup></li><li>《后汉书・卷八十六》南阳太守王畅 <sup class="footnote-ref"><a href="#fn48" id="fnref48">[48]</a></sup></li><li>《三国志・魏志二十三》河内太守王匡 <sup class="footnote-ref"><a href="#fn49" id="fnref49">[49]</a></sup></li><li>《三国志・魏志二十九》广陵太守陈登 <sup class="footnote-ref"><a href="#fn50" id="fnref50">[50]</a></sup></li><li>《三国志・吴志四》交址太守士燮 <sup class="footnote-ref"><a href="#fn51" id="fnref51">[51]</a></sup></li></ul><h2 id="总结">总结 <a class="header-anchor" href="#总结">¶</a></h2><p>总体而言，在两汉三国时期，使君多用于称呼刺史以及与刺史同一级别的，带有监察性质或特殊使命的官员，而府君多用于称呼太守、国相。在两汉之后，使君、府君的使用范围逐渐扩大，演变为对他人的泛用尊称，例如：</p><blockquote><p>《世说新语・规茂》:<br>  闻贺司空出，至破冈，连名诣贺诉。贺曰 “身被微作礼官，不关此事。” 群小叩头曰：“若<strong>府君</strong>复不见治，便无所诉。”</p></blockquote><blockquote><p>《宋史・外戚列传第二百二十二》:<br>  知青涧城种世衡又遣王嵩以枣及画龟为书置蜡丸中遗旺荣，谕以早归之意，欲元昊得之，疑旺荣。旺荣得之笑曰：「种<strong>使君</strong>亦长矣，何为此儿戏耶！」</p></blockquote><h2 id="参考资料">参考资料 <a class="header-anchor" href="#参考资料">¶</a></h2><ol><li><a href="https://zhuanlan.zhihu.com/p/44185732">曹操为什么称呼刘备 “使君”，而 “使君” 一般代指何人？</a></li><li><a href="https://ctext.org/wiki.pl?if=gb&amp;res=533615&amp;remap=gb">颜师古注《汉书》</a></li><li><a href="https://ctext.org/wiki.pl?if=gb&amp;res=716836&amp;remap=gb">李贤注《后汉书》</a></li><li><a href="https://ctext.org/wiki.pl?if=gb&amp;res=339496&amp;remap=gb">裴松之注《三国志》</a></li><li>吴会娟。中古汉语谦敬称谓研究 [D]. 南京师范大学，2008.</li><li> 田顺芝.《三国演义》称谓词研究 [D]. 山东大学，2007.</li></ol><div class="note info flat"><p>参考典籍所注内容字号均小于原文，位于下标位置。</p></div><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>《三国志・蜀志二》：先主未出时，献帝舅车骑将军董承<sub>臣松之按：董承，汉灵帝母董太后之侄，于献帝为丈人。盖古无丈人之名，故谓之舅也。</sub>辞受帝衣带中密诏，当诛曹公。先主未发。是时曹公从容谓先主曰：「今天下英雄，惟<strong>使君</strong>与操耳。本初之徒，不足数也。」 <a href="#fnref1" class="footnote-backref">↩︎</a> <a href="#fnref1:1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p>《汉书・卷六・武帝纪》：初置刺史部十三州。<sub>师古曰：「汉旧仪云初分十三州，假刺史印绶，有常治所。常以秋分行部，御史为驾四封乘传。到所部，郡国各遣一吏迎之界上，所察六条。」</sub> <a href="#fnref2" class="footnote-backref">↩︎</a></p></li><li id="fn3" class="footnote-item"><p>《汉书・卷六十六・公孙刘田王杨蔡陈郑传第三十六》：武帝末，军旅数发，郡国盗贼羣起，绣衣御史暴胜之使持斧逐捕盗贼，以军兴从事，诛二千石以下。胜之过被阳，欲斩欣，欣已解衣伏质<sub>师古曰：「质，鍖也，欲斩人皆伏于鍖上也。鍖音竹林反。」</sub>，仰言曰：「<strong>使君</strong>颛杀生之柄<sub>师古曰：「为使者，故谓之</sub><sub><strong>使君</strong></sub><sub>。使音所吏反。颛与专同。」</sub>，威震郡国，今复斩一欣，不足以增威，不如时有所宽，以明恩贷<sub>师古曰：「贷犹假也，言饶假之。贷音土戴反。」</sub>，令尽死力。」 <a href="#fnref3" class="footnote-backref">↩︎</a></p></li><li id="fn4" class="footnote-item"><p>《汉书・卷七十二・王贡两龚鲍传第四十二》：使者入户，西行南面立，致诏付玺书，迁延再拜奉印绶，内安车驷马，进谓胜曰：「圣朝未甞忘君，制作未定，待君为政，思闻所欲施行，以安海内。」胜对曰：「素愚，加以年老被病，命在朝夕，随<strong>使君</strong>上道<sub>师古曰：「示若尊敬使者，故谓之</sub><sub><strong>使君</strong></sub><sub>。」</sub>，必死道路，无益万分。」 <a href="#fnref4" class="footnote-backref">↩︎</a></p></li><li id="fn5" class="footnote-item"><p>《后汉书・卷四十六・邓𡨥列传第六》：由是湟中诸胡<sub>湟中，月氏胡所居，今鄯州湟水县也。</sub>皆言：「汉家常欲鬬我曹，今<strong>邓使君</strong>待我以恩信，开门内我妻子，乃得父母！」咸欢喜叩头曰：「唯<strong>使君</strong>所命。」训遂抚养其中少年勇者数百人，以为义从。 <a href="#fnref5" class="footnote-backref">↩︎</a></p></li><li id="fn6" class="footnote-item"><p>《后汉书・卷四十六・邓𡨥列传第六》：王莽败，更始立，使使者徇郡国，曰「先降者复爵位」。恂从耿况迎使者于界上，况上印绶，使者纳之，一宿无还意。恂勒兵入见使者，就请之。使者不与，曰：「天王使者，功曹欲胁之邪？」恂曰：「非敢胁<strong>使君</strong><sub>君者，尊之称也。</sub>，窃伤计之不详也。今天下初定，国信未宣，<strong>使君</strong>建节衔命以临四方，郡国莫不延颈倾耳，望风归命。今始至上谷而先堕大信<sub>堕，毁也。</sub>，沮向化之心，生离畔之隙，将复何以号令它郡乎？且<strong>耿府君</strong>在上谷，乆为吏人所亲，今易之，得贤则造次未安，不贤则秖更生乱。为<strong>使君</strong>计，莫若复之以安百姓。」 <a href="#fnref6" class="footnote-backref">↩︎</a> <a href="#fnref6:1" class="footnote-backref">↩︎</a></p></li><li id="fn7" class="footnote-item"><p>《后汉书・卷六十一・郭杜孔张廉王苏羊贾陆列传》：始至行部，到西河美稷，有童儿数百，各骑竹马，道次迎拜。伋问「儿曹何自远来」<sub>曹，辈也。</sub>。对曰：「闻<strong>使君</strong>到，喜，故来奉迎。」伋辞谢之。及事讫，诸儿复送至郭外，问「<strong>使君</strong>何日当还」。伋谓别驾从事，计日当告之。 <a href="#fnref7" class="footnote-backref">↩︎</a></p></li><li id="fn8" class="footnote-item"><p>《后汉书・卷七十一・第五锺离宋寒列传》：初，种为衞相，以门下掾孙斌贤，善遇之。及当徙斥，斌具闻超谋，乃谓其友人同县闾子直及高密甄子然曰：「盖盗憎其主，从来旧矣。<strong>第五使君</strong>当投裔土，而单超外属为彼郡守。夫危者易仆，可为寒心。吾今方追<strong>使君</strong>，庶免其难。若奉<strong>使君</strong>以还，将以付子。」 <a href="#fnref8" class="footnote-backref">↩︎</a></p></li><li id="fn9" class="footnote-item"><p>《后汉书・卷八十二・崔駰列传》：时陈禅为司隷校尉，召瑗谓曰：「弟听祇上书，禅请为之证。」<sub>弟，但也。司马相如传曰：「弟如临邛。」</sub>瑗曰：「此譬犹儿妾屏语耳，愿<strong>使君</strong>勿复出口。」遂辞归，不复应州郡命。 <a href="#fnref9" class="footnote-backref">↩︎</a></p></li><li id="fn10" class="footnote-item"><p>《后汉书・卷八十八・虞傅盖臧列传》：时刺史耿鄙委任治中程球，球为通奸利，士人怨之<sub>汉官曰，司隷功曹从事，即持中也。</sub>。中平四年，鄙率六郡兵讨金城贼王国、韩遂等。爕知鄙失衆，必败，谏曰：「<strong>使君</strong>统政日浅，人未知敎。孔子曰：『不敎人战，是谓弃之。』今率不习之人，越大陇之阻，将十举十危，而贼闻大军将至，必万人一心。边兵多勇，其锋难当，而新合之衆，上下未和，万一内变，虽悔无及。不若息军养德，明赏必罚。贼得宽挺<sub>挺，解也。</sub>，必谓我怯，羣恶争埶，其离可必。然后率已敎之人，讨已离之贼，其功可坐而待也。今不为万全之福，而就必危之祸，窃为<strong>使君</strong>不取。」鄙不从。行至狄道，果有反者，先杀程球，次害鄙，贼遂进围汉阳。城中兵少粮尽，爕犹固守。 <a href="#fnref10" class="footnote-backref">↩︎</a></p></li><li id="fn11" class="footnote-item"><p>《后汉书・卷八十八・虞傅盖臧列传》：凉州刺史梁鹄畏惧贵戚，欲杀正和以免其负，乃访之于勋。勋素与正和有仇，或劝勋可因此报隙。勋曰：「不可。谋事杀良，非忠也；乘人之危，非仁也。」乃谏鹄曰：「夫绁食鹰鸢欲其鸷<sub>绁，系也。广雅曰：「鸷，执也。」苍颉解诂曰：「鸢，鸱也。」食音嗣。</sub>，鸷而亨之，将何用哉？」鹄从其言。正和喜于得免，而诣勋求谢。勋不见，曰：「吾为<strong>梁使君</strong>谋，不为苏正和也。」怨之如初。 <a href="#fnref11" class="footnote-backref">↩︎</a></p></li><li id="fn12" class="footnote-item"><p>《后汉书・卷八十八・虞傅盖臧列传》：中平元年，北地羌胡与边章等寇乱陇右，刺史左昌因军兴断盗数千万<sub>断谓割截。</sub>。…… 皆曰：「左<strong>使君</strong>若早从君言，以兵临我，庶可自改。今罪已重，不得降也。」乃解围而去。昌坐断盗徵，以扶风宋枭代之<sub>续汉书「枭」字作「泉」也。</sub>。 <a href="#fnref12" class="footnote-backref">↩︎</a></p></li><li id="fn13" class="footnote-item"><p>《后汉书・卷一百・郑孔荀列传》：兴平元年，操东击陶谦，使彧守甄城<sub>县名，属济阴郡，今濮州县也。「甄」今作「鄄」，音绢。</sub>，任以留事。会张邈、陈宫以兖州反操<sub>典略「宫字公台，东郡人。刚直烈壮，少与海内知名之士皆相连结」也。</sub>，而潜迎吕布。布旣至，诸城悉应之。邈乃使人谲彧曰<sub>谲，诈也。</sub>：「吕将军来助<strong>曹使君</strong>击陶谦，宜亟供军实。」 <a href="#fnref13" class="footnote-backref">↩︎</a></p></li><li id="fn14" class="footnote-item"><p>《后汉书・卷一百四・袁绍刘表列传下》：初平元年，长沙太守孙坚杀荆州刺史王睿<sub>王氏谱曰：「睿字通曜，晋太保祥之伯父也。」吴录曰：「睿见执，惊曰：『我何罪？』坚曰：『坐无所知。』睿穷迫，刮金饮之而死。」</sub>，诏书以表为荆州刺史。时江南宗贼大盛，宗党共为贼。又袁术阻兵屯鲁阳，表不能得至，乃单马入宜城<sub>宜城，县，属南郡，本鄢，惠帝三年改名宜城。</sub>，请南郡人蒯越、襄阳人蔡瑁与共谋画<sub>傅子曰：「越字异度，魏太祖平荆州，与荀彧书曰：『不喜得荆州，喜得异度耳。』」</sub>。表谓越曰：「宗贼虽盛而衆不附，若袁术因之，祸必至矣。吾欲徵兵，恐不能集，其策焉出？」对曰：「理平者先仁义，理乱者先权谋。兵不在多，贵乎得人。袁术骄而无谋，宗贼率多贪暴。越有所素养者，使人示之以利，必持衆来。<strong>使君</strong>诛其无道，施其才用，威德旣行，襁负而至矣。兵集衆附，南据江陵，北守襄阳，荆州八郡<sub>汉官仪曰，荆州管长沙、零陵、桂阳、南阳、江夏、武陵、南郡、章陵等是也。</sub>可传檄而定。公路虽至，无能为也。」表曰：「善。」 <a href="#fnref14" class="footnote-backref">↩︎</a></p></li><li id="fn15" class="footnote-item"><p>《后汉书・卷一百五・刘焉袁术吕布列传》：自孙坚死，子策复领其部曲，术遣击杨州刺史刘繇，破之，策因据江东。策闻术将欲僭号，与书谏曰：「董卓无道，陵虐王室，祸加太后，暴及弘农，天子播越，<sub>左传曰，王子朝云「兹不谷震荡播越」。播，迁也。越，逸也。言失其所居。</sub>宫庙焚毁，是以豪桀发愤，沛然俱起。<sub>沛然，自恣纵貌也。沛音片害反。</sub>元恶旣毙，幼主东顾，乃使王人奉命，宣明朝恩，偃武修文，与之更始。然而河北异谋于黑山，<sub>谓袁绍为兾州牧，与黑山贼相连。</sub>曹操毒被于东徐，刘表僭乱于南荆，公孙叛逆于朔北，正礼阻兵，<sub>刘繇也。</sub>玄德争盟，<sub>刘备也。</sub>是以未获从命，櫜弓戢戈。当谓<strong>使君</strong>与国同规，而舍是弗恤，完然有自取之志，<sub>完然，自得貌。</sub>惧非海内企望之意也。成汤讨桀，称『有夏多罪』；尚书汤誓曰：「有夏多罪，天命殛之。」武王伐纣，曰『殷有重罚』。<sub>史记曰：「武王遍告诸侯曰：『殷有重罚，不可不伐。』」</sub>此二王者，虽有圣德，假使时无失道之过，无由逼而取也。今主上非有恶于天下，徒以幼子胁于强臣，异于汤武之时也。又闻幼主明智聦敏，有夙成之德，夙，早也。天下虽未被其恩，咸归心焉。若辅而兴之，则旦、奭之美，率土所望也。<strong>使君</strong>五世相承，<sub>安生京，京生汤，汤生逢，逢生术，凡五代。</sub>为汉宰辅，荣宠之盛，莫与为比，宜効忠守节，以报王室。时人多惑图纬之言，妄牵非类之文，苟以恱主为美，不顾成败之计，古今所慎，可不孰虑！忠言逆耳，驳议致憎，<sub>驳，杂也，议不同也。前书张良曰：「忠言逆耳利于行，良药苦口利于病。」</sub>苟有益于尊明，无所敢辞。」术不纳，策遂绝之。 <a href="#fnref15" class="footnote-backref">↩︎</a></p></li><li id="fn16" class="footnote-item"><p>《后汉书・卷一百十三・逸民列传》：台佟字孝威，<sub>佟音大冬反。</sub>魏郡邺人也。隐于武安山，<sub>武安县之山也。</sub>凿穴为居，采药自业。建初中，州辟不就。刺史行部，乃使从事致谒。佟载病往谢。刺史乃执贽见佟曰：<sub>嵇康高士传曰：「刺史执枣栗之贽往。」</sub>「孝威居身如是，甚苦，如何？」佟曰：「佟幸得保终性命，存神养和。如<strong>明使君</strong>奉宣诏书，夕惕庶事，反不苦邪？」遂去，隐逸，终不见。 <a href="#fnref16" class="footnote-backref">↩︎</a></p></li><li id="fn17" class="footnote-item"><p>《后汉书・卷一百十七・西羌传》：后遣任尚为中郎将，将羽林、缇骑、五营子弟三千五百人，代班雄屯三辅。尚临行，怀令虞诩说尚曰：「<strong>使君</strong>频奉国命讨逐寇贼，三州屯兵二十馀万人，弃农桑，疲苦徭役，而未有功効，劳费日滋。若此出不克，诚为<strong>使君</strong>危之。」尚曰：「忧惶乆矣，不知所如。」诩曰：「兵法弱不攻强，走不逐飞，自然之埶也。今虏皆马骑，日行数百，来如风雨，去如绝弦，以步追之，埶不相及，所以旷而无功也。为<strong>使君</strong>计者，莫如罢诸郡兵，各令出钱数千，二十人共市一马，如此，可舍甲胄，驰轻兵，以万骑之衆，逐数千之虏，追尾掩𢧵，<sub>尾犹寻也。</sub>其道自穷。便人利事，大功立矣。」尚大喜，即上言用其计。乃遣轻骑钞击杜季贡于丁奚城，斩首四百馀级，获牛马羊数千头。 <a href="#fnref17" class="footnote-backref">↩︎</a></p></li><li id="fn18" class="footnote-item"><p>《三国志・魏志八》：兴平元年，复东征，略定琅邪、东海诸县。谦恐，欲走归丹杨。会张邈叛迎吕布，太祖还击布。是岁，谦病死。<sub>吴书曰：谦死时，年六十三，张昭等为之哀辞曰：“猗欤</sub><sub><strong>使君</strong></sub><sub>，君侯将军，膺秉懿德，允武允文，体足刚直，守以温仁。令舒及卢，遗爱于民；牧幽曁徐，甘棠是均。憬憬夷貊，赖侯以清；蠢蠢妖寇，匪侯不宁。唯帝念绩，爵命以章，旣牧且侯，启土溧阳。遂升上将，受号安东，将平世难，社稷是崇。降年不永，奄忽殂薨，丧覆失恃，民知困穷。曾不旬日，五郡溃崩，哀我人斯，将谁仰凭？追思靡及，仰叫皇穹。呜呼哀哉！” 谦二子：商、应，皆不仕。</sub> <a href="#fnref18" class="footnote-backref">↩︎</a></p></li><li id="fn19" class="footnote-item"><p>《三国志・魏志十》：明年，太祖领兖州牧，后为镇东将军，彧常以司马从。兴平元年，太祖征陶谦，任彧留事。会张邈、陈宫以兖州反，潜迎吕布。布旣至，邈乃使刘翊告彧曰：「吕将军来助<strong>曹使君</strong>击陶谦，宜亟供其军食。」 <a href="#fnref19" class="footnote-backref">↩︎</a></p></li><li id="fn20" class="footnote-item"><p>《三国志・魏志十一》：谭复欲攻尚，修谏曰：「兄弟还相攻击，是败亡之道也。」谭不恱，然知其忠节。后又问修：「计安出？」修曰：「夫兄弟者，左右手也。譬人将鬬而断其右手，而曰『我必胜』，若是者可乎？夫弃兄弟而不亲，天下其谁亲之！属有谗人，固将交鬬其间，以求一朝之利，愿<strong>明使君</strong>塞耳勿听也。若斩佞臣数人，复相亲睦，以御四方，可以横行天下。」谭不听，遂与尚相攻击，请救于太祖。 <a href="#fnref20" class="footnote-backref">↩︎</a></p></li><li id="fn21" class="footnote-item"><p>《三国志・魏志十四》：刘岱为黄巾所杀。太祖临兖州，辟昱。…… 昱乃归，过范，说其令靳允曰：「闻吕布执君母弟妻子，孝子诚不可为心！今天下大乱，英雄并起，必有命世，能息天下之乱者，此智者所详择也。得主者昌，失主者亡。陈宫叛迎吕布而百城皆应，似能有为，然以君观之，布何如人哉！夫布，粗中少亲，刚而无礼，匹夫之雄耳。宫等以势假合，不能相君也。兵虽衆，终必无成。<strong>曹使君</strong>智略不世出，殆天所授！君必固范，我守东阿，则田单之功可立也。孰与违忠从恶而母子俱亡乎？唯君详虑之！」允流涕曰：「不敢有贰心。」时泛嶷已在县，允乃见嶷，伏兵刺杀之，归勒兵守。 <a href="#fnref21" class="footnote-backref">↩︎</a></p></li><li id="fn22" class="footnote-item"><p>《三国志・魏志二十三》：<sub>繇为人机捷，善持论，而干讷口，临时屈无以应。繇谓干曰：「公羊高竟为左丘明服矣。」干曰：「直故吏为</sub><sub><strong>明使君</strong></sub><sub>服耳，公羊未肯也。」</sub> <a href="#fnref22" class="footnote-backref">↩︎</a></p></li><li id="fn23" class="footnote-item"><p>《三国志・魏志二十四》：文帝践阼，拜尚书，出为幽州刺史。北中郎将吴质统河北军事，涿郡太守王雄谓林别驾曰：「吴中郎将，上所亲重，国之贵臣也。杖节统事，州郡莫不奉笺致敬，而<strong>崔使君</strong>初不与相闻。若以边塞不修斩卿，<strong>使君</strong>宁能护卿邪？」 <a href="#fnref23" class="footnote-backref">↩︎</a></p></li><li id="fn24" class="footnote-item"><p>《三国志・魏志二十五》：陇右平定，太祖封讨超之功，侯者十一人，赐阜爵关内侯。阜让曰：「阜君存无捍难之功，君亡无死节之効，于义当绌，于法当诛；超又不死，无宜苟荷爵禄。」太祖报曰：「君与羣贤共建大功，西土之人以为美谈。子贡辞赏，仲尼谓之止善。君其剖心以顺国命。姜叙之母，劝叙早发，明智乃尔，虽杨敞之妻盖不过此。贤哉，贤哉！良史记录，必不坠于地矣。」<sub>皇甫谧列女传曰：姜叙母者，天水姜伯弈之母也。建安中，马超攻兾，害凉州刺史韦康，州人凄然，莫不感愤。叙为抚夷将军，拥兵屯历。叙姑子杨阜，故为康从事，同等十馀人，皆略属超，阴相结为康报仇，未有闲。会阜妻死，辞超宁归西，因过至历，候叙母，说康被害及兾中之难，相对泣良乆。姜叙举室感悲，叙母曰：「咄！伯弈，</sub><sub><strong>韦使君</strong></sub><sub>遇难，岂一州之耻，亦汝之负，岂独义山哉？汝无顾我，事淹变生。人谁不死？死国，忠义之大者。但当速发，我自为汝当之，不以馀年累汝也。」</sub> <a href="#fnref24" class="footnote-backref">↩︎</a></p></li><li id="fn25" class="footnote-item"><p>《三国志・魏志二十八》：<sub>魏书曰：愚字公浩，本名浚，黄初中，为和戎护军。乌丸校尉田豫讨胡有功，小违节度，愚以法绳之。帝怒，械系愚，免官治罪，诏曰「浚何愚」！遂以名之。正始中，为曹爽长史，后出为兖州刺史。魏畧曰：愚闻楚王彪有智勇。初东郡有譌言云：「白马河出妖马，夜过官牧边鸣呼，衆马皆应，明日见其迹，大如斛，行数里，还入河中。」又有谣言：「白马素羁西南驰，其谁乘者朱虎骑。」楚王小字朱虎，故愚与王淩阴谋立楚王。乃先使人通意于王，言「</sub><sub><strong>使君</strong></sub><sub>谢王，天下事不可知，愿王自爱」！彪亦阴知其意，荅言「谢</sub><sub><strong>使君</strong></sub><sub>，知厚意也。」</sub> <a href="#fnref25" class="footnote-backref">↩︎</a></p></li><li id="fn26" class="footnote-item"><p>《三国志・魏志二十八》：<sub>魏畧载：山阳单固，字恭夏，为人有器实。正始中，兖州刺史令狐愚与固父伯龙善，辟固，欲以为别驾。固不乐为州吏，辞以疾。愚礼意愈厚，固不欲应。固母夏侯氏谓固曰：「</sub><sub><strong>使君</strong></sub><sub>与汝父乆善，故命汝不止，汝亦故当仕进，自可往耳。」固不获已，遂往，与兼治中从事杨康并为愚腹心。后愚与王淩通谋，康、固皆知其计。会愚病，康应司徒召诣洛阳，固亦以疾解禄。康在京师露其事，太傅乃东取王淩。到寿春，固见太傅，太傅问曰：「卿知其事为邪？」固对不知。太傅曰：「且置近事。问卿，令狐反乎？」固又曰无。而杨康白，事事与固连。遂收捕固及家属，皆系廷尉，考实数十，固故云无有。太傅录杨康，与固对相诘。固辞穷，乃骂康曰：「老庸旣负</sub><sub><strong>使君</strong></sub><sub>，又灭我族，顾汝当活邪！」</sub> <a href="#fnref26" class="footnote-backref">↩︎</a></p></li><li id="fn27" class="footnote-item"><p>《三国志・魏志二十九》：当此之时，辂之邻里，外户不闭，无相偷窃者。清河太守华表，召辂为文学掾。安平赵孔曜荐辂于兾州刺史裴徽曰：「辂雅性宽大，与世无忌，仰观天文则同妙甘公、石申，俯览周易则齐思季主。今<strong>明使君</strong>方垂神幽薮，留精九臯，辂宜蒙阴和之应，得及羽仪之时。」徽于是辟为文学从事，引与相见，大善友之。徙部钜鹿，迁治中别驾。 <a href="#fnref27" class="footnote-backref">↩︎</a></p></li><li id="fn28" class="footnote-item"><p>《三国志・魏志三十》：比能使别小帅琐奴拒豫，豫进讨，破走之，由是怀贰。乃与辅国将军鲜于辅书曰：「夷狄不识文字，故校尉阎柔保我于天子。我与素利为雠，往年攻击之，而田校尉助素利。我临阵使琐奴往，闻<strong>使君</strong>来，即便引军退。步度根数数钞盗，又杀我弟，而诬我以钞盗。我夷狄虽不知礼义，兄弟子孙受天子印绶，牛马尚知美水草，况我有人心邪！将军当保明我于天子。」辅得书以闻帝，帝复使豫招纳安慰。 <a href="#fnref28" class="footnote-backref">↩︎</a></p></li><li id="fn29" class="footnote-item"><p>《三国志・蜀志一》：州大吏赵韪等贪璋温仁，共上璋为益州刺史，诏书因以为监军使者，领益州牧，以韪为征东中郎将，率衆击刘表。…… 璋复遣别驾张松诣曹公，曹公时已定荆州，走先主，不复存录松，松以此怨。会曹公军不利于赤壁，兼以疫死。松还，疵毁曹公，劝璋自绝，<sub>汉书春秋曰：张松见曹公，曹公方自矜伐，不存录松。松归，乃劝璋自绝。习凿齿曰：昔齐桓一矜其功而叛者九国，曹操暂自骄伐而天下三分，皆勤之于数十年之内而弃之于俯仰之顷，岂不惜乎！是以君子劳谦日仄，虑以下人，功高而居之以让，势尊而守之以卑。情近于物，故虽贵而人不猒其重；德洽羣生，故业广而天下愈欣其庆。夫然，故能有以富贵，保其功业，隆显当时，传福百世，何骄矜之有哉！君子是以知曹操之不能遂兼天下者也。</sub>因说璋曰：「刘豫州，<strong>使君</strong>之肺腑，可与交通。」璋皆然之，遣法正连好先主，寻又令正及孟达送兵数千助先主守御，正遂还。 <a href="#fnref29" class="footnote-backref">↩︎</a></p></li><li id="fn30" class="footnote-item"><p>《三国志・蜀志二》：谦表先主为豫州刺史，屯小沛。谦病笃，谓别驾麋竺曰：「非刘备不能安此州也。」谦死，竺率州人迎先主，先主未敢当。下邳陈登谓先主曰：「今汉室陵迟，海内倾覆，立功立事，在于今日。彼州殷富，户口百万，欲屈<strong>使君</strong>抚临州事。」先主曰：「袁公路近在寿春，此君四世五公，海内所归，君可以州与之。」登曰：「公路骄豪，非治乱之主。今欲为<strong>使君</strong>合步骑十万，上可以匡主济民，成五霸之业，下可以割地守境，书功于竹帛。若<strong>使君</strong>不见听许，登亦未敢听<strong>使君</strong>也。」 <a href="#fnref30" class="footnote-backref">↩︎</a></p></li><li id="fn31" class="footnote-item"><p>《三国志・蜀志二》：十六年，益州牧刘璋遥闻曹公将遣锺繇等向汉中讨张鲁，内怀恐惧。别驾从事蜀郡张松说璋曰：「曹公兵强无敌于天下，若因张鲁之资以取蜀土，谁能御之者乎？」璋曰：「吾固忧之而未有计。」松曰：「刘豫州，<strong>使君</strong>之宗室而曹公之深雠也，善用兵，若使之讨鲁，鲁必破。鲁破，则益州强，曹公虽来，无能为也。」璋然之，遣法正将四千人迎先主，前后赂遗以巨亿计。正因陈益州可取之策。 <a href="#fnref31" class="footnote-backref">↩︎</a></p></li><li id="fn32" class="footnote-item"><p>《三国志・蜀志十五》：（芝）所在清严有治绩，入为尚书。先主薨于永安。先是，吴王孙权请和，先主累遣宋玮、费禕等与相报荅。丞相诸葛亮深虑权闻先主殂陨，恐有异计，未知所如。芝见亮曰：「今主上幼弱，初在位，宜遣大使重申吴好。」亮荅之曰：「吾思之乆矣，未得其人耳，今日始得之。」芝问其人为谁？亮曰：「即<strong>使君</strong>也。」乃遣芝修好于权。 <a href="#fnref32" class="footnote-backref">↩︎</a></p></li><li id="fn33" class="footnote-item"><p>《三国志・吴志一》：灵帝崩，卓擅朝政，横恣京城。诸州郡并兴义兵，欲以讨卓。<sub>江表传曰：坚闻之，拊膺叹曰：「张公昔从吾言，朝廷今无此难也。」</sub>坚亦举兵。荆州刺史王睿素遇坚无礼，坚过杀之。<sub>案王氏谱，睿字通耀，晋太保祥伯父也。吴录曰：睿先与坚共击零、桂贼，以坚武官，言颇轻之。及睿举兵欲讨卓，素与武陵太守曹寅不相能，杨言当先杀寅。寅惧，诈作案行使者光禄大夫温毅檄，移坚，说睿罪过，令收行刑讫，以状上。坚即承檄勒兵袭睿。睿闻兵至，登楼望之，遣问欲何为，坚前部荅曰：「兵乆战劳苦，所得赏，不足以为衣服，诣</sub><sub><strong>使君</strong></sub><sub>更乞资直耳。」睿曰：「刺史岂有所吝？」便开库藏，使自入视之，知有所遗不。兵进及楼下，睿见坚，惊曰：「兵自求赏，</sub><sub><strong>孙府君</strong></sub><sub>何以在其中？」坚曰：「被使者檄诛君。」睿曰：「我何罪？」坚曰：「坐无所知。」睿穷迫，刮金饮之而死。</sub> <a href="#fnref33" class="footnote-backref">↩︎</a></p></li><li id="fn34" class="footnote-item"><p>《三国志・吴志一》：徐州牧陶谦深忌策。策舅吴景，时为丹杨太守，策乃载母徙曲阿，与吕范、孙河俱就景，因缘召募得数百人。兴平元年，从袁术。术甚奇之，以坚部曲还策。<sub>江表传曰：策径到寿春见袁术，涕泣而言曰：「亡父昔从长沙入讨董卓，与</sub><sub><strong>使君</strong></sub><sub>会于南阳，同盟结好；不幸遇难，勋业不终。策感惟先人旧恩，欲自凭结，愿</sub><sub><strong>明使君</strong></sub><sub>垂察其诚。」术甚贵异之，然未肯还其父兵。术谓策曰：「孤始用贵舅为丹杨太守，贤从伯阳为都尉，彼精兵之地，可还依召募。」策遂诣丹杨依舅，得数百人，而为泾县大帅祖郎所袭，几至危殆。于是复往见术，术以坚馀兵千馀人还策。</sub> <a href="#fnref34" class="footnote-backref">↩︎</a></p></li><li id="fn35" class="footnote-item"><p>《三国志・吴志一》：策乃说术，乞助景等平定江东。<sub>江表传曰：策说术云：「家有旧恩在东，愿助舅讨横江；横江拔，因投本土召募，可得三万兵，以佐</sub><sub><strong>明使君</strong></sub><sub>匡济汉室。」术知其恨，而以刘繇据曲阿，王朗在会稽，谓策未必能定，故许之。</sub> <a href="#fnref35" class="footnote-backref">↩︎</a></p></li><li id="fn36" class="footnote-item"><p>《三国志・吴志四》：平原陶丘洪荐繇，欲令举茂才。刺史曰：「前年举公山，柰何复举正礼乎？」洪曰：「若<strong>明使君</strong>用公山于前，擢正礼于后，所谓御二龙于长涂，骋骐骥于千里，不亦可乎！」 <a href="#fnref36" class="footnote-backref">↩︎</a></p></li><li id="fn37" class="footnote-item"><p>《三国志・吴志七》：颍川周昭著书称步骘及严畯等曰：「古今贤士大夫所以失名丧身倾家害国者，其由非一也，然要其大归，总其常患，四者而已。急而论议一也，争名势二也，重朋党三也，务欲速四也。急论议则伤人，争名势则败友，重朋党则蔽主，务欲速则失德，此四者不除，未有能全也。当世君子能不然者，亦比有之，岂独古人乎！然论其绝异，未若顾豫章、<strong>诸葛使君</strong>、步丞相、严衞尉、张奋威之为美也。论语言『夫子恂恂然善诱人』，又曰『成人之美，不成人之恶』，豫章有之矣。『望之俨然，即之也温，听其言也厉』，<strong>使君</strong>体之矣。『恭而安，威而不猛』，丞相履之矣。学不求禄，心无苟得，衞尉、奋威蹈之矣。此五君者，虽德实有差，轻重不同，至于趣舍大检，不犯四者，俱一揆也。昔丁諝出于孤家，吾粲由于牧竖，豫章扬其善，以并陆、全之列，是以人无幽滞而风俗厚焉。<strong>使君</strong>、丞相、衞尉三君，昔以布衣俱相友善，诸论者因各叙其优劣。初，先衞尉，次丞相，而后有<strong>使君</strong>也；其后并事明主，经营世务，出处之才有不同，先后之名须反其初，此世常人所决勤薄也。至于三君分好，卒无亏损，岂非古人交哉！又鲁横江昔杖万兵，屯据陆口，当世之美业也，能与不能，孰不愿焉？而横江旣亡，衞尉应其选，自以才非将帅，深辞固让，终于不就。后徙九列，迁典八座，荣不足以自曜，禄不足以自奉。至于二君，皆位为上将，穷富极贵。衞尉旣无求欲，二君又不称荐，各守所志，保其名好。孔子曰：『君子矜而不争，羣而不党。』斯有风矣。又奋威之名，亦三君之次也，当一方之戍，受上将之任，与<strong>使君</strong>、丞相不异也。然历国事，论功劳，实有先后，故爵位之荣殊焉。而奋威将处此，决能明其部分，心无失道之欲，事无充诎之求，每升朝堂，循礼而动，辞气謇謇，罔不惟忠。叔嗣虽亲贵，言忧其败，蔡文至虽疏贱，谈称其贤。女配太子，受礼若吊，慷忾之趋，惟笃人物，成败得失，皆如所虑，可谓守道见机，好古之士也。若乃经国家，当军旅，于驰骛之际，立霸王之功，此五者未为过人。至其纯粹履道，求不苟得，升降当世，保全名行，邈然绝俗，实有所师。故粗论其事，以示后之君子。」周昭者字恭远，与韦曜、薛莹、华核并述吴书，后为中书郎，坐事下狱，核表救之，孙休不听，遂伏法云。 <a href="#fnref37" class="footnote-backref">↩︎</a></p></li><li id="fn38" class="footnote-item"><p>《三国志・吴志十五》：被命密求山中旧族名帅为北敌所闻知者，令谲挑魏大司马扬州牧曹休。鲂答，恐民帅小丑不足仗任，事或漏泄，不能致休，乞遣亲人赍笺七条以诱休：…… 一则伤慈损计，二则杜绝向化者心，惟<strong>明使君</strong>远览前世，矜而愍之，留神所质，速赐秘报。…… 愿<strong>明使君</strong>少垂详察，忖度其言。今此郡民，虽外名降首，而故在山草，看伺空隙，欲复为乱，为乱之日，鲂命讫矣。…… 若<strong>明使君</strong>以万兵从皖南首江渚，鲂便从此率厉吏民，以为内应。此方诸郡，前后举事，垂成而败者，由无外援使其然耳；若北军临境，传檄属城，思咏之民，谁不企踵？愿<strong>明使君</strong>上观天时，下察人事，中参蓍龟，则足昭往言之不虚也。…… 私恐<strong>使君</strong>未深保明，岑、南二人可留其一，以为后信。…… 今<strong>使君</strong>若从皖道进住江上，鲂当从南对岸历口为应。…… <strong>明使君</strong>速垂救济，诚宜疾密。王靖之变，其鉴不远。今鲂归命，非复在天，正在<strong>明使君</strong>耳。若见救以往，则功可必成，如见救不时，则与靖等同祸。前彭绮时，闻旌麾在逢龙，此郡民大小欢喜，并思立效。若留一月日间，事当大成，恨去电速，东得增衆专力讨绮，绮始败耳。愿<strong>使君</strong>深察此言。 <a href="#fnref38" class="footnote-backref">↩︎</a></p></li><li id="fn39" class="footnote-item"><p>《三国志・吴志十九》：会逊卒，恪迁大将军，假节，驻武昌，代逊领荆州事。……及将见，驻车宫门，峻已伏兵于帷中，恐恪不时入，事泄，自出见恪曰：「<strong>使君</strong>若尊体不安，自可须后，峻当具白主上。」欲以甞知恪。恪荅曰：「当自力入。」散骑常侍张约、朱恩等密书与恪曰：「今日张设非常，疑有他故。」恪省书而去。未出路门，逢太常滕胤，恪曰：「卒腹痛，不任入。」胤不知峻阴计，谓恪曰：「君自行旋未见，今上置酒请君，君已至门，宜当力进。」恪踌躇而还，劒履上殿，谢亮，还坐。设酒，恪疑未饮，峻因曰：「<strong>使君</strong>病未善平，当有常服药酒，自可取之。」 <a href="#fnref39" class="footnote-backref">↩︎</a></p></li><li id="fn40" class="footnote-item"><p>司隶地区：首都及其周边地区，在两汉指三辅、三河以及弘农地区，包括京兆尹、左冯翊、右扶风、河东、河南、河内和弘农。 <a href="#fnref40" class="footnote-backref">↩︎</a></p></li><li id="fn41" class="footnote-item"><p>《汉书・百官公卿表》：司隶校尉，周官，武帝征和四年初置。持节，从中都官徒千二百人，捕巫蛊，督大奸猾。后罢其兵。察三辅、三河、弘农。元帝初元四年去节。成帝元延四年省。绥和二年，哀帝复置，但为司隶，冠进贤冠，属大司空，比司直。 <a href="#fnref41" class="footnote-backref">↩︎</a></p></li><li id="fn42" class="footnote-item"><p>《晋书・志第十四・职官》：护羌、夷、蛮等校尉，案武帝置南蛮校尉于襄阳，西戎校尉于长安，南夷校尉于宁州。元康中，护羌校尉为凉州刺史，西戎校尉为雍州刺史，南蛮校尉为荆州刺史。及江左初，省南蛮校尉，寻又置于江陵，改南夷校尉曰镇蛮校尉。及安帝时，于襄阳置宁蛮校尉。 <a href="#fnref42" class="footnote-backref">↩︎</a></p></li><li id="fn43" class="footnote-item"><p>《后汉书・卷三・帝纪第三肃宗孝章皇帝》：辛丑，幸章陵，祠旧宅园庙，见宗室故人，赏赐各有差。冬十月己未，进幸江陵，诏庐江太守祠南岳，又诏长沙、零陵太守祠长沙定王、舂陵节侯、<strong>郁林府君</strong>。还，幸宛。十一月己丑，车驾还宫，赐从者各有差。 <a href="#fnref43" class="footnote-backref">↩︎</a></p></li><li id="fn44" class="footnote-item"><p>《后汉书・卷三・帝纪第五孝安皇帝》：庚申，幸宛，帝不豫。辛酉，令大将军耿宝行太尉事。祠章陵园庙，告长沙、零陵太守，祠定王、节侯、<strong>郁林府君</strong>。乙丑，自宛还。丁卯，幸叶，帝崩于乘舆，年三十二。 <a href="#fnref44" class="footnote-backref">↩︎</a></p></li><li id="fn45" class="footnote-item"><p>《后汉书・卷六十七・桓荣丁鸿列传第二十七》：父麟，字元凤，早有才惠。<sub>华峤书曰「酆生麟」也。</sub>桓帝初，为议郎，入侍讲禁中，以直道啎左右，出为许令，<sub>许，县名，今许州许昌县也。</sub>病免。会母终，麟不胜丧，未祥而卒，年四十一。所著碑、诔、赞、说、书凡二十一篇。<sub>案挚虞文章志，麟文见在者十八篇，有碑九首，诔七首，七说一首，沛相</sub><sub><strong>郭府君</strong></sub><sub>书一首。</sub> <a href="#fnref45" class="footnote-backref">↩︎</a></p></li><li id="fn46" class="footnote-item"><p>《后汉书・卷六十九・刘赵淳于江刘周赵列传第二十九》：建武初，平狄将军庞萌反于彭城，攻败郡守孙萌。平时复为郡吏，冒白刃伏萌身上，被七创，困顿不知所为，号泣请曰：「愿以身代<strong>府君</strong>。」贼乃敛兵止，曰：「此义士也，勿杀。」遂解去。萌伤甚气绝，有顷苏，渴求饮。平倾其创血以饮之。后数日萌竟死，平乃裹创，扶送萌丧，至其本县。 <a href="#fnref46" class="footnote-backref">↩︎</a></p></li><li id="fn47" class="footnote-item"><p>《后汉书・卷七十三・朱乐何列传第三十三》：朱晖字文季，南阳宛人也。…… 后为郡吏，太守阮况甞欲市晖婢，晖不从。<sub>东观记曰：「晖为督邮，况当归女，欲买晖婢，晖不敢与。后况卒，晖送其家金三斤。」</sub>及况卒，晖乃厚赠送其家。人或讥焉，晖曰：「前<strong>阮府君</strong>有求于我，所以不敢闻命，诚恐以财货汚君。今而相送，明吾非有爱也。」 <a href="#fnref47" class="footnote-backref">↩︎</a></p></li><li id="fn48" class="footnote-item"><p>《后汉书・卷八十六・张王种陈列传第四十六》：畅字叔茂。…… 由是复为尚书。寻拜南阳太守。…… 郡中豪族多以奢靡相尚，畅常布衣皮褥，车马羸败，以矫其敝。同郡刘表时年十七，从畅受学。进谏曰：「夫奢不僭上，俭不逼下，<sub>礼记曰「君子上不僭上，下不逼下」也。</sub>循道行礼，贵处可否之闲。蘧伯玉耻独为君子。<strong>府君</strong>不希孔圣之明训，而慕夷齐之末操，<sub>论语孔子曰：「奢则不逊，俭则固。」言仲尼得奢俭之中，而夷齐饥死，是末操也。</sub>无乃皎然自贵于世乎？」畅曰：「昔公仪休在鲁，拔园葵，去织妇；<sub>史记曰，鲁相公仪休之其家，见织帛，怒而出其妇，食于舍而茹葵，愠而拔其葵，曰：「吾已食禄，又夺园夫女子利乎？」</sub>孙叔敖相楚，其子被裘刈薪。<sub>史记曰，孙叔敖为楚相，且死，属其子曰：「我死，汝贫困，往见优孟，言孙叔敖子也。」居数年，其子贫，负薪逢优孟。优孟言之于王，封之寝丘四百户也。</sub>夫以约失之鲜矣。<sub>论语孔子之辞也。言俭则无失。</sub>闻伯夷之风者，贪夫廉，懦夫有立志。<sub>孟子之辞。</sub>虽以不德，敢慕遗烈。」 <a href="#fnref48" class="footnote-backref">↩︎</a></p></li><li id="fn49" class="footnote-item"><p>《三国志・魏志二十三》：常林字伯槐，河内温人也。…… 太守王匡起兵讨董卓，遣诸生于属县微伺吏民罪负，便收之，考责钱谷赎罪，稽迟则夷灭宗族，以崇威严。林叔父檛客，为诸生所白，匡怒收治。举宗惶怖，不知所责多少，惧系者不救。林往见匡同县胡母彪曰：“<strong>王府君</strong>以文武高才，临吾鄙郡。鄙郡表里山河，土广民殷，又多贤能，惟所择用。今主上幼冲，贼臣虎据，华夏震栗，雄才奋用之秋也。若欲诛天下之贼，扶王室之微，智者望风，应之若响，克乱在和，何征不捷。苟无恩德，任失其人，覆亡将至，何暇匡翼朝廷，崇立功名乎？君其藏之！” 因说叔父见拘之意。 <a href="#fnref49" class="footnote-backref">↩︎</a></p></li><li id="fn50" class="footnote-item"><p>《三国志・魏志二十九》：广陵太守陈登得病，胷中烦懑，靣赤不食。佗脉之曰：“<strong>府君</strong>胃中有虫数升，欲成内疽，食腥物所为也。” 即作汤二升，先服一升，斯须尽服之。食顷，吐出三升许虫，赤头皆动，半身是生鱼脍也，所苦便愈。佗曰：“此病后三期当发，遇良医乃可济救。” 依期果发动，时佗不在，如言而死。 <a href="#fnref50" class="footnote-backref">↩︎</a></p></li><li id="fn51" class="footnote-item"><p>《三国志・吴志四》：父赐丧阕后，举茂才，除巫令，迁交址太守。…… 燮体器宽厚，谦虚下士，中国士人往依避难者以百数。耽玩春秋，为之注解。陈国袁徽与尚书令荀彧书曰：“交址<strong>士府君</strong>旣学问优博，又达于从政，处大乱之中，保全一郡，二十馀年疆埸无事，民不失业，羁旅之徒，皆蒙其庆，虽窦融保河西，曷以加之？官事小阕，辄玩习书传，春秋左氏传尤简练精微，吾数以咨问传中诸疑，皆有师说，意思甚密。又尚书兼通古今，大义详备。闻京师古今之学是非忿争，今欲条左氏、尚书长义上之。” 其见称如此。 <a href="#fnref51" class="footnote-backref">↩︎</a></p></li></ol></section>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;前言 &lt;a class=&quot;header-anchor&quot; href=&quot;#前言&quot;&gt;¶&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;三国演义中有一段经典剧情青梅煮酒论英雄，说献帝的舅舅董承与刘备暗中结盟欲除去曹操，刘备怕曹操生疑，因此每日浇水种豆。曹操听说后请刘备饮酒，议论天下英雄</summary>
      
    
    
    
    <category term="随记" scheme="https://foolishfox.cn/categories/%E9%9A%8F%E8%AE%B0/"/>
    
    <category term="历史" scheme="https://foolishfox.cn/categories/%E9%9A%8F%E8%AE%B0/%E5%8E%86%E5%8F%B2/"/>
    
    
    <category term="历史" scheme="https://foolishfox.cn/tags/%E5%8E%86%E5%8F%B2/"/>
    
    <category term="三国" scheme="https://foolishfox.cn/tags/%E4%B8%89%E5%9B%BD/"/>
    
    <category term="汉朝" scheme="https://foolishfox.cn/tags/%E6%B1%89%E6%9C%9D/"/>
    
    <category term="使君" scheme="https://foolishfox.cn/tags/%E4%BD%BF%E5%90%9B/"/>
    
    <category term="称呼" scheme="https://foolishfox.cn/tags/%E7%A7%B0%E5%91%BC/"/>
    
    <category term="礼仪" scheme="https://foolishfox.cn/tags/%E7%A4%BC%E4%BB%AA/"/>
    
  </entry>
  
  <entry>
    <title>Hexo 配置 Typst 代码高亮</title>
    <link href="https://foolishfox.cn/posts/202402-typst-block.html"/>
    <id>https://foolishfox.cn/posts/202402-typst-block.html</id>
    <published>2024-02-12T07:36:52.000Z</published>
    <updated>2024-02-12T07:36:52.000Z</updated>
    
    <content type="html"><![CDATA[<p><code>Hexo</code> 处理的代码块会被包裹在 <code>figure table tbody tr &gt; td.code pre</code> 中，每一行代码又被 <code>span</code> 包裹，如果需要加入对 <code>Typst</code> 的支持，需要将所有的代码重新提取出来，处理后之后再填入，有两种方法可以选择：</p><ol><li>前端修改：在 <code>html</code> 页面中读取代码块元素，提取代码处理后再填入 <sup><a href="#refer-1">(1)</a></sup></li><li><a href="#%E6%A0%87%E7%AD%BE%E6%8F%92%E4%BB%B6">标签插件（<strong>推荐</strong>）</a>：在 <code>hexo</code> 生成的过程中使用标签插件 <sup><a href="#refer-2">(2)</a></sup> 处理</li></ol><h2 id="前端修改">前端修改 <a class="header-anchor" href="#前端修改">¶</a></h2><div class="note danger flat"><p>此方法可能需要刷新才能正常显示<br>此方法会将所有的 <code>plaintext</code> 识别为 <code>typst</code>，可以通过在第一行加一行说明语言来处理</p></div><h3 id="引入js文件">引入 <code>js</code> 文件 <a class="header-anchor" href="#引入js文件">¶</a></h3><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span> <span class="attr">src</span>=<span class="string">"https://foolishfox.cn/js/hl.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">"script-main"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">"https://cdn.jsdelivr.net/npm/@myriaddreamin/highlighter-typst/dist/cjs/contrib/hljs/typst.bundle.js"</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="注册-Typst">注册 <code>Typst</code><a class="header-anchor" href="#注册-Typst">¶</a></h3><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">run</span> = (<span class="params"></span>) =&gt; {</span><br><span class="line">    $typst$parserModule.<span class="title function_">then</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">        hljs.<span class="title function_">registerLanguage</span>(</span><br><span class="line">            <span class="string">'typst'</span>,</span><br><span class="line">            <span class="variable language_">window</span>.<span class="title function_">hljsTypst</span>({</span><br><span class="line">                <span class="attr">codeBlockDefaultLanguage</span>: <span class="string">'typst'</span>,</span><br><span class="line">            }),</span><br><span class="line">        );</span><br><span class="line">        hljs.<span class="title function_">configure</span>({</span><br><span class="line">            <span class="attr">classPrefix</span>: <span class="string">''</span> <span class="comment">// don't append class prefix</span></span><br><span class="line">        });</span><br><span class="line">    }).<span class="title function_">then</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">'figure table tbody tr &gt; td.code pre'</span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">el</span> =&gt;</span> {</span><br><span class="line">            <span class="keyword">if</span> (!el.<span class="title function_">getAttribute</span>(<span class="string">'data-highlighted'</span>)) {</span><br><span class="line">                <span class="keyword">var</span> pre = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">"pre"</span>);</span><br><span class="line">                <span class="keyword">var</span> lang = el.<span class="property">parentNode</span>.<span class="property">parentNode</span>.<span class="property">parentNode</span>.<span class="property">parentNode</span>.<span class="property">parentNode</span>.<span class="property">classList</span>[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">var</span> code = <span class="string">""</span>;</span><br><span class="line">                <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; el.<span class="property">childElementCount</span>; i++){</span><br><span class="line">                    ch = el.<span class="property">children</span>[i];</span><br><span class="line">                    <span class="keyword">if</span> (ch.<span class="property">tagName</span> == <span class="string">"SPAN"</span>) code += ch.<span class="property">textContent</span>;</span><br><span class="line">                    <span class="keyword">if</span> (ch.<span class="property">tagName</span> == <span class="string">"BR"</span>) code += <span class="string">"\n"</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">if</span> (lang == <span class="string">"plaintext"</span>) {</span><br><span class="line">                    lang = <span class="string">"typst"</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">if</span> (lang != <span class="string">"plaintext"</span>) {</span><br><span class="line">                    el.<span class="property">innerHTML</span> = hljs.<span class="title function_">highlight</span>(code, {<span class="attr">language</span>: lang}).<span class="property">value</span></span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">    });</span><br><span class="line">}</span><br><span class="line"><span class="title function_">run</span>();</span><br></pre></td></tr></tbody></table></figure><h2 id="标签插件">标签插件 <a class="header-anchor" href="#标签插件">¶</a></h2><div class="note info flat"><p>文件下载：</p><ul><li><a href="https://gist.githubusercontent.com/YiHui-Liu/35d2f3b7e2665c0995e18e1f998ed122/raw/caf17c5dc07da5583eae8b9f80d961ddc27a7588/typst.js">typst.js</a> <sup> 修改自 <a href="#refer-4">(4)</a></sup></li><li><a href="https://gist.githubusercontent.com/YiHui-Liu/35d2f3b7e2665c0995e18e1f998ed122/raw/caf17c5dc07da5583eae8b9f80d961ddc27a7588/typst.bundle.js">typst.bundle.js</a> <sup> 修改自 <a href="#refer-3">(3)</a></sup><br>下载后放置在 <code>Hexo</code> 根目录下的 <code>scripts</code> 目录中</li></ul></div><p>查看 <code>Hexo</code> 原生处理代码块的逻辑 <sup><a href="#refer-4">(4)</a></sup>：</p><figure class="highlight js"><figcaption><span>register</span><a href="https://github.com/hexojs/hexo/blob/master/lib/plugins/tag/index.ts">plugins/tag/index.ts</a></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> code = <span class="built_in">require</span>(<span class="string">'./code'</span>)(ctx);</span><br><span class="line"></span><br><span class="line">tag.<span class="title function_">register</span>(<span class="string">'code'</span>, code, <span class="literal">true</span>);</span><br><span class="line">tag.<span class="title function_">register</span>(<span class="string">'codeblock'</span>, code, <span class="literal">true</span>);</span><br></pre></td></tr></tbody></table></figure><p>在 <code>code</code> 模块中，先对传入的参数进行了解析，然后再调用 <code>hexo-utils</code> 的 <code>highlight</code> 进行渲染：</p><figure class="highlight js"><figcaption><span>code</span><a href="https://github.com/hexojs/hexo/blob/master/lib/plugins/tag/code.ts">plugins/tag/code.ts</a></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">parseArgs</span>(<span class="params">args: string[]</span>): <span class="title class_">HighlightOptions</span> {</span><br><span class="line">  ......</span><br><span class="line">  <span class="keyword">return</span> {</span><br><span class="line">    lang,</span><br><span class="line">    language_attr,</span><br><span class="line">    firstLine,</span><br><span class="line">    caption,</span><br><span class="line">    line_number,</span><br><span class="line">    line_threshold,</span><br><span class="line">    mark,</span><br><span class="line">    wrap</span><br><span class="line">  };</span><br><span class="line">}</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function"><span class="params">ctx</span> =&gt;</span> <span class="keyword">function</span> <span class="title function_">codeTag</span>(<span class="params">args, content</span>) {</span><br><span class="line">    ......</span><br><span class="line">    <span class="keyword">const</span> options = <span class="title function_">parseArgs</span>(args);</span><br><span class="line">    options.<span class="property">lines_length</span> = content.<span class="title function_">split</span>(<span class="string">'\n'</span>).<span class="property">length</span>;</span><br><span class="line">    content = ctx.<span class="property">extend</span>.<span class="property">highlight</span>.<span class="title function_">exec</span>(ctx.<span class="property">config</span>.<span class="property">syntax_highlighter</span>, {</span><br><span class="line">        <span class="attr">context</span>: ctx,</span><br><span class="line">        <span class="attr">args</span>: [content, options]</span><br><span class="line">    });</span><br><span class="line">    <span class="keyword">return</span> content.<span class="title function_">replace</span>(<span class="regexp">/{/g</span>, <span class="string">'&amp;#123;'</span>).<span class="title function_">replace</span>(<span class="regexp">/}/g</span>, <span class="string">'&amp;#125;'</span>);</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><p>所以我们可以在返回 <code>content</code> 之前对其进行处理，处理的逻辑与前一种方法是类似的，首先导入所需要的模块：</p><figure class="highlight js"><figcaption><span>import</span><a href="https://gist.githubusercontent.com/YiHui-Liu/35d2f3b7e2665c0995e18e1f998ed122/raw/caf17c5dc07da5583eae8b9f80d961ddc27a7588/typst.js">typst.js</a></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hljs = <span class="built_in">require</span>(<span class="string">'highlight.js'</span>);</span><br><span class="line"><span class="keyword">const</span> highlight = <span class="built_in">require</span>(<span class="string">'hexo-util'</span>).<span class="property">highlight</span>;</span><br><span class="line"><span class="keyword">const</span> typstBunlde = <span class="built_in">require</span>(<span class="string">'./typst.bundle'</span>);</span><br></pre></td></tr></tbody></table></figure><p>然后获取 <code>highlight</code> 处理过后的代码块：</p><figure class="highlight js"><figcaption><span>highlight process</span><a href="https://gist.githubusercontent.com/YiHui-Liu/35d2f3b7e2665c0995e18e1f998ed122/raw/caf17c5dc07da5583eae8b9f80d961ddc27a7588/typst.js">typst.js</a></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">codeTypst</span> = (<span class="params">args, content</span>) =&gt; {</span><br><span class="line">    <span class="keyword">const</span> options = <span class="title function_">parseArgs</span>(args);</span><br><span class="line">    options.<span class="property">lines_length</span> = content.<span class="title function_">split</span>(<span class="string">'\n'</span>).<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> line_threshold = options.<span class="property">line_threshold</span> || <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> shouldUseLineNumbers = options.<span class="property">line_number</span>;</span><br><span class="line">    <span class="keyword">const</span> surpassesLineThreshold = options.<span class="property">lines_length</span> &gt; line_threshold;</span><br><span class="line">    <span class="keyword">const</span> gutter = shouldUseLineNumbers &amp;&amp; surpassesLineThreshold;</span><br><span class="line">    <span class="keyword">const</span> hljsOptions = {</span><br><span class="line">        <span class="attr">caption</span>: options.<span class="property">caption</span>,</span><br><span class="line">        <span class="attr">firstLine</span>: options.<span class="property">firstLine</span>,</span><br><span class="line">        gutter,</span><br><span class="line">        <span class="attr">mark</span>: options.<span class="property">mark</span>,</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> contentHljs = <span class="title function_">highlight</span>(content, hljsOptions);</span><br><span class="line">    contentHljs = contentHljs.<span class="title function_">replace</span>(<span class="regexp">/{/g</span>, <span class="string">'&amp;#123;'</span>).<span class="title function_">replace</span>(<span class="regexp">/}/g</span>, <span class="string">'&amp;#125;'</span>);</span><br><span class="line">    ......</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>然后注册 <code>Typst</code> 语言，并提取代码进行处理：</p><figure class="highlight js"><figcaption><span>extract and process</span><a href="https://gist.githubusercontent.com/YiHui-Liu/35d2f3b7e2665c0995e18e1f998ed122/raw/caf17c5dc07da5583eae8b9f80d961ddc27a7588/typst.js">typst.js</a></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">codeTypst</span> = (<span class="params">args, content</span>) =&gt; {</span><br><span class="line">    ......</span><br><span class="line">    <span class="keyword">return</span> typstBunlde.<span class="property">parserModule</span>.<span class="title function_">then</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">        hljs.<span class="title function_">registerLanguage</span>(</span><br><span class="line">            <span class="string">'typst'</span>,</span><br><span class="line">            typstBunlde.<span class="title function_">hljsTypst</span>({</span><br><span class="line">                <span class="attr">codeBlockDefaultLanguage</span>: <span class="string">'typst'</span>,</span><br><span class="line">            }),</span><br><span class="line">        )</span><br><span class="line">    }).<span class="title function_">then</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="keyword">var</span> re = <span class="regexp">/&lt;td class="code"&gt;&lt;pre&gt;(.+)&lt;\/pre&gt;&lt;\/td&gt;/i</span>;</span><br><span class="line">        <span class="keyword">var</span> code = hljs.<span class="title function_">highlight</span>(content, {<span class="attr">language</span>: <span class="string">'typst'</span>}).<span class="property">value</span>;</span><br><span class="line">        contentHljs = contentHljs.<span class="title function_">replace</span>(<span class="string">"highlight plaintext"</span>, <span class="string">"highlight typst"</span>)</span><br><span class="line">        <span class="keyword">return</span> contentHljs.<span class="title function_">replace</span>(re, <span class="string">`&lt;td class="code"&gt;&lt;pre&gt;<span class="subst">${code}</span>&lt;/pre&gt;&lt;/td&gt;`</span>);</span><br><span class="line">    });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>最后在 <code>Hexo</code> 中注册这个标签插件，由于注册 <code>Typst</code> 语言并处理的过程是异步的，所以这里也要开启异步选项：</p><figure class="highlight js"><figcaption><span>register with async</span><a href="https://gist.githubusercontent.com/YiHui-Liu/35d2f3b7e2665c0995e18e1f998ed122/raw/caf17c5dc07da5583eae8b9f80d961ddc27a7588/typst.js">typst.js</a></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo.<span class="property">extend</span>.<span class="property">tag</span>.<span class="title function_">register</span>(<span class="string">'typst'</span>, codeTypst, {<span class="attr">ends</span>: <span class="literal">true</span>, <span class="attr">async</span>: <span class="literal">true</span>});</span><br></pre></td></tr></tbody></table></figure><h2 id="示例">示例 <a class="header-anchor" href="#示例">¶</a></h2><h3 id="使用方法">使用方法 <a class="header-anchor" href="#使用方法">¶</a></h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Typst Code block tag</span></span><br><span class="line"><span class="comment"> * Syntax:</span></span><br><span class="line"><span class="comment"> * {% typst [options] %}</span></span><br><span class="line"><span class="comment"> * code snippet</span></span><br><span class="line"><span class="comment"> * {% endtypst %}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">String</span>} title Caption text</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">String</span>} url Source link</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">String</span>} link_text Text of the link</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">Object</span>} line_number Show line number, value must be a boolean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">Object</span>} first_line Specify the first line number, value must be a number</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">Object</span>} mark Line highlight specific line(s), each value separated by a comma. Specify number range using a dash</span></span><br><span class="line"><span class="comment"> * Example: `mark:1,4-7,10` will mark line 1, 4 to 7 and 10.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> {<span class="type">String</span>} Code snippet with code highlighting</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure><h3 id="预览">预览 <a class="header-anchor" href="#预览">¶</a></h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">{% typst %}</span><br><span class="line">#import "@preview/tablex:0.0.6": tablex, rowspanx, colspanx, hlinex, vlinex</span><br><span class="line"></span><br><span class="line">#let three-line-table(columns, headers, contents, caption, lang: "en",rows: auto) = {figure(</span><br><span class="line">  tablex(</span><br><span class="line">    columns: columns,</span><br><span class="line">    rows: rows,</span><br><span class="line">    align: center + horizon,</span><br><span class="line">    auto-lines: false,</span><br><span class="line">    repeat-header: true,</span><br><span class="line">    hlinex(stroke: 1.5pt),</span><br><span class="line">    ..headers,</span><br><span class="line">    hlinex(stroke: 0.75pt),</span><br><span class="line">    ..contents,</span><br><span class="line">    hlinex(stroke: 1.5pt),</span><br><span class="line">  ),</span><br><span class="line">  kind: table,</span><br><span class="line">  supplement: [#if (lang == "en") {"Table"} else {"表"}],</span><br><span class="line">  caption: caption,</span><br><span class="line">)}</span><br><span class="line">{% endtypst %}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight typst"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="keyword">#</span><span class="keyword">import</span> <span class="string">"@preview/tablex:0.0.6"</span><span class="punctuation">:</span> <span class="variable">tablex</span><span class="punctuation">,</span> <span class="variable">rowspanx</span><span class="punctuation">,</span> <span class="variable">colspanx</span><span class="punctuation">,</span> <span class="variable">hlinex</span><span class="punctuation">,</span> <span class="variable">vlinex</span><span class="keyword">#</span><span class="keyword">let</span> <span class="title function_">three-line-table</span><span class="punctuation">(</span><span class="variable">columns</span><span class="punctuation">,</span> <span class="variable">headers</span><span class="punctuation">,</span> <span class="variable">contents</span><span class="punctuation">,</span> <span class="variable">caption</span><span class="punctuation">,</span> <span class="variable">lang</span><span class="punctuation">:</span> <span class="string">"en"</span><span class="punctuation">,</span><span class="variable">rows</span><span class="punctuation">:</span> <span class="keyword">auto</span><span class="punctuation">)</span> <span class="operator">=</span> <span class="punctuation">{</span><span class="title function_">figure</span><span class="punctuation">(</span>  <span class="title function_">tablex</span><span class="punctuation">(</span>    <span class="variable">columns</span><span class="punctuation">:</span> <span class="variable">columns</span><span class="punctuation">,</span>    <span class="variable">rows</span><span class="punctuation">:</span> <span class="variable">rows</span><span class="punctuation">,</span>    <span class="variable">align</span><span class="punctuation">:</span> <span class="variable">center</span> <span class="operator">+</span> <span class="variable">horizon</span><span class="punctuation">,</span>    <span class="variable">auto-lines</span><span class="punctuation">:</span> <span class="literal">false</span><span class="punctuation">,</span>    <span class="variable">repeat-header</span><span class="punctuation">:</span> <span class="literal">true</span><span class="punctuation">,</span>    <span class="title function_">hlinex</span><span class="punctuation">(</span><span class="variable">stroke</span><span class="punctuation">:</span> <span class="number">1.5pt</span><span class="punctuation">)</span><span class="punctuation">,</span>    <span class="operator">..</span><span class="variable">headers</span><span class="punctuation">,</span>    <span class="title function_">hlinex</span><span class="punctuation">(</span><span class="variable">stroke</span><span class="punctuation">:</span> <span class="number">0.75pt</span><span class="punctuation">)</span><span class="punctuation">,</span>    <span class="operator">..</span><span class="variable">contents</span><span class="punctuation">,</span>    <span class="title function_">hlinex</span><span class="punctuation">(</span><span class="variable">stroke</span><span class="punctuation">:</span> <span class="number">1.5pt</span><span class="punctuation">)</span><span class="punctuation">,</span>  <span class="punctuation">)</span><span class="punctuation">,</span>  <span class="variable">kind</span><span class="punctuation">:</span> <span class="variable">table</span><span class="punctuation">,</span>  <span class="variable">supplement</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="keyword">#</span><span class="keyword">if</span> <span class="punctuation">(</span><span class="variable">lang</span> <span class="operator">==</span> <span class="string">"en"</span><span class="punctuation">)</span> <span class="punctuation">{</span><span class="string">"Table"</span><span class="punctuation">}</span> <span class="keyword">else</span> <span class="punctuation">{</span><span class="string">"表"</span><span class="punctuation">}</span><span class="punctuation">]</span><span class="punctuation">,</span>  <span class="variable">caption</span><span class="punctuation">:</span> <span class="variable">caption</span><span class="punctuation">,</span><span class="punctuation">)</span><span class="punctuation">}</span></pre></td></tr></tbody></table></figure><h2 id="参考资料">参考资料 <a class="header-anchor" href="#参考资料">¶</a></h2><ol><li><span id="refer-1"><a href="https://www.el42.cc/posts/hugo-typst-highlight/">在 Hugo 中为 Typst 配置语法高亮（PaperMod 主题）</a></span></li><li><span id="refer-2"><a href="https://hexo.io/zh-cn/api/tag">标签插件（Tag）</a></span></li><li><span id="refer-3"><a href="https://github.com/Myriad-Dreamin/typst.ts/tree/main/projects/highlighter">highlighter</a></span></li><li><span id="refer-4"><a href="https://hexo.io/zh-cn/docs/syntax-highlight.html">代码高亮</a></span></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;code&gt;Hexo&lt;/code&gt; 处理的代码块会被包裹在 &lt;code&gt;figure table tbody tr &amp;gt; td.code pre&lt;/code&gt; 中，每一行代码又被 &lt;code&gt;span&lt;/code&gt; 包裹，如果需要加入对 &lt;code&gt;Typst&lt;/cod</summary>
      
    
    
    
    <category term="软件/程序" scheme="https://foolishfox.cn/categories/%E8%BD%AF%E4%BB%B6-%E7%A8%8B%E5%BA%8F/"/>
    
    
    <category term="教程" scheme="https://foolishfox.cn/tags/%E6%95%99%E7%A8%8B/"/>
    
    <category term="typst" scheme="https://foolishfox.cn/tags/typst/"/>
    
  </entry>
  
  <entry>
    <title>微信聊天记录分析：去年和你的猪聊了什么？</title>
    <link href="https://foolishfox.cn/posts/202402-WeChatMsgAnalysis.html"/>
    <id>https://foolishfox.cn/posts/202402-WeChatMsgAnalysis.html</id>
    <published>2024-02-01T02:58:56.000Z</published>
    <updated>2024-02-04T03:53:00.000Z</updated>
    
    <content type="html"><![CDATA[<div class="note danger flat"><p><strong>评论不填写邮箱，将收不到回复通知</strong></p></div><div class="note warning flat"><p><strong>多图预警</strong></p></div><div class="note info flat"><p><code>ipynb</code> 文件<strong>最好从上往下依次运行，不要回过头来重新搞</strong>，获取方式：</p><ul><li>在 <a href="https://colab.research.google.com/drive/1hbvPPUOnW88CgQtwKNEa1Rzh7s5aOGHv?usp=sharing">Google Colab</a> 使用在线环境运行（推荐）</li><li>下载 <a href="https://gist.github.com/YiHui-Liu/1ed2f9484c5e20587d016e5d7854c273">ipynb 文件</a> 直接运行</li><li>下载 <a href="https://api.foolishfox.cn/msg.zip">运行所需文件</a></li></ul></div><h2 id="准备">准备 <a class="header-anchor" href="#准备">¶</a></h2><h3 id="导出聊天记录">导出聊天记录 <a class="header-anchor" href="#导出聊天记录">¶</a></h3><p>依照 <a href="https://github.com/LC044/WeChatMsg">WeChatMsg</a> 的教程导出 <code>csv</code> 文件，只需要导出文本即可。</p><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/02/01/65bb125a50b43.png" alt="图1 导出聊天记录" style="height:200px;"></div><span class="image-caption">图 1 导出聊天记录</span></div><h3 id="安装所需包">安装所需包 <a class="header-anchor" href="#安装所需包">¶</a></h3><p>推荐在虚拟环境中安装。</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install numpy seaborn pandas wordcloud tqdm paddlepaddle paddlenlp</span><br></pre></td></tr></tbody></table></figure><h3 id="引入包">引入包 <a class="header-anchor" href="#引入包">¶</a></h3><ul><li>pandas: 基础数据框架</li><li> matplotlib &amp; seaborn: 绘图</li><li> jieba: 中文分词</li><li> wordcloud: 词云</li><li> paddlenlp: 情感分析 </li></ul><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"><span class="keyword">import</span> jieba.posseg <span class="keyword">as</span> pseg</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> wordcloud <span class="keyword">import</span> WordCloud</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="keyword">import</span> matplotlib.ticker <span class="keyword">as</span> mticker</span><br><span class="line"><span class="keyword">import</span> matplotlib.transforms <span class="keyword">as</span> mtransforms</span><br><span class="line"><span class="keyword">from</span> matplotlib.colors <span class="keyword">import</span> ListedColormap</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> font_manager <span class="keyword">as</span> fm</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> paddlenlp <span class="keyword">import</span> Taskflow</span><br></pre></td></tr></tbody></table></figure><h3 id="绘图设置">绘图设置 <a class="header-anchor" href="#绘图设置">¶</a></h3><ul><li><code>font</code>: 字体路径，至少支持中文，最好同时支持中文和 emoji</li></ul><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sns.set_theme(style=<span class="string">"ticks"</span>)</span><br><span class="line">font = <span class="string">"/usr/share/fonts/winfont/simsun.ttc"</span></span><br><span class="line">fp = fm.FontProperties(fname=font)</span><br><span class="line">plt.rcParams[<span class="string">"axes.unicode_minus"</span>] = <span class="literal">False</span></span><br></pre></td></tr></tbody></table></figure><h3 id="人名标签">人名标签 <a class="header-anchor" href="#人名标签">¶</a></h3><p>在这里修改双方的称呼：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">labels = [<span class="string">"LL"</span>, <span class="string">"FF"</span>]</span><br></pre></td></tr></tbody></table></figure><h3 id="数据读取">数据读取 <a class="header-anchor" href="#数据读取">¶</a></h3><ul><li><code>filePath</code>: 消息记录文件的路径</li><li><code>dStart</code>: 开始的时间</li><li><code>dEnd</code>: 结束的时间 </li></ul><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">filePath = <span class="string">"msg.csv"</span></span><br><span class="line">dStart = <span class="string">"2023-01-01 00:00:00"</span></span><br><span class="line">dEnd = <span class="string">"2023-12-31 23:59:59"</span></span><br><span class="line"></span><br><span class="line">df = pd.read_csv(filePath, encoding=<span class="string">"utf-8"</span>)</span><br><span class="line">df = df.query(</span><br><span class="line">    <span class="string">"CreateTime &gt;= {:d} and CreateTime &lt;= {:d}"</span>.<span class="built_in">format</span>(</span><br><span class="line">        <span class="built_in">int</span>(time.mktime(time.strptime(dStart, <span class="string">"%Y-%m-%d %H:%M:%S"</span>))),</span><br><span class="line">        <span class="built_in">int</span>(time.mktime(time.strptime(dEnd, <span class="string">"%Y-%m-%d %H:%M:%S"</span>))),</span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">df.loc[:, <span class="string">"StrTime"</span>] = pd.to_datetime(df[<span class="string">"StrTime"</span>])</span><br><span class="line">df.loc[:, <span class="string">"day"</span>] = df[<span class="string">"StrTime"</span>].dt.dayofweek</span><br><span class="line">df.loc[:, <span class="string">"hour"</span>] = df[<span class="string">"StrTime"</span>].dt.hour</span><br><span class="line">df.loc[:, <span class="string">"Count"</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果出错就用</span></span><br><span class="line">df[<span class="string">"StrTime"</span>] = pd.to_datetime(df[<span class="string">"StrTime"</span>])</span><br><span class="line">df[<span class="string">"day"</span>] = df[<span class="string">"StrTime"</span>].dt.dayofweek</span><br><span class="line">df[<span class="string">"hour"</span>] = df[<span class="string">"StrTime"</span>].dt.hour</span><br><span class="line">df[<span class="string">"Count"</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">dfs = [df.query(<span class="string">"IsSender == 0"</span>), df.query(<span class="string">"IsSender == 1"</span>)]</span><br></pre></td></tr></tbody></table></figure><h3 id="消息过滤">消息过滤 <a class="header-anchor" href="#消息过滤">¶</a></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">textFilter</span>(<span class="params">text: <span class="built_in">str</span></span>):</span><br><span class="line">    text = text.lower()</span><br><span class="line">    <span class="comment"># 过滤 emoji</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        co = re.<span class="built_in">compile</span>(<span class="string">"[\U00010000-\U0010ffff]"</span>)</span><br><span class="line">    <span class="keyword">except</span> re.error:</span><br><span class="line">        co = re.<span class="built_in">compile</span>(<span class="string">"[\uD800-\uDBFF][\uDC00-\uDFFF]"</span>)</span><br><span class="line">    text = co.sub(<span class="string">" "</span>, text)</span><br><span class="line">    <span class="comment"># 过滤微信表情</span></span><br><span class="line">    co = re.<span class="built_in">compile</span>(<span class="string">"\[[\u4e00-\u9fa5]+\]"</span>)</span><br><span class="line">    <span class="keyword">return</span> co.sub(<span class="string">" "</span>, text)</span><br><span class="line"></span><br><span class="line">texts = [</span><br><span class="line">    [textFilter(i) <span class="keyword">for</span> i <span class="keyword">in</span> dfs[<span class="number">0</span>].query(<span class="string">"Type == 1"</span>)[<span class="string">"StrContent"</span>].to_list()],</span><br><span class="line">    [textFilter(i) <span class="keyword">for</span> i <span class="keyword">in</span> dfs[<span class="number">1</span>].query(<span class="string">"Type == 1"</span>)[<span class="string">"StrContent"</span>].to_list()],</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure><h2 id="消息频率分析">消息频率分析 <a class="header-anchor" href="#消息频率分析">¶</a></h2><h3 id="类型分析">类型分析 <a class="header-anchor" href="#类型分析">¶</a></h3><p>根据消息的类型进行分类，可以看出喜欢发送的消息类型，同时也可以看出谁发的多</p><ul><li>1 = Text</li><li>3 = Image</li><li>34 = Voice</li><li>43 = Video</li><li>47 = Sticker</li><li>48 = Location</li><li>10000 = System</li></ul><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">data = {}</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    data[labels[i]] = [</span><br><span class="line">        <span class="built_in">len</span>(dfs[i].query(<span class="string">"Type == 1"</span>)),</span><br><span class="line">        <span class="built_in">len</span>(dfs[i].query(<span class="string">"Type == 3"</span>)),</span><br><span class="line">        <span class="built_in">len</span>(dfs[i].query(<span class="string">"Type == 34"</span>)),</span><br><span class="line">        <span class="built_in">len</span>(dfs[i].query(<span class="string">"Type == 43"</span>)),</span><br><span class="line">        <span class="built_in">len</span>(dfs[i].query(<span class="string">"Type == 47"</span>)),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">data = (</span><br><span class="line">    pd.DataFrame(data, index=[<span class="string">"Text"</span>, <span class="string">"Image"</span>, <span class="string">"Voice"</span>, <span class="string">"Video"</span>, <span class="string">"Sticker"</span>])</span><br><span class="line">    .reset_index()</span><br><span class="line">    .melt(<span class="string">"index"</span>)</span><br><span class="line">    .rename(columns={<span class="string">"index"</span>: <span class="string">"Type"</span>, <span class="string">"variable"</span>: <span class="string">"Person"</span>, <span class="string">"value"</span>: <span class="string">"Count"</span>})</span><br><span class="line">)</span><br><span class="line">g = sns.catplot(data, kind=<span class="string">"bar"</span>, x=<span class="string">"Type"</span>, y=<span class="string">"Count"</span>, hue=<span class="string">"Person"</span>, palette=<span class="string">"dark"</span>, alpha=<span class="number">0.6</span>, height=<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ax <span class="keyword">in</span> g.axes.ravel():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">        ax.bar_label(ax.containers[i], fontsize=<span class="number">9</span>)</span><br><span class="line">sns.move_legend(g, <span class="string">"upper right"</span>)</span><br><span class="line">plt.yscale(<span class="string">"log"</span>)</span><br><span class="line"></span><br><span class="line">g.figure.set_size_inches(<span class="number">6</span>, <span class="number">5</span>)</span><br><span class="line">g.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></tbody></table></figure><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/02/01/65bb1395f1d68.png" alt="图2 消息类型" style="height:300px;"></div><span class="image-caption">图 2 消息类型</span></div><h3 id="消息长度分析">消息长度分析 <a class="header-anchor" href="#消息长度分析">¶</a></h3><ul><li><code>sN</code>: 设置显示范围：</li></ul><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>μ</mi><mo>+</mo><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">N</mi></mrow><mo>∗</mo><mi>σ</mi></mrow><annotation encoding="application/x-tex">\mu + \mathrm{sN} * \sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">μ</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathrm">s</span><span class="mord mathrm">N</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span></span></span></span></span></p><ul><li><code>multiple</code>: 直方图堆叠格式 </li></ul><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">sN = <span class="number">3</span></span><br><span class="line">multiple = <span class="string">"dodge"</span></span><br><span class="line"></span><br><span class="line">mu, std = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">data = {<span class="string">"Length"</span>: [], <span class="string">"Person"</span>: []}</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    length = [<span class="built_in">len</span>(textFilter(i)) <span class="keyword">for</span> i <span class="keyword">in</span> texts[i]]</span><br><span class="line">    data[<span class="string">"Length"</span>] += length</span><br><span class="line">    data[<span class="string">"Person"</span>] += [labels[i]] * <span class="built_in">len</span>(length)</span><br><span class="line">    <span class="keyword">if</span> np.mean(length) + sN * np.std(length) &gt; mu + std:</span><br><span class="line">        mu, std = np.mean(length), np.std(length)</span><br><span class="line">xlim = <span class="built_in">int</span>(np.ceil(mu + sN * std))</span><br><span class="line"></span><br><span class="line">data = pd.DataFrame(data)</span><br><span class="line">bins = np.linspace(<span class="number">0</span>, xlim, xlim + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">ax = sns.histplot(</span><br><span class="line">    data=data,</span><br><span class="line">    x=<span class="string">"Length"</span>,</span><br><span class="line">    hue=<span class="string">"Person"</span>,</span><br><span class="line">    bins=bins,</span><br><span class="line">    multiple=multiple,</span><br><span class="line">    edgecolor=<span class="string">".3"</span>,</span><br><span class="line">    linewidth=<span class="number">0.5</span>,</span><br><span class="line">    palette=<span class="string">"dark"</span>,</span><br><span class="line">    alpha=<span class="number">0.6</span>,</span><br><span class="line">)</span><br><span class="line">ax.set_xlim(<span class="number">0</span>, xlim)</span><br><span class="line">ax.set_xlabel(<span class="string">"Length of Message"</span>)</span><br><span class="line"></span><br><span class="line">ax.figure.set_size_inches(<span class="number">8</span>, <span class="number">4</span>)</span><br><span class="line">ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></tbody></table></figure><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/02/01/65bb141cd3165.png" alt="图3 消息长度" style="height:300px;"></div><span class="image-caption">图 3 消息长度</span></div><h3 id="每日活跃分析">每日活跃分析 <a class="header-anchor" href="#每日活跃分析">¶</a></h3><p>划分每日 24 小时内每小时发送的消息数，可以得知每天的活跃的时间段</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">data = {<span class="string">"Time"</span>: [], <span class="string">"Person"</span>: []}</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    hour = dfs[i][<span class="string">"hour"</span>].to_list()</span><br><span class="line">    data[<span class="string">"Time"</span>] += hour</span><br><span class="line">    data[<span class="string">"Person"</span>] += [labels[i]] * <span class="built_in">len</span>(hour)</span><br><span class="line"></span><br><span class="line">data = pd.DataFrame(data)</span><br><span class="line">bins = np.arange(<span class="number">0</span>, <span class="number">25</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">ax = sns.histplot(</span><br><span class="line">    data=data,</span><br><span class="line">    x=<span class="string">"Time"</span>,</span><br><span class="line">    hue=<span class="string">"Person"</span>,</span><br><span class="line">    bins=bins,</span><br><span class="line">    multiple=multiple,</span><br><span class="line">    edgecolor=<span class="string">".3"</span>,</span><br><span class="line">    linewidth=<span class="number">0.5</span>,</span><br><span class="line">    palette=<span class="string">"dark"</span>,</span><br><span class="line">    alpha=<span class="number">0.6</span>,</span><br><span class="line">)</span><br><span class="line">ax.set_xticks(bins)</span><br><span class="line">ax.set_xticklabels(bins)</span><br><span class="line">ax.set_xlabel(<span class="string">"Hour"</span>)</span><br><span class="line">ax.set_xlim(<span class="number">0</span>, <span class="number">24</span>)</span><br><span class="line">sns.move_legend(ax, loc=<span class="string">"upper center"</span>, bbox_to_anchor=(<span class="number">0.5</span>, <span class="number">1.2</span>), ncol=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">ax.figure.set_size_inches(<span class="number">8</span>, <span class="number">4</span>)</span><br><span class="line">ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></tbody></table></figure><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/02/01/65bb14564b8de.png" alt="图4 每日活跃时间" style="height:300px;"></div><span class="image-caption">图 4 每日活跃时间</span></div><h3 id="每周活跃分析">每周活跃分析 <a class="header-anchor" href="#每周活跃分析">¶</a></h3><p>查看一周内从周一到周日每天发送的消息数</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">grouper = pd.Grouper(key=<span class="string">"day"</span>)</span><br><span class="line">data = df.groupby(grouper)[<span class="string">"Count"</span>].<span class="built_in">sum</span>()</span><br><span class="line">data = data.sort_index()</span><br><span class="line">data.index = [<span class="string">"Mon"</span>, <span class="string">"Tue"</span>, <span class="string">"Wed"</span>, <span class="string">"Thu"</span>, <span class="string">"Fri"</span>, <span class="string">"Sat"</span>, <span class="string">"Sun"</span>]</span><br><span class="line"></span><br><span class="line">ax = sns.barplot(data=data, errorbar=<span class="literal">None</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">"Weekday"</span>)</span><br><span class="line">ax.bar_label(ax.containers[<span class="number">0</span>], fontsize=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">ax.figure.set_size_inches(<span class="number">5</span>, <span class="number">5</span>)</span><br><span class="line">ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></tbody></table></figure><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/02/01/65bb149541466.png" alt="图5 每周活跃分析" style="height:300px;"></div><span class="image-caption">图 5 每周活跃分析</span></div><h3 id="按周划分年度活跃分析">按周划分年度活跃分析 <a class="header-anchor" href="#按周划分年度活跃分析">¶</a></h3><p>划分每 7 天内发送的消息数，可以得知每周的活跃的时间段</p><ul><li><code>wTicks</code>: 每个刻度相差的数值</li></ul><div class="note warning flat"><p><strong>请注意此处修改：</strong></p><ul><li><code>wStart</code>: <strong>当年</strong>或者<strong>聊天开始日期之后</strong>第一个周一的日期</li><li><code>wEnd</code>: <strong>次年</strong>或者<strong>聊天结束日期之后</strong>第一个周一的日期 </li></ul></div><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">wTicks = <span class="number">500</span></span><br><span class="line">wStart = <span class="string">"2023-01-02"</span></span><br><span class="line">wEnd = <span class="string">"2024-01-01"</span></span><br><span class="line"></span><br><span class="line">grouper = pd.Grouper(key=<span class="string">"StrTime"</span>, freq=<span class="string">"W-MON"</span>)</span><br><span class="line">data = df.groupby(grouper)[<span class="string">"Count"</span>].<span class="built_in">sum</span>().to_frame()</span><br><span class="line">data.index = pd.date_range(start=wStart, end=wEnd, freq=<span class="string">"W-MON"</span>).strftime(<span class="string">"%m-%d"</span>)</span><br><span class="line">data.columns = [<span class="string">"Count"</span>]</span><br><span class="line"></span><br><span class="line">vM = np.ceil(data[<span class="string">"Count"</span>].<span class="built_in">max</span>() / wTicks) * wTicks</span><br><span class="line">norm = plt.Normalize(<span class="number">0</span>, vM)</span><br><span class="line">sm = plt.cm.ScalarMappable(cmap=<span class="string">"Reds"</span>, norm=norm)</span><br><span class="line"></span><br><span class="line">ax = sns.barplot(x=data.index, y=data[<span class="string">"Count"</span>], hue=data[<span class="string">"Count"</span>], hue_norm=norm, palette=<span class="string">"Reds"</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">"Date"</span>)</span><br><span class="line">plt.xticks(rotation=<span class="number">60</span>)</span><br><span class="line"><span class="keyword">for</span> bar <span class="keyword">in</span> ax.containers:</span><br><span class="line">    ax.bar_label(bar, fontsize=<span class="number">10</span>, fmt=<span class="string">"%.0f"</span>)</span><br><span class="line">ax.get_legend().remove()</span><br><span class="line"></span><br><span class="line">axpos = ax.get_position()</span><br><span class="line">caxpos = mtransforms.Bbox.from_extents(axpos.x1 + <span class="number">0.02</span>, axpos.y0, axpos.x1 + <span class="number">0.03</span>, axpos.y1)</span><br><span class="line">cax = ax.figure.add_axes(caxpos)</span><br><span class="line"></span><br><span class="line">locator = mticker.MultipleLocator(wTicks)</span><br><span class="line">formatter = mticker.StrMethodFormatter(<span class="string">"{x:.0f}"</span>)</span><br><span class="line">cax.figure.colorbar(sm, cax=cax, ticks=locator, <span class="built_in">format</span>=formatter)</span><br><span class="line"></span><br><span class="line">ax.figure.set_size_inches(<span class="number">20</span>, <span class="number">8</span>)</span><br><span class="line">ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></tbody></table></figure><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/02/01/65bb14cd53593.png" alt="图5 按周划分年度活跃分析" style="height:300px;"></div><span class="image-caption">图 5 按周划分年度活跃分析</span></div><h3 id="按周划分聊天热情分析">按周划分聊天热情分析 <a class="header-anchor" href="#按周划分聊天热情分析">¶</a></h3><p>划分每 7 天内的聊天热情指数，聊天热情指数为发送的消息数减去收到的消息数与总消息数的比值：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>E</mi><mo>=</mo><mfrac><mrow><msub><mi>Q</mi><mi mathvariant="normal">S</mi></msub><mo>−</mo><msub><mi>Q</mi><mi mathvariant="normal">R</mi></msub></mrow><mrow><msub><mi>Q</mi><mi mathvariant="normal">S</mi></msub><mo>+</mo><msub><mi>Q</mi><mi mathvariant="normal">R</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">E = \frac{Q_\mathrm{S} - Q_\mathrm{R}}{Q_\mathrm{S} + Q_\mathrm{R}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.24077em;vertical-align:-0.8804400000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603299999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">S</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">R</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">S</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">R</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">grouper = pd.Grouper(key=<span class="string">"StrTime"</span>, freq=<span class="string">"W-MON"</span>)</span><br><span class="line">df_W1 = dfs[<span class="number">0</span>].groupby(grouper)[<span class="string">"Count"</span>].<span class="built_in">sum</span>()</span><br><span class="line">df_W2 = dfs[<span class="number">1</span>].groupby(grouper)[<span class="string">"Count"</span>].<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line">data = pd.DataFrame({<span class="string">"E"</span>: (df_W1 - df_W2) / (df_W1 + df_W2)})</span><br><span class="line">data.index = pd.date_range(start=wStart, end=wEnd, freq=<span class="string">"W-MON"</span>).strftime(<span class="string">"%m-%d"</span>)</span><br><span class="line"></span><br><span class="line">vM = data[<span class="string">"E"</span>].<span class="built_in">abs</span>().<span class="built_in">max</span>()</span><br><span class="line">norm = plt.Normalize(-vM, vM)</span><br><span class="line">sm = plt.cm.ScalarMappable(cmap=<span class="string">"coolwarm"</span>, norm=norm)</span><br><span class="line"></span><br><span class="line">ax = sns.barplot(x=data.index, y=data[<span class="string">"E"</span>], hue=data[<span class="string">"E"</span>], hue_norm=norm, palette=<span class="string">"coolwarm"</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">"Date"</span>)</span><br><span class="line">plt.xticks(rotation=<span class="number">60</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">"Enthusiasm Index"</span>)</span><br><span class="line"><span class="keyword">for</span> bar <span class="keyword">in</span> ax.containers:</span><br><span class="line">    ax.bar_label(bar, fontsize=<span class="number">10</span>, fmt=<span class="string">"%.2f"</span>)</span><br><span class="line">ax.get_legend().remove()</span><br><span class="line"></span><br><span class="line">axpos = ax.get_position()</span><br><span class="line">caxpos = mtransforms.Bbox.from_extents(axpos.x1 + <span class="number">0.02</span>, axpos.y0, axpos.x1 + <span class="number">0.03</span>, axpos.y1)</span><br><span class="line">cax = ax.figure.add_axes(caxpos)</span><br><span class="line"></span><br><span class="line">locator = mticker.MultipleLocator(<span class="number">0.1</span>)</span><br><span class="line">formatter = mticker.StrMethodFormatter(<span class="string">"{x:.1f}"</span>)</span><br><span class="line">cax.figure.colorbar(sm, cax=cax, ticks=locator, <span class="built_in">format</span>=formatter)</span><br><span class="line"></span><br><span class="line">ax.figure.set_size_inches(<span class="number">20</span>, <span class="number">8</span>)</span><br><span class="line">ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></tbody></table></figure><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/02/01/65bb150cdc34d.png" alt="图6 按周划分聊天热情分析" style="height:300px;"></div><span class="image-caption">图 6 按周划分聊天热情分析</span></div><h3 id="按日划分年度活跃分析">按日划分年度活跃分析 <a class="header-anchor" href="#按日划分年度活跃分析">¶</a></h3><p>以热力图的方式展示按日划分的年度活跃情况</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">grouper = pd.Grouper(key=<span class="string">"StrTime"</span>, freq=<span class="string">"D"</span>)</span><br><span class="line">data = df.groupby(grouper)[<span class="string">"Count"</span>].<span class="built_in">sum</span>()</span><br><span class="line">data = data.to_frame()</span><br><span class="line"></span><br><span class="line">data[<span class="string">"date"</span>] = data.index</span><br><span class="line">data[<span class="string">"week"</span>] = data[<span class="string">"date"</span>].dt.isocalendar()[<span class="string">"week"</span>]</span><br><span class="line">data[<span class="string">"day"</span>] = data[<span class="string">"date"</span>].dt.dayofweek</span><br><span class="line">data.index = <span class="built_in">range</span>(<span class="built_in">len</span>(data))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    <span class="keyword">if</span> data.loc[i, <span class="string">"week"</span>] &gt; <span class="number">1</span>:</span><br><span class="line">        data.loc[i, <span class="string">"week"</span>] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">data = data.pivot(index=<span class="string">"day"</span>, columns=<span class="string">"week"</span>, values=<span class="string">"Count"</span>)</span><br><span class="line">data.index = [<span class="string">"Mon"</span>, <span class="string">"Tue"</span>, <span class="string">"Wed"</span>, <span class="string">"Thu"</span>, <span class="string">"Fri"</span>, <span class="string">"Sat"</span>, <span class="string">"Sun"</span>]</span><br><span class="line">data.columns = pd.date_range(start=wStart, end=wEnd, freq=<span class="string">"W-MON"</span>).strftime(<span class="string">"%m-%d"</span>)</span><br><span class="line"></span><br><span class="line">ax = sns.heatmap(</span><br><span class="line">    data,</span><br><span class="line">    annot=<span class="literal">False</span>,</span><br><span class="line">    linewidths=<span class="number">0.5</span>,</span><br><span class="line">    cbar_kws={<span class="string">"orientation"</span>: <span class="string">"vertical"</span>, <span class="string">"location"</span>: <span class="string">"left"</span>, <span class="string">"pad"</span>: <span class="number">0.03</span>},</span><br><span class="line">    cmap=<span class="string">"Reds"</span>,</span><br><span class="line">)</span><br><span class="line">ax.set_xlabel(<span class="string">"Week"</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">"Weekday"</span>)</span><br><span class="line">ax.figure.set_size_inches(<span class="number">24</span>, <span class="number">4</span>)</span><br><span class="line">ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></tbody></table></figure><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/02/01/65bb155505c24.png" alt="图7 按日划分年度活跃分析" style="height:250px;"></div><span class="image-caption">图 7 按日划分年度活跃分析</span></div><h2 id="词语分析">词语分析 <a class="header-anchor" href="#词语分析">¶</a></h2><h3 id="分词词典、停止词与去除词性">分词词典、停止词与去除词性 <a class="header-anchor" href="#分词词典、停止词与去除词性">¶</a></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jieba.load_userdict(<span class="string">"thuocl.txt"</span>)</span><br><span class="line">jieba.load_userdict(<span class="string">"userdict.txt"</span>)</span><br><span class="line">stopwords = [line.strip() <span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">open</span>(<span class="string">"stopwords.txt"</span>, <span class="string">"r"</span>).readlines()] + [<span class="string">" "</span>, <span class="string">"\n"</span>, <span class="string">"\r\n"</span>]</span><br><span class="line">wordclass = [<span class="string">"v"</span>, <span class="string">"u"</span>, <span class="string">"vd"</span>, <span class="string">"r"</span>, <span class="string">"p"</span>, <span class="string">"w"</span>]</span><br></pre></td></tr></tbody></table></figure><h3 id="分词函数">分词函数 <a class="header-anchor" href="#分词函数">¶</a></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">wordSplit</span>(<span class="params">texts, wordclass</span>):</span><br><span class="line">    words = []</span><br><span class="line">    pbar = tqdm(total=<span class="built_in">len</span>(texts))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(texts)):</span><br><span class="line">        res = pseg.lcut(texts[i])</span><br><span class="line">        <span class="keyword">for</span> pair <span class="keyword">in</span> res:</span><br><span class="line">            <span class="keyword">if</span> pair.word <span class="keyword">in</span> stopwords:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> pair.flag <span class="keyword">in</span> wordclass:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            words.append(pair.word)</span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">1000</span> == <span class="number">0</span>:</span><br><span class="line">            pbar.update(<span class="number">1000</span>)</span><br><span class="line">    pbar.close()</span><br><span class="line">    <span class="keyword">return</span> words</span><br><span class="line"></span><br><span class="line">words = [wordSplit(texts[i], wordclass) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br></pre></td></tr></tbody></table></figure><h3 id="词云绘制">词云绘制 <a class="header-anchor" href="#词云绘制">¶</a></h3><ul><li><code>mask</code>: 词云的蒙版，影响词云的形状</li><li><code>cmap</code>: 色阶 </li></ul><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">mask = np.array(Image.<span class="built_in">open</span>(<span class="string">"mask.png"</span>))</span><br><span class="line">masks = [np.array(Image.<span class="built_in">open</span>(<span class="string">"mask_L.jpg"</span>)), np.array(Image.<span class="built_in">open</span>(<span class="string">"mask_F.jpg"</span>))]</span><br><span class="line">cmap = ListedColormap(</span><br><span class="line">    [</span><br><span class="line">        <span class="string">"#fac1cf"</span>,</span><br><span class="line">        <span class="string">"#a9d7ba"</span>,</span><br><span class="line">        <span class="string">"#58b1db"</span>,</span><br><span class="line">        <span class="string">"#f296ab"</span>,</span><br><span class="line">        <span class="string">"#5dab81"</span>,</span><br><span class="line">        <span class="string">"#3d9ec4"</span>,</span><br><span class="line">        <span class="string">"#e16a8d"</span>,</span><br><span class="line">        <span class="string">"#237b50"</span>,</span><br><span class="line">        <span class="string">"#1e8299"</span>,</span><br><span class="line">        <span class="string">"#8d3549"</span>,</span><br><span class="line">        <span class="string">"#35563b"</span>,</span><br><span class="line">        <span class="string">"#2d5d73"</span>,</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">wordCloud</span>(<span class="params">text, font, mask, cmap</span>):</span><br><span class="line">    wc = WordCloud(</span><br><span class="line">        background_color=<span class="string">"white"</span>,</span><br><span class="line">        scale=<span class="number">5</span>,</span><br><span class="line">        font_path=font,</span><br><span class="line">        mask=mask,</span><br><span class="line">        colormap=cmap,</span><br><span class="line">        collocations=<span class="literal">False</span>,</span><br><span class="line">    ).generate(text)</span><br><span class="line">    plt.imshow(wc)</span><br><span class="line">    plt.axis(<span class="string">"off"</span>)</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line">wordCloud(<span class="string">" "</span>.join(words[<span class="number">0</span>] + words[<span class="number">1</span>]), font, mask, cmap)</span><br></pre></td></tr></tbody></table></figure><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/02/01/65bb17047a719.png" alt="图8 词云图" style="height:300px;"></div><span class="image-caption">图 8 词云图</span></div><h3 id="高频词排行">高频词排行 <a class="header-anchor" href="#高频词排行">¶</a></h3><p>列出常用的 N 个词，并且展示双方的贡献</p><ul><li><code>wN</code>: 词的数目，默认为 50</li></ul><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">wN = <span class="number">50</span></span><br><span class="line"></span><br><span class="line">data = pd.DataFrame(</span><br><span class="line">    {</span><br><span class="line">        <span class="string">"words"</span>: words[<span class="number">0</span>] + words[<span class="number">1</span>],</span><br><span class="line">        <span class="string">"L"</span>: [<span class="number">1</span>] * <span class="built_in">len</span>(words[<span class="number">0</span>]) + [<span class="number">0</span>] * <span class="built_in">len</span>(words[<span class="number">1</span>]),</span><br><span class="line">        <span class="string">"F"</span>: [<span class="number">0</span>] * <span class="built_in">len</span>(words[<span class="number">0</span>]) + [<span class="number">1</span>] * <span class="built_in">len</span>(words[<span class="number">1</span>]),</span><br><span class="line">        <span class="string">"S"</span>: [<span class="number">1</span>] * <span class="built_in">len</span>(words[<span class="number">0</span>]) + [<span class="number">1</span>] * <span class="built_in">len</span>(words[<span class="number">1</span>]),</span><br><span class="line">    }</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">grouper = pd.Grouper(key=<span class="string">"words"</span>)</span><br><span class="line">data = data.groupby(grouper).<span class="built_in">sum</span>()</span><br><span class="line">data = data.sort_values(by=<span class="string">"S"</span>, ascending=<span class="literal">False</span>)</span><br><span class="line">data = data.iloc[:wN]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将部分无法识别的 emoji 转化为文字</span></span><br><span class="line">tmp = data.index.to_list()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(wN):</span><br><span class="line">    <span class="keyword">if</span> tmp[i] == <span class="string">"😘"</span>:</span><br><span class="line">        tmp[i] = <span class="string">"[亲亲]"</span></span><br><span class="line">    <span class="keyword">elif</span> tmp[i] == <span class="string">"😂"</span>:</span><br><span class="line">        tmp[i] = <span class="string">"[笑哭]"</span></span><br><span class="line">    <span class="keyword">elif</span> tmp[i] == <span class="string">"🤦"</span>:</span><br><span class="line">        tmp[i] = <span class="string">"[捂脸]"</span></span><br><span class="line">    <span class="keyword">elif</span> tmp[i] == <span class="string">"😁"</span>:</span><br><span class="line">        tmp[i] = <span class="string">"[呲牙]"</span></span><br><span class="line">data.index = tmp</span><br><span class="line"></span><br><span class="line">ratio = data[<span class="string">"L"</span>] / data[<span class="string">"S"</span>]</span><br><span class="line">norm = plt.Normalize(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">sm = plt.cm.ScalarMappable(cmap=<span class="string">"coolwarm"</span>, norm=norm)</span><br><span class="line"></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">10</span>, <span class="number">10</span>), dpi=<span class="number">300</span>)</span><br><span class="line">grid = plt.GridSpec(<span class="number">1</span>, <span class="number">4</span>, wspace=<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">ax0 = fig.add_subplot(grid[<span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">sns.barplot(x=-data[<span class="string">"L"</span>], y=data.index, ax=ax0, hue=ratio, hue_norm=norm, palette=<span class="string">"coolwarm"</span>)</span><br><span class="line">ax1 = fig.add_subplot(grid[<span class="number">0</span>, <span class="number">1</span>:])</span><br><span class="line">sns.barplot(x=data[<span class="string">"F"</span>], y=data.index, ax=ax1, hue=(<span class="number">1</span> - ratio), hue_norm=norm, palette=<span class="string">"coolwarm"</span>)</span><br><span class="line"></span><br><span class="line">ax0.set_xlabel(<span class="string">"词频"</span>)</span><br><span class="line">ax0.set_ylabel(<span class="string">""</span>)</span><br><span class="line">ax0.set_xticks(<span class="built_in">range</span>(-<span class="number">400</span>, <span class="number">1</span>, <span class="number">200</span>))</span><br><span class="line">ax0.set_xticklabels([<span class="number">400</span>, <span class="number">200</span>, <span class="number">0</span>])</span><br><span class="line">ax0.set_xlim(-<span class="number">400</span>, <span class="number">0</span>)</span><br><span class="line">ax0.set_yticks([])</span><br><span class="line">ax0.spines[<span class="string">"left"</span>].set_visible(<span class="literal">False</span>)</span><br><span class="line">ax0.spines[<span class="string">"top"</span>].set_visible(<span class="literal">False</span>)</span><br><span class="line">ax0.spines[<span class="string">"right"</span>].set_visible(<span class="literal">False</span>)</span><br><span class="line">ax0.set_title(<span class="string">"LL"</span>)</span><br><span class="line">ax0.get_legend().remove()</span><br><span class="line"></span><br><span class="line">ax1.set_xlabel(<span class="string">"词频"</span>)</span><br><span class="line">ax1.set_ylabel(<span class="string">""</span>)</span><br><span class="line">ax1.set_xticks(<span class="built_in">range</span>(<span class="number">0</span>, <span class="number">1201</span>, <span class="number">200</span>))</span><br><span class="line">ax1.set_xticklabels([<span class="number">0</span>, <span class="number">200</span>, <span class="number">400</span>, <span class="number">600</span>, <span class="number">800</span>, <span class="number">1000</span>, <span class="number">1200</span>])</span><br><span class="line">ax1.set_xlim(<span class="number">0</span>, <span class="number">1200</span>)</span><br><span class="line">ax1.set_yticks([])</span><br><span class="line">ax1.spines[<span class="string">"left"</span>].set_visible(<span class="literal">False</span>)</span><br><span class="line">ax1.spines[<span class="string">"top"</span>].set_visible(<span class="literal">False</span>)</span><br><span class="line">ax1.spines[<span class="string">"right"</span>].set_visible(<span class="literal">False</span>)</span><br><span class="line">ax1.set_title(<span class="string">"FF"</span>)</span><br><span class="line">ax1.get_legend().remove()</span><br><span class="line"></span><br><span class="line">axpos = ax1.get_position()</span><br><span class="line">caxpos = mtransforms.Bbox.from_extents(axpos.x0 + <span class="number">0.06</span>, axpos.y0 + <span class="number">0.03</span>, axpos.x1, axpos.y0 + <span class="number">0.04</span>)</span><br><span class="line">cax = ax1.figure.add_axes(caxpos)</span><br><span class="line"></span><br><span class="line">locator = mticker.MultipleLocator(<span class="number">0.1</span>)</span><br><span class="line">formatter = mticker.StrMethodFormatter(<span class="string">"{x:.1f}"</span>)</span><br><span class="line">cax.figure.colorbar(sm, cax=cax, orientation=<span class="string">"horizontal"</span>, ticks=locator, <span class="built_in">format</span>=formatter)</span><br><span class="line">cax.set_title(<span class="string">"ratio"</span>)</span><br><span class="line"></span><br><span class="line">x0 = ax0.get_position().x1</span><br><span class="line">x1 = ax1.get_position().x0</span><br><span class="line">xm = (x0 + x1) / <span class="number">2</span></span><br><span class="line">y0 = ax0.get_position().y0</span><br><span class="line">y1 = ax0.get_position().y1</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(wN):</span><br><span class="line">    fig.text(</span><br><span class="line">        xm, y0 + (y1 - y0) * (wN - i - <span class="number">0.5</span>) / wN, data.index[i],</span><br><span class="line">        color=<span class="string">"black"</span>, ha=<span class="string">"center"</span>, va=<span class="string">"center"</span>, fontproperties=fp</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">fig.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></tbody></table></figure><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/02/01/65bb17553fc6f.png" alt="图9 高频词排行"></div><span class="image-caption">图 9 高频词排行</span></div><h2 id="情感分析">情感分析 <a class="header-anchor" href="#情感分析">¶</a></h2><p>使用 <code>paddlenlp</code> 进行情感分析，得到的分数在 [-1, 1] 之间，越小越消极，越大越积极</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dfE = df.query(<span class="string">"Type == 1"</span>)[[<span class="string">"IsSender"</span>, <span class="string">"StrContent"</span>, <span class="string">"StrTime"</span>, <span class="string">"hour"</span>]]</span><br><span class="line">dfE.index = <span class="built_in">range</span>(<span class="built_in">len</span>(dfE))</span><br><span class="line"></span><br><span class="line">senta = Taskflow(<span class="string">"sentiment_analysis"</span>)</span><br><span class="line">scores = pd.DataFrame(senta([textFilter(i) <span class="keyword">for</span> i <span class="keyword">in</span> dfE[<span class="string">"StrContent"</span>].to_list()]))</span><br><span class="line">scores.loc[scores[<span class="string">"label"</span>] == <span class="string">"negative"</span>, <span class="string">"score"</span>] = <span class="number">1</span> - scores.loc[scores[<span class="string">"label"</span>] == <span class="string">"negative"</span>, <span class="string">"score"</span>]</span><br><span class="line"></span><br><span class="line">dfE[<span class="string">"score"</span>] = scores[<span class="string">"score"</span>]</span><br><span class="line">dfE[<span class="string">"score"</span>] = <span class="number">2</span> * dfE[<span class="string">"score"</span>] - <span class="number">1</span></span><br><span class="line">dfE[<span class="string">"Person"</span>] = dfE.apply(<span class="keyword">lambda</span> x: labels[x[<span class="string">"IsSender"</span>]], axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dfEs = [dfE.query(<span class="string">"IsSender == 0"</span>), dfE.query(<span class="string">"IsSender == 1"</span>)]</span><br></pre></td></tr></tbody></table></figure><h3 id="年度总体情感分布">年度总体情感分布 <a class="header-anchor" href="#年度总体情感分布">¶</a></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ax = sns.histplot(data=dfE, x=<span class="string">"score"</span>, hue=<span class="string">"Person"</span>, palette=<span class="string">"dark"</span>, alpha=<span class="number">0.6</span>, bins=<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">ax.set_xlabel(<span class="string">"Sentiment Score"</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">"Count"</span>)</span><br><span class="line">ax.set_title(<span class="string">"Sentiment Distribution"</span>)</span><br><span class="line">ax.set_xlim(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">ax.figure.set_size_inches(<span class="number">8</span>, <span class="number">3</span>)</span><br><span class="line">ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/02/01/65bb17b7df694.png" alt="图10 年度总体情感分布" style="height:300px;"></div><span class="image-caption">图 10 年度总体情感分布</span></div><h3 id="按周统计平均情感指数">按周统计平均情感指数 <a class="header-anchor" href="#按周统计平均情感指数">¶</a></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">weekAvgSenScore</span>(<span class="params">df</span>):</span><br><span class="line">    grouper = pd.Grouper(key=<span class="string">"StrTime"</span>, freq=<span class="string">"W-MON"</span>)</span><br><span class="line">    data = df.groupby(grouper)[<span class="string">"score"</span>].mean().to_frame()</span><br><span class="line">    data.index = pd.date_range(start=wStart, end=wEnd, freq=<span class="string">"W-MON"</span>).strftime(<span class="string">"%m-%d"</span>)</span><br><span class="line">    data.columns = [<span class="string">"score"</span>]</span><br><span class="line"></span><br><span class="line">    vM = data[<span class="string">"score"</span>].<span class="built_in">abs</span>().<span class="built_in">max</span>()</span><br><span class="line">    norm = plt.Normalize(-vM, vM)</span><br><span class="line">    sm = plt.cm.ScalarMappable(cmap=<span class="string">"coolwarm"</span>, norm=norm)</span><br><span class="line"></span><br><span class="line">    ax = sns.barplot(x=data.index, y=data[<span class="string">"score"</span>], hue=data[<span class="string">"score"</span>], hue_norm=norm, palette=<span class="string">"coolwarm"</span>)</span><br><span class="line">    ax.set_xlabel(<span class="string">"Date"</span>)</span><br><span class="line">    plt.xticks(rotation=<span class="number">60</span>)</span><br><span class="line">    <span class="keyword">for</span> bar <span class="keyword">in</span> ax.containers:</span><br><span class="line">        ax.bar_label(bar, fontsize=<span class="number">10</span>, fmt=<span class="string">"%.2f"</span>)</span><br><span class="line">    ax.get_legend().remove()</span><br><span class="line"></span><br><span class="line">    axpos = ax.get_position()</span><br><span class="line">    caxpos = mtransforms.Bbox.from_extents(axpos.x1 + <span class="number">0.02</span>, axpos.y0, axpos.x1 + <span class="number">0.03</span>, axpos.y1)</span><br><span class="line">    cax = ax.figure.add_axes(caxpos)</span><br><span class="line"></span><br><span class="line">    locator = mticker.MultipleLocator(<span class="number">0.05</span>)</span><br><span class="line">    formatter = mticker.StrMethodFormatter(<span class="string">"{x:.2f}"</span>)</span><br><span class="line">    cax.figure.colorbar(sm, cax=cax, ticks=locator, <span class="built_in">format</span>=formatter)</span><br><span class="line"></span><br><span class="line">    ax.figure.set_size_inches(<span class="number">20</span>, <span class="number">8</span>)</span><br><span class="line">    ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">    plt.show()</span><br><span class="line">    plt.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> data[<span class="string">"score"</span>]</span><br><span class="line"></span><br><span class="line">avgSenScore0 = weekAvgSenScore(dfEs[<span class="number">0</span>])</span><br><span class="line">avgSenScore1 = weekAvgSenScore(dfEs[<span class="number">1</span>])</span><br><span class="line">_ = weekAvgSenScore(dfE)</span><br></pre></td></tr></tbody></table></figure><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/02/01/65bb180c8a248.png" alt="图11 按周统计平均情感指数" style="height:300px;"></div><span class="image-caption">图 11 按周统计平均情感指数</span></div><h3 id="平均情感指数变化折线图">平均情感指数变化折线图 <a class="header-anchor" href="#平均情感指数变化折线图">¶</a></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ax = sns.lineplot(data=avgSenScore0, linewidth=<span class="number">3</span>, marker=<span class="string">"s"</span>, markersize=<span class="number">15</span>, label=labels[<span class="number">0</span>])</span><br><span class="line">ax = sns.lineplot(data=avgSenScore1, linewidth=<span class="number">3</span>, marker=<span class="string">"^"</span>, markersize=<span class="number">15</span>, ax=ax, label=labels[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">ax.set_xlabel(<span class="string">"Date"</span>)</span><br><span class="line">plt.xticks(rotation=<span class="number">60</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">"Average Sentiment Score"</span>)</span><br><span class="line">ax.set_xlim(<span class="number">0</span>, <span class="number">52</span>)</span><br><span class="line">ax.legend(prop={<span class="string">"size"</span>: <span class="number">24</span>})</span><br><span class="line"></span><br><span class="line">ax.figure.set_size_inches(<span class="number">20</span>, <span class="number">8</span>)</span><br><span class="line">ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></tbody></table></figure><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/02/01/65bb185144ea8.png" alt="图12 平均变化折线图" style="height:300px;"></div><span class="image-caption">图 12 平均变化折线图</span></div><h3 id="按周统计累计情感指数">按周统计累计情感指数 <a class="header-anchor" href="#按周统计累计情感指数">¶</a></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">weekTotSenScore</span>(<span class="params">df</span>):</span><br><span class="line">    grouper = pd.Grouper(key=<span class="string">"StrTime"</span>, freq=<span class="string">"W-MON"</span>)</span><br><span class="line">    data = df.groupby(grouper)[<span class="string">"score"</span>].<span class="built_in">sum</span>().to_frame()</span><br><span class="line">    data.index = pd.date_range(start=wStart, end=wEnd, freq=<span class="string">"W-MON"</span>).strftime(<span class="string">"%m-%d"</span>)</span><br><span class="line">    data.columns = [<span class="string">"score"</span>]</span><br><span class="line"></span><br><span class="line">    vM = data[<span class="string">"score"</span>].<span class="built_in">abs</span>().<span class="built_in">max</span>()</span><br><span class="line">    norm = plt.Normalize(-vM, vM)</span><br><span class="line">    sm = plt.cm.ScalarMappable(cmap=<span class="string">"coolwarm"</span>, norm=norm)</span><br><span class="line"></span><br><span class="line">    ax = sns.barplot(x=data.index, y=data[<span class="string">"score"</span>], hue=data[<span class="string">"score"</span>], hue_norm=norm, palette=<span class="string">"coolwarm"</span>)</span><br><span class="line">    ax.set_xlabel(<span class="string">"Date"</span>)</span><br><span class="line">    plt.xticks(rotation=<span class="number">60</span>)</span><br><span class="line">    <span class="keyword">for</span> bar <span class="keyword">in</span> ax.containers:</span><br><span class="line">        ax.bar_label(bar, fontsize=<span class="number">10</span>, fmt=<span class="string">"%.2f"</span>)</span><br><span class="line">    ax.get_legend().remove()</span><br><span class="line"></span><br><span class="line">    axpos = ax.get_position()</span><br><span class="line">    caxpos = mtransforms.Bbox.from_extents(axpos.x1 + <span class="number">0.02</span>, axpos.y0, axpos.x1 + <span class="number">0.03</span>, axpos.y1)</span><br><span class="line">    cax = ax.figure.add_axes(caxpos)</span><br><span class="line"></span><br><span class="line">    locator = mticker.MultipleLocator(<span class="number">20</span>)</span><br><span class="line">    formatter = mticker.StrMethodFormatter(<span class="string">"{x:.2f}"</span>)</span><br><span class="line">    cax.figure.colorbar(sm, cax=cax, ticks=locator, <span class="built_in">format</span>=formatter)</span><br><span class="line"></span><br><span class="line">    ax.figure.set_size_inches(<span class="number">20</span>, <span class="number">8</span>)</span><br><span class="line">    ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">    plt.show()</span><br><span class="line">    plt.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> data[<span class="string">"score"</span>]</span><br><span class="line"></span><br><span class="line">totSenScore0 = weekTotSenScore(dfEs[<span class="number">0</span>])</span><br><span class="line">totSenScore1 = weekTotSenScore(dfEs[<span class="number">1</span>])</span><br><span class="line">_ = weekTotSenScore(dfE)</span><br></pre></td></tr></tbody></table></figure><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/02/01/65bb188b7e6c1.png" alt="图13 按周统计累计情感指数" style="height:300px;"></div><span class="image-caption">图 13 按周统计累计情感指数</span></div><h3 id="累计情感指数变化折线图">累计情感指数变化折线图 <a class="header-anchor" href="#累计情感指数变化折线图">¶</a></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ax = sns.lineplot(data=totSenScore0, linewidth=<span class="number">3</span>, marker=<span class="string">"s"</span>, markersize=<span class="number">15</span>, label=labels[<span class="number">0</span>])</span><br><span class="line">ax = sns.lineplot(data=totSenScore1, linewidth=<span class="number">3</span>, marker=<span class="string">"^"</span>, markersize=<span class="number">15</span>, ax=ax, label=labels[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">ax.set_xlabel(<span class="string">"Date"</span>)</span><br><span class="line">plt.xticks(rotation=<span class="number">60</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">"Total Sentiment Score"</span>)</span><br><span class="line">ax.set_xlim(<span class="number">0</span>, <span class="number">52</span>)</span><br><span class="line">ax.legend(prop={<span class="string">"size"</span>: <span class="number">24</span>})</span><br><span class="line"></span><br><span class="line">ax.figure.set_size_inches(<span class="number">20</span>, <span class="number">8</span>)</span><br><span class="line">ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></tbody></table></figure><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/02/01/65bb18bf41a2b.png" alt="图14 累计变化折线图" style="height:300px;"></div><span class="image-caption">图 14 累计变化折线图</span></div><h3 id="每日平均情感分析">每日平均情感分析 <a class="header-anchor" href="#每日平均情感分析">¶</a></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">grouper = pd.Grouper(key=<span class="string">"hour"</span>)</span><br><span class="line"></span><br><span class="line">data = []</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    tmp = dfEs[k].groupby(grouper)[<span class="string">"score"</span>].mean().sort_index()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">24</span>):</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> tmp.index:</span><br><span class="line">            data.append(tmp[i])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            data.append(<span class="number">0</span>)</span><br><span class="line">    data.append(<span class="number">0</span>)</span><br><span class="line">data = pd.DataFrame(</span><br><span class="line">    {</span><br><span class="line">        <span class="string">"Score"</span>: data,</span><br><span class="line">        <span class="string">"Person"</span>: [labels[<span class="number">0</span>]] * <span class="number">25</span> + [labels[<span class="number">1</span>]] * <span class="number">25</span>,</span><br><span class="line">    }</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">xBins = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">25</span>)]</span><br><span class="line">ax = sns.histplot(</span><br><span class="line">    data=data,</span><br><span class="line">    x=xBins * <span class="number">2</span>,</span><br><span class="line">    bins=xBins,</span><br><span class="line">    weights=<span class="string">"Score"</span>,</span><br><span class="line">    hue=<span class="string">"Person"</span>,</span><br><span class="line">    multiple=multiple,</span><br><span class="line">    edgecolor=<span class="string">".3"</span>,</span><br><span class="line">    linewidth=<span class="number">0.5</span>,</span><br><span class="line">    palette=<span class="string">"dark"</span>,</span><br><span class="line">    alpha=<span class="number">0.6</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">ax.set_xticks(<span class="built_in">range</span>(<span class="number">25</span>))</span><br><span class="line">ax.set_xticklabels(<span class="built_in">range</span>(<span class="number">25</span>))</span><br><span class="line">ax.set_xlabel(<span class="string">"Hour"</span>)</span><br><span class="line">ax.set_xlim(<span class="number">0</span>, <span class="number">24</span>)</span><br><span class="line">ax.set_ylim(np.<span class="built_in">min</span>([<span class="number">0</span>, np.floor(data[<span class="string">"Score"</span>].<span class="built_in">min</span>() / <span class="number">0.05</span>) * <span class="number">0.05</span>]), np.ceil(data[<span class="string">"Score"</span>].<span class="built_in">max</span>() / <span class="number">0.05</span>) * <span class="number">0.05</span>)</span><br><span class="line">sns.move_legend(ax, loc=<span class="string">"upper center"</span>, bbox_to_anchor=(<span class="number">0.5</span>, <span class="number">1.2</span>), ncol=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">ax.figure.set_size_inches(<span class="number">8</span>, <span class="number">4</span>)</span><br><span class="line">ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></tbody></table></figure><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/02/01/65bb190954b05.png" alt="图15 每日平均情感分析" style="height:300px;"></div><span class="image-caption">图 15 每日平均情感分析</span></div><h3 id="每日累计情感分析">每日累计情感分析 <a class="header-anchor" href="#每日累计情感分析">¶</a></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">grouper = pd.Grouper(key=<span class="string">"hour"</span>)</span><br><span class="line"></span><br><span class="line">data = []</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    tmp = dfEs[k].groupby(grouper)[<span class="string">"score"</span>].<span class="built_in">sum</span>().sort_index()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">24</span>):</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> tmp.index:</span><br><span class="line">            data.append(tmp[i])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            data.append(<span class="number">0</span>)</span><br><span class="line">    data.append(<span class="number">0</span>)</span><br><span class="line">data = pd.DataFrame(</span><br><span class="line">    {</span><br><span class="line">        <span class="string">"Score"</span>: data,</span><br><span class="line">        <span class="string">"Person"</span>: [labels[<span class="number">0</span>]] * <span class="number">25</span> + [labels[<span class="number">1</span>]] * <span class="number">25</span>,</span><br><span class="line">    }</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">xBins = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">25</span>)]</span><br><span class="line">ax = sns.histplot(</span><br><span class="line">    data=data,</span><br><span class="line">    x=xBins * <span class="number">2</span>,</span><br><span class="line">    bins=xBins,</span><br><span class="line">    weights=<span class="string">"Score"</span>,</span><br><span class="line">    hue=<span class="string">"Person"</span>,</span><br><span class="line">    multiple=multiple,</span><br><span class="line">    edgecolor=<span class="string">".3"</span>,</span><br><span class="line">    linewidth=<span class="number">0.5</span>,</span><br><span class="line">    palette=<span class="string">"dark"</span>,</span><br><span class="line">    alpha=<span class="number">0.6</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">ax.set_xticks(<span class="built_in">range</span>(<span class="number">25</span>))</span><br><span class="line">ax.set_xticklabels(<span class="built_in">range</span>(<span class="number">25</span>))</span><br><span class="line">ax.set_xlabel(<span class="string">"Hour"</span>)</span><br><span class="line">ax.set_xlim(<span class="number">0</span>, <span class="number">24</span>)</span><br><span class="line">ax.set_ylim(np.<span class="built_in">min</span>([<span class="number">0</span>, np.floor(data[<span class="string">"Score"</span>].<span class="built_in">min</span>() / <span class="number">0.05</span>) * <span class="number">0.05</span>]), np.ceil(data[<span class="string">"Score"</span>].<span class="built_in">max</span>() / <span class="number">0.05</span>) * <span class="number">0.05</span>)</span><br><span class="line">sns.move_legend(ax, loc=<span class="string">"upper center"</span>, bbox_to_anchor=(<span class="number">0.5</span>, <span class="number">1.2</span>), ncol=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">ax.figure.set_size_inches(<span class="number">8</span>, <span class="number">4</span>)</span><br><span class="line">ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></tbody></table></figure><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/02/01/65bb1931b4174.png" alt="图16 每日累计情感分析" style="height:300px;"></div><span class="image-caption">图 16 每日累计情感分析</span></div><h2 id="工具">工具 <a class="header-anchor" href="#工具">¶</a></h2><ol><li><a href="https://github.com/LC044/WeChatMsg">WeChatMsg</a></li><li><a href="https://github.com/PaddlePaddle/PaddleNLP">PaddleNLP</a></li><li><a href="http://thuocl.thunlp.org/">THUOCL：清华大学开放中文词库</a></li><li><a href="https://github.com/goto456/stopwords">中文常用停用词表</a></li><li><a href="https://github.com/fxsjy/jieba">jieba 中文分词</a></li></ol><h2 id="参考资料">参考资料 <a class="header-anchor" href="#参考资料">¶</a></h2><ol><li><a href="https://github.com/saturn-opposition/wechat_analysis">wechat_analysis</a></li><li><a href="http://xhslink.com/oC4OHA">Python 制作日历图｜可视化聊天记录</a></li><li><a href="http://xhslink.com/ZNdPHA">1 年的聊天记录写成论文作为老婆生日礼物</a></li><li><a href="http://xhslink.com/KqhPHA">当我把和男朋友两年半的聊天记录可视化</a></li><li><a href="http://xhslink.com/IOkPHA">90 万人看过的聊天记录可视化第二弹来啦</a></li><li><a href="https://stackoverflow.com/questions/49761221/make-seaborn-show-a-colorbar-instead-of-a-legend-when-using-hue-in-a-bar-plot">Make seaborn show a colorbar instead of a legend when using hue in a bar plot?</a></li><li><a href="https://zhajiman.github.io/post/matplotlib_colorbar/">Matplotlib 系列：colorbar 的设置</a></li><li><a href="https://blog.csdn.net/sinat_32570141/article/details/113048947">matplotlib 绘图之坐标变换</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;note danger flat&quot;&gt;&lt;p&gt;&lt;strong&gt;评论不填写邮箱，将收不到回复通知&lt;/strong&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;note warning flat&quot;&gt;&lt;p&gt;&lt;strong&gt;多图预警&lt;/strong&gt;&lt;/p&gt;
&lt;/</summary>
      
    
    
    
    <category term="软件/程序" scheme="https://foolishfox.cn/categories/%E8%BD%AF%E4%BB%B6-%E7%A8%8B%E5%BA%8F/"/>
    
    
    <category term="Python" scheme="https://foolishfox.cn/tags/Python/"/>
    
    <category term="教程" scheme="https://foolishfox.cn/tags/%E6%95%99%E7%A8%8B/"/>
    
    <category term="Jupyter" scheme="https://foolishfox.cn/tags/Jupyter/"/>
    
    <category term="微信" scheme="https://foolishfox.cn/tags/%E5%BE%AE%E4%BF%A1/"/>
    
    <category term="聊天记录" scheme="https://foolishfox.cn/tags/%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>排版工具 Typst 教程与 Snippets</title>
    <link href="https://foolishfox.cn/posts/202401-typst.html"/>
    <id>https://foolishfox.cn/posts/202401-typst.html</id>
    <published>2024-01-04T04:36:34.000Z</published>
    <updated>2024-01-04T04:36:34.000Z</updated>
    
    <content type="html"><![CDATA[<div class="note info flat"><p>个人的自用模板代码可以查看 <a href="https://git.foolishfox.cn/fox/Typst-Snippets">Typst-Snippets</a></p></div><p>Typst 是 2019 年才出现的使用 Rust 编写的基于标记的排版语言，定位在 Markdown、Word 等初级工具和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.89883em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.68333em;"><span style="top:-2.904999em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.46782999999999997em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span> 一类的高级工具之间，官方宣称其功能可以和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.89883em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.68333em;"><span style="top:-2.904999em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.46782999999999997em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span> 一样强大，但是和 Markdown 一样简单、易用，主要应用于数学、物理和工程方面（特别是包含大量公式、图表）的论文、文章、作业、书籍和报告的编写。</p><h2 id="基础教程">基础教程 <a class="header-anchor" href="#基础教程">¶</a></h2><p>MacOS 和 Arch Linux 用户可以使用包管理器进行安装：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># macOS or Linux using Homebrew</span></span><br><span class="line">brew install typst</span><br><span class="line"></span><br><span class="line"><span class="comment"># Arch Linux</span></span><br><span class="line">pacman -S typst</span><br></pre></td></tr></tbody></table></figure><p>具体支持的发行版本可以查看 <a href="#refer-5">参考资料 (5)</a>。Ubuntu 目前还只能下载编译好的二进制文件，或者安装 Rust 后从源码编译进行安装。除此之外，还需要安装编辑器的插件实现代码提示、预览等功能，VS Code 上的主要插件有：</p><ul><li><a href="https://marketplace.visualstudio.com/items?itemName=nvarner.typst-lsp">Typst LSP</a></li><li><a href="https://marketplace.visualstudio.com/items?itemName=mgt19937.typst-preview">Typst Preview</a></li></ul><p>除此之外，还有 <a href="https://marketplace.visualstudio.com/items?itemName=OrangeX4.vscode-typst-sympy-calculator">Typst Sympy Calculator</a> 插件实现了和 Python 的 SymPy 库的联动，可以进行公式的转化和计算。</p><p>对于从 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.89883em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.68333em;"><span style="top:-2.904999em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.46782999999999997em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span> 和 Markdown 迁移过来的用户，绝大部分语法内容都可以新学习，比较重要的区别有：</p><ol><li>公式中命令不需要 <code>\</code> 开头，直接使用即可，例如使用 <code>$e^(pi eta)$</code> 显示 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>e</mi><mrow><mi>π</mi><mi>η</mi></mrow></msup></mrow><annotation encoding="application/x-tex">e^{\pi\eta}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.664392em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">π</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">η</span></span></span></span></span></span></span></span></span></span></span></span>，要在公式中显示成段的，不是命令的字符，可以使用 <code>"</code> 包裹起来。更具体而言，Typst 区分两种模式：「标记模式」和「代码模式」，前者是正常的文本模式，类似于 Markdown 的编写逻辑，后者以 <code>#</code> 开头，在该模式内的命令省略 <code>#</code>（个人认为，公式是一种特殊的代码模式，命令在公式中也可以省略 <code>#</code>）</li><li>函数定义要求函数名 + 括号，参数可以是位置参数或者命名参数，格式为 <code>myfunc(keya: valuea, keyb: valueb)</code></li><li>Typst 的代码模式十分强大，通过 <code>#if</code> 条件判断和 <code>#for</code> 循环语句，可以实现 <a href="#refer-7">参考资料 (7)</a> 中的效果：</li></ol><!-- autoplay="autoplay" loop="loop"  --><p><video src="https://asset.foolishfox.cn/2024/01/04/typst.mp4" controls="controls" style="max-width: 100%;display: block;margin: auto;max-height: 400px;">your browser does not support the video tag</video></p><p>具体的内容可以查看 <a href="#refer-3">参考资料 (3)</a>，入门的教程可以查看 <a href="#refer-2">参考资料 (2)</a>，一些 Typst、Markdown 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.89883em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.68333em;"><span style="top:-2.904999em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.46782999999999997em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span> 之间的对比可以查看 <a href="#refer-7">参考资料 (7)</a></p><h2 id="常用代码">常用代码 <a class="header-anchor" href="#常用代码">¶</a></h2><h3 id="官方模组">官方模组 <a class="header-anchor" href="#官方模组">¶</a></h3><p>目前官方收录的模组可以在 <a href="https://typst.app/docs/packages/">Typst Packages</a> 进行查询，此外还有 <a href="https://github.com/qjcg/awesome-typst">Awesome Typst</a> 项目收录了很多实用了模组，下面列举了部分常用的模组，一些我进行了自定义的模组将会在 (<a href="#自定义模板">下一小节</a>) 进行介绍。</p><ol><li><a href="https://github.com/OrangeX4/typst-pinit">Pinit</a> 包用于创建批注，在制作 slides 的时候特别有用，效果如下：</li></ol><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/01/04/65966b17c1a87.png" alt="Pinit" style="height:300px;"></div><span class="image-caption">Pinit</span></div><ol start="2"><li><a href="https://github.com/Leedehai/typst-physics">Physics</a> 实现了向量、场、微分、导数、狄拉克符号等物理中常用符合的定义：</li></ol><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/01/04/65966bb4944a9.png" alt="Physics" style="height:300px;"></div><span class="image-caption">Physics</span></div><ol start="3"><li><a href="https://github.com/Pablo-Gonzalez-Calderon/showybox-package">Showybox</a> 可以创建自定义的彩色盒，可以用于定义、定理等场景：</li></ol><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/01/04/65966cd4b1d0f.png" alt="Showybox" style="height:200px;"></div><span class="image-caption">Showybox</span></div><ol start="4"><li><a href="https://github.com/PgBiel/typst-tablex">Tablex</a> 实现了高级的表格：</li></ol><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/01/04/65966d37a9441.png" alt="Tablex" style="height:300px;"></div><span class="image-caption">Tablex</span></div><ol start="5"><li><a href="https://github.com/flavio20002/typst-orange-template">Typst orange template</a> 使用 Typst 实现了 <a href="https://www.latextemplates.com/template/legrand-orange-book">Legrand Orange Book</a>：</li></ol><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/01/05/6596e1628f3d8.png" alt="Typst orange template" style="height:300px;"></div><span class="image-caption">Typst orange template</span></div><ol start="6"><li><a href="https://github.com/RubixDev/typst-i-figured">i-figured</a> 实现了图表、公式的按章节编号，参见 (<a href="#论文">论文</a>)</li></ol><h3 id="自定义模板">自定义模板 <a class="header-anchor" href="#自定义模板">¶</a></h3><h4 id="幻灯片">幻灯片 <a class="header-anchor" href="#幻灯片">¶</a></h4><p><a href="https://github.com/qjcg/awesome-typst">Awesome Typst</a> 中推荐的幻灯片模板中，个人推荐使用 <a href="https://github.com/andreasKroepelin/polylux">Polylux</a> 模板，提供了多种主题，目前我常用的是 [University] 主题，并进行了一定的修改。</p><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/01/04/65966f57d4f07.png" alt="封面" style="height:300px;"></div><span class="image-caption">封面</span></div><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/01/04/65966f5838ad1.png" alt="目录" style="height:300px;"></div><span class="image-caption">目录</span></div><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/01/04/65966f589ecad.png" alt="分栏" style="height:300px;"></div><span class="image-caption">分栏</span></div><ul><li>给分栏页加入页眉和页脚 </li></ul><figure class="highlight typst"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="keyword">#</span><span class="keyword">let</span> <span class="title function_">matrix-slide</span><span class="punctuation">(</span>  <span class="variable">title</span><span class="punctuation">:</span> <span class="keyword">none</span><span class="punctuation">,</span>  <span class="variable">new-section</span><span class="punctuation">:</span> <span class="keyword">none</span><span class="punctuation">,</span>  <span class="variable">columns</span><span class="punctuation">:</span> <span class="keyword">none</span><span class="punctuation">,</span>  <span class="variable">rows</span><span class="punctuation">:</span> <span class="keyword">none</span><span class="punctuation">,</span>  <span class="operator">..</span><span class="variable">bodies</span><span class="punctuation">)</span> <span class="operator">=</span> <span class="punctuation">{</span>  <span class="keyword">let</span> <span class="variable">header</span> <span class="operator">=</span> <span class="punctuation">{</span>    <span class="keyword">set</span> <span class="title function_">align</span><span class="punctuation">(</span><span class="variable">top</span><span class="punctuation">)</span>    <span class="title function_">grid</span><span class="punctuation">(</span><span class="variable">rows</span><span class="punctuation">:</span> <span class="punctuation">(</span><span class="keyword">auto</span><span class="punctuation">,</span> <span class="keyword">auto</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="variable">row-gutter</span><span class="punctuation">:</span> <span class="number">3mm</span><span class="punctuation">,</span> <span class="variable">progress-barline</span><span class="punctuation">,</span> <span class="title function_">header-text</span><span class="punctuation">(</span><span class="variable">title</span><span class="punctuation">:</span> <span class="variable">title</span><span class="punctuation">,</span> <span class="variable">new-section</span><span class="punctuation">:</span> <span class="variable">new-section</span><span class="punctuation">)</span><span class="punctuation">)</span>  <span class="punctuation">}</span>  <span class="keyword">let</span> <span class="variable">footer</span> <span class="operator">=</span> <span class="punctuation">{</span>    <span class="keyword">set</span> <span class="title function_">text</span><span class="punctuation">(</span><span class="variable">size</span><span class="punctuation">:</span> <span class="number">10pt</span><span class="punctuation">)</span>    <span class="keyword">set</span> <span class="title function_">align</span><span class="punctuation">(</span><span class="variable">center</span> <span class="operator">+</span> <span class="variable">bottom</span><span class="punctuation">)</span>    <span class="keyword">let</span> <span class="title function_">cell</span><span class="punctuation">(</span><span class="variable">fill</span><span class="punctuation">:</span> <span class="keyword">none</span><span class="punctuation">,</span> <span class="variable">it</span><span class="punctuation">)</span> <span class="operator">=</span> <span class="title function_">rect</span><span class="punctuation">(</span>      <span class="variable">width</span><span class="punctuation">:</span> <span class="number">100%</span><span class="punctuation">,</span> <span class="variable">height</span><span class="punctuation">:</span> <span class="number">100%</span><span class="punctuation">,</span> <span class="variable">inset</span><span class="punctuation">:</span> <span class="number">1mm</span><span class="punctuation">,</span> <span class="variable">outset</span><span class="punctuation">:</span> <span class="number">0mm</span><span class="punctuation">,</span> <span class="variable">fill</span><span class="punctuation">:</span> <span class="variable">fill</span><span class="punctuation">,</span> <span class="variable">stroke</span><span class="punctuation">:</span> <span class="keyword">none</span><span class="punctuation">,</span>      <span class="title function_">align</span><span class="punctuation">(</span><span class="variable">horizon</span><span class="punctuation">,</span> <span class="title function_">text</span><span class="punctuation">(</span><span class="variable">fill</span><span class="punctuation">:</span> <span class="variable">white</span><span class="punctuation">,</span> <span class="variable">it</span><span class="punctuation">)</span><span class="punctuation">)</span>    <span class="punctuation">)</span>    <span class="title function_">locate</span><span class="punctuation">(</span> <span class="variable">loc</span> <span class="operator">=&gt;</span> <span class="punctuation">{</span>      <span class="keyword">let</span> <span class="variable">colors</span> <span class="operator">=</span> <span class="variable">uni</span><span class="operator">.</span><span class="variable">uni-colors</span><span class="operator">.</span><span class="title function_">at</span><span class="punctuation">(</span><span class="variable">loc</span><span class="punctuation">)</span>      <span class="keyword">show</span><span class="punctuation">:</span> <span class="variable">block</span><span class="operator">.</span><span class="title function_">with</span><span class="punctuation">(</span><span class="variable">width</span><span class="punctuation">:</span> <span class="number">100%</span><span class="punctuation">,</span> <span class="variable">height</span><span class="punctuation">:</span> <span class="keyword">auto</span><span class="punctuation">,</span> <span class="variable">fill</span><span class="punctuation">:</span> <span class="variable">colors</span><span class="operator">.</span><span class="variable">b</span><span class="punctuation">)</span>      <span class="title function_">grid</span><span class="punctuation">(</span>        <span class="variable">columns</span><span class="punctuation">:</span> <span class="punctuation">(</span><span class="number">25%</span><span class="punctuation">,</span> <span class="number">1fr</span><span class="punctuation">,</span> <span class="number">15%</span><span class="punctuation">,</span> <span class="number">10%</span><span class="punctuation">)</span><span class="punctuation">,</span>        <span class="variable">rows</span><span class="punctuation">:</span> <span class="punctuation">(</span><span class="number">1.5em</span><span class="punctuation">,</span> <span class="keyword">auto</span><span class="punctuation">)</span><span class="punctuation">,</span>        <span class="title function_">cell</span><span class="punctuation">(</span><span class="variable">fill</span><span class="punctuation">:</span> <span class="variable">colors</span><span class="operator">.</span><span class="variable">a</span><span class="punctuation">,</span> <span class="variable">uni</span><span class="operator">.</span><span class="variable">uni-short-author</span><span class="operator">.</span><span class="title function_">display</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span>        <span class="title function_">cell</span><span class="punctuation">(</span><span class="variable">uni</span><span class="operator">.</span><span class="variable">uni-short-title</span><span class="operator">.</span><span class="title function_">display</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span>        <span class="title function_">cell</span><span class="punctuation">(</span><span class="variable">uni</span><span class="operator">.</span><span class="variable">uni-short-date</span><span class="operator">.</span><span class="title function_">display</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span>        <span class="title function_">cell</span><span class="punctuation">(</span><span class="variable">logic</span><span class="operator">.</span><span class="variable">logical-slide</span><span class="operator">.</span><span class="title function_">display</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="punctuation">[</span><span class="char escape_">~</span>/<span class="char escape_">~</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="variable">utils</span><span class="operator">.</span><span class="variable">last-slide-number</span><span class="punctuation">)</span>      <span class="punctuation">)</span>    <span class="punctuation">}</span><span class="punctuation">)</span>  <span class="punctuation">}</span>  <span class="keyword">set</span> <span class="title function_">page</span><span class="punctuation">(</span>    <span class="variable">margin</span><span class="punctuation">:</span> <span class="punctuation">(</span> <span class="variable">top</span><span class="punctuation">:</span> <span class="number">2em</span><span class="punctuation">,</span> <span class="variable">bottom</span><span class="punctuation">:</span> <span class="number">1em</span><span class="punctuation">,</span> <span class="variable">x</span><span class="punctuation">:</span> <span class="number">0em</span> <span class="punctuation">)</span><span class="punctuation">,</span>    <span class="variable">header</span><span class="punctuation">:</span> <span class="variable">header</span><span class="punctuation">,</span>    <span class="variable">footer</span><span class="punctuation">:</span> <span class="variable">footer</span><span class="punctuation">,</span><span class="keyword"></span>    <span class="variable">footer-descent</span><span class="punctuation">:</span> <span class="number">0em</span><span class="punctuation">,</span>    <span class="variable">header-ascent</span><span class="punctuation">:</span> <span class="number">.6em</span><span class="punctuation">,</span>  <span class="punctuation">)</span>  <span class="variable">uni</span><span class="operator">.</span><span class="title function_">matrix-slide</span><span class="punctuation">(</span><span class="operator">..</span><span class="variable">bodies</span><span class="punctuation">)</span><span class="punctuation">}</span></pre></td></tr></tbody></table></figure><ul><li>添加目录页 </li></ul><figure class="highlight typst"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="keyword">#</span><span class="keyword">let</span> <span class="title function_">slide-outline-length</span><span class="punctuation">(</span><span class="variable">loc</span><span class="punctuation">)</span> <span class="operator">=</span> <span class="punctuation">{</span>  <span class="keyword">let</span> <span class="variable">section-state</span> <span class="operator">=</span> <span class="title function_">state</span><span class="punctuation">(</span><span class="string">"polylux-sections"</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span>  <span class="keyword">let</span> <span class="variable">sections</span> <span class="operator">=</span> <span class="variable">section-state</span><span class="operator">.</span><span class="title function_">final</span><span class="punctuation">(</span><span class="variable">loc</span><span class="punctuation">)</span>  <span class="variable">sections</span><span class="operator">.</span><span class="title function_">len</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">}</span><span class="keyword">#</span><span class="keyword">let</span> <span class="title function_">slide-outline</span><span class="punctuation">(</span><span class="variable">num</span><span class="punctuation">)</span> <span class="operator">=</span> <span class="punctuation">{</span>  <span class="keyword">set</span> <span class="title function_">text</span><span class="punctuation">(</span><span class="variable">font</span><span class="punctuation">:</span> <span class="string">"Cascadia Mono"</span><span class="punctuation">)</span>  <span class="title function_">locate</span><span class="punctuation">(</span><span class="variable">loc</span> <span class="operator">=&gt;</span> <span class="punctuation">{</span>    <span class="keyword">let</span> <span class="variable">section-state</span> <span class="operator">=</span> <span class="title function_">state</span><span class="punctuation">(</span><span class="string">"polylux-sections"</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span>    <span class="keyword">let</span> <span class="variable">sections</span> <span class="operator">=</span> <span class="variable">section-state</span><span class="operator">.</span><span class="title function_">final</span><span class="punctuation">(</span><span class="variable">loc</span><span class="punctuation">)</span>    <span class="keyword">for</span> <span class="variable">p</span> <span class="keyword">in</span> <span class="title function_">range</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="variable">num</span><span class="punctuation">)</span> <span class="punctuation">{</span>      <span class="keyword">let</span> <span class="variable">section</span> <span class="operator">=</span> <span class="variable">sections</span><span class="operator">.</span><span class="title function_">at</span><span class="punctuation">(</span><span class="variable">p</span><span class="punctuation">)</span>      <span class="keyword">let</span> <span class="variable">content</span> <span class="operator">=</span> <span class="punctuation">{</span>        <span class="keyword">let</span> <span class="variable">url</span> <span class="operator">=</span> <span class="title function_">link</span><span class="punctuation">(</span><span class="variable">section</span><span class="operator">.</span><span class="variable">loc</span><span class="punctuation">,</span> <span class="variable">section</span><span class="operator">.</span><span class="variable">body</span><span class="punctuation">)</span>        <span class="keyword">let</span> <span class="variable">page</span> <span class="operator">=</span> <span class="variable">logic</span><span class="operator">.</span><span class="variable">logical-slide</span><span class="operator">.</span><span class="title function_">at</span><span class="punctuation">(</span><span class="variable">section</span><span class="operator">.</span><span class="variable">loc</span><span class="punctuation">)</span><span class="operator">.</span><span class="title function_">at</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">)</span>        <span class="keyword">let</span> <span class="variable">length</span> <span class="operator">=</span> <span class="number">46</span> <span class="operator">-</span> <span class="title function_">str</span><span class="punctuation">(</span><span class="variable">page</span><span class="punctuation">)</span><span class="operator">.</span><span class="title function_">len</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">-</span> <span class="title function_">count-length</span><span class="punctuation">(</span><span class="variable">section</span><span class="operator">.</span><span class="variable">body</span><span class="punctuation">)</span>        <span class="keyword">let</span> <span class="variable">dots</span> <span class="operator">=</span> <span class="string">" "</span> <span class="operator">+</span> <span class="string">"."</span> * <span class="title function_">length</span>        <span class="punctuation">[</span><span class="title function_">#</span><span class="title function_">grid</span><span class="punctuation">(</span>          <span class="variable">columns</span><span class="punctuation">:</span> <span class="punctuation">(</span><span class="keyword">auto</span><span class="punctuation">,</span> <span class="number">1fr</span><span class="punctuation">,</span> <span class="number">1fr</span><span class="punctuation">)</span><span class="punctuation">,</span>          <span class="variable">url</span><span class="punctuation">,</span> <span class="title function_">align</span><span class="punctuation">[</span><span class="variable">#</span><span class="variable">dots</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="title function_">align</span><span class="punctuation">(</span><span class="variable">right</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="variable">#</span><span class="variable">page</span><span class="punctuation">]</span>        <span class="punctuation">)</span><span class="punctuation">]</span>      <span class="punctuation">}</span>      <span class="punctuation">[</span><span class="bullet">+</span> <span class="variable">#</span><span class="variable">content</span> <span class="punctuation">]</span>    <span class="punctuation">}</span>  <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">}</span></pre></td></tr></tbody></table></figure><h4 id="论文">论文 <a class="header-anchor" href="#论文">¶</a></h4><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/01/05/6596e1cb96028.png" alt="LaPreprint" style="height:400px;"></div><span class="image-caption">LaPreprint</span></div><p><a href="https://github.com/LaPreprint/typst">LaPreprint</a> 是一个很美观的预印本模板，主要适用于英文，为了适应一些中文的需求，个人做出了一些修改：</p><ul><li>增加目录与语言选项 </li></ul><figure class="highlight typst"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="keyword">#</span><span class="keyword">let</span> <span class="title function_">lapreprint</span><span class="punctuation">(</span>  <span class="comment">// ......</span>  <span class="comment">// The outline</span>  <span class="variable">outline-show</span><span class="punctuation">:</span> <span class="literal">true</span><span class="punctuation">,</span>  <span class="variable">outline-depth</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span>  <span class="comment">// Language of the document</span>  <span class="variable">lang</span><span class="punctuation">:</span> <span class="string">"en"</span><span class="punctuation">,</span>  <span class="comment">// The paper's content.</span>  <span class="variable">body</span><span class="punctuation">)</span> <span class="operator">=</span> <span class="punctuation">{</span>  <span class="comment">// ......</span>  <span class="keyword">if</span> <span class="punctuation">(</span><span class="variable">outline-show</span><span class="punctuation">)</span> <span class="punctuation">{</span><span class="title function_">outline</span><span class="punctuation">(</span>    <span class="variable">title</span><span class="punctuation">:</span> <span class="keyword">if</span> <span class="punctuation">(</span><span class="variable">lang</span> <span class="operator">==</span> <span class="string">"en"</span><span class="punctuation">)</span> <span class="punctuation">{</span><span class="string">"Content"</span><span class="punctuation">}</span> <span class="keyword">else</span> <span class="punctuation">{</span><span class="string">"目录"</span><span class="punctuation">}</span><span class="punctuation">,</span>    <span class="variable">indent</span><span class="punctuation">:</span> <span class="number">2em</span><span class="punctuation">,</span>    <span class="variable">depth</span><span class="punctuation">:</span> <span class="variable">outline-depth</span><span class="punctuation">,</span>  <span class="punctuation">)</span><span class="punctuation">}</span>  <span class="comment">// ......</span><span class="punctuation">}</span></pre></td></tr></tbody></table></figure><ul><li>修改页边距 </li></ul><figure class="highlight typst"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="comment">// 首页 &amp; 目录页</span><span class="title function_">#</span><span class="title function_">lapreprint</span><span class="punctuation">(</span>  <span class="keyword">set</span> <span class="title function_">page</span><span class="punctuation">(</span>    <span class="variable">paper-size</span><span class="punctuation">,</span>    <span class="variable">margin</span><span class="punctuation">:</span> <span class="punctuation">(</span><span class="variable">left</span><span class="punctuation">:</span> <span class="number">20%</span><span class="punctuation">,</span> <span class="variable">bottom</span><span class="punctuation">:</span> <span class="number">1.5cm</span><span class="punctuation">)</span><span class="punctuation">,</span>  <span class="punctuation">)</span><span class="punctuation">)</span><span class="comment">// 后续页</span><span class="title function_">#</span><span class="title function_">lapreprint</span><span class="punctuation">(</span>  <span class="keyword">set</span> <span class="title function_">page</span><span class="punctuation">(</span>    <span class="variable">paper-size</span><span class="punctuation">,</span>    <span class="variable">margin</span><span class="punctuation">:</span> <span class="punctuation">(</span><span class="variable">left</span><span class="punctuation">:</span> <span class="keyword">auto</span><span class="punctuation">,</span> <span class="variable">bottom</span><span class="punctuation">:</span> <span class="number">1.5cm</span><span class="punctuation">)</span><span class="punctuation">,</span>  <span class="punctuation">)</span><span class="punctuation">)</span></pre></td></tr></tbody></table></figure><ul><li>中文显示 </li></ul><figure class="highlight typst"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="title function_">#</span><span class="title function_">lapreprint</span><span class="punctuation">(</span>  <span class="keyword">set</span> <span class="title function_">page</span><span class="punctuation">(</span>    <span class="comment">// ......</span>    <span class="variable">footer</span><span class="punctuation">:</span> <span class="title function_">block</span><span class="punctuation">(</span>      <span class="comment">// ......</span>                <span class="keyword">if</span><span class="punctuation">(</span><span class="variable">date</span> <span class="operator">!=</span> <span class="keyword">none</span><span class="punctuation">)</span> <span class="punctuation">{</span>                  <span class="keyword">if</span> <span class="punctuation">(</span><span class="variable">lang</span> <span class="operator">==</span> <span class="string">"en"</span><span class="punctuation">)</span> <span class="punctuation">{</span>                    <span class="variable">date</span><span class="operator">.</span><span class="title function_">display</span><span class="punctuation">(</span><span class="string">"[month repr:short] [day], [year]"</span><span class="punctuation">)</span>                  <span class="punctuation">}</span> <span class="keyword">else</span> <span class="punctuation">{</span>                    <span class="punctuation">[</span><span class="variable">#</span><span class="variable">date</span><span class="operator">.</span><span class="title function_">year</span><span class="punctuation">(</span><span class="punctuation">)</span> 年 <span class="variable">#</span><span class="variable">date</span><span class="operator">.</span><span class="title function_">month</span><span class="punctuation">(</span><span class="punctuation">)</span> 月 <span class="variable">#</span><span class="variable">date</span><span class="operator">.</span><span class="title function_">day</span><span class="punctuation">(</span><span class="punctuation">)</span> 日<span class="punctuation">]</span>                  <span class="punctuation">}</span>                <span class="punctuation">}</span>      <span class="comment">// ......</span>    <span class="punctuation">)</span>  <span class="punctuation">)</span>  <span class="comment">// ......</span>  <span class="title function_">place</span><span class="punctuation">(</span>    <span class="comment">// ......</span>              <span class="keyword">if</span> <span class="punctuation">(</span><span class="variable">lang</span> <span class="operator">==</span> <span class="string">"en"</span><span class="punctuation">)</span> <span class="punctuation">{</span>                <span class="title function_">text</span><span class="punctuation">(</span><span class="variable">size</span><span class="punctuation">:</span> <span class="number">7pt</span><span class="punctuation">,</span> <span class="variable">d</span><span class="operator">.</span><span class="variable">date</span><span class="operator">.</span><span class="title function_">display</span><span class="punctuation">(</span><span class="string">"[month repr:short] [day], [year]"</span><span class="punctuation">)</span><span class="punctuation">)</span>              <span class="punctuation">}</span> <span class="keyword">else</span> <span class="punctuation">{</span><span class="punctuation">[</span>                <span class="keyword">#</span><span class="keyword">set</span> <span class="title function_">text</span><span class="punctuation">(</span><span class="number">7pt</span><span class="punctuation">)</span>                <span class="variable">#</span><span class="variable">d</span><span class="operator">.</span><span class="variable">date</span><span class="operator">.</span><span class="title function_">year</span><span class="punctuation">(</span><span class="punctuation">)</span>-<span class="variable">#</span><span class="variable">d</span><span class="operator">.</span><span class="variable">date</span><span class="operator">.</span><span class="title function_">month</span><span class="punctuation">(</span><span class="punctuation">)</span>-<span class="variable">#</span><span class="variable">d</span><span class="operator">.</span><span class="variable">date</span><span class="operator">.</span><span class="title function_">day</span><span class="punctuation">(</span><span class="punctuation">)</span>              <span class="punctuation">]</span><span class="punctuation">}</span>    <span class="comment">// ......</span>  <span class="punctuation">)</span>  <span class="comment">// ......</span>  <span class="keyword">if</span> <span class="variable">abstracts</span> <span class="operator">!=</span> <span class="keyword">none</span> <span class="punctuation">{</span>    <span class="comment">// ......</span>        <span class="keyword">if</span> <span class="punctuation">(</span><span class="variable">lang</span> <span class="operator">==</span> <span class="string">"en"</span><span class="punctuation">)</span> <span class="punctuation">{</span>          <span class="title function_">text</span><span class="punctuation">(</span><span class="variable">fill</span><span class="punctuation">:</span> <span class="variable">theme</span><span class="punctuation">,</span> <span class="variable">weight</span><span class="punctuation">:</span> <span class="string">"semibold"</span><span class="punctuation">,</span> <span class="string">"Keywords"</span><span class="punctuation">)</span>        <span class="punctuation">}</span> <span class="keyword">else</span> <span class="punctuation">{</span>          <span class="title function_">text</span><span class="punctuation">(</span><span class="variable">fill</span><span class="punctuation">:</span> <span class="variable">theme</span><span class="punctuation">,</span> <span class="variable">weight</span><span class="punctuation">:</span> <span class="string">"semibold"</span><span class="punctuation">,</span> <span class="string">"关键词"</span><span class="punctuation">)</span>        <span class="punctuation">}</span>    <span class="comment">// ......</span>  <span class="punctuation">}</span><span class="punctuation">)</span></pre></td></tr></tbody></table></figure><ul><li>图表、公式编号，按章节区分 </li></ul><figure class="highlight typst"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="title function_">#</span><span class="title function_">lapreprint</span><span class="punctuation">(</span>  <span class="comment">// Configure i-figured</span>  <span class="keyword">show</span> <span class="variable">figure</span><span class="punctuation">:</span> <span class="variable">i-figured</span><span class="operator">.</span><span class="variable">show-figure</span>  <span class="keyword">show</span> <span class="variable">figure</span><span class="operator">.</span><span class="title function_">where</span><span class="punctuation">(</span>    <span class="variable">kind</span><span class="punctuation">:</span> <span class="variable">table</span>  <span class="punctuation">)</span><span class="punctuation">:</span> <span class="keyword">set</span> <span class="variable">figure</span><span class="operator">.</span><span class="title function_">caption</span><span class="punctuation">(</span><span class="variable">position</span><span class="punctuation">:</span> <span class="variable">top</span><span class="punctuation">)</span>  <span class="keyword">show</span> <span class="variable">math</span><span class="operator">.</span><span class="variable">equation</span><span class="punctuation">:</span> <span class="variable">i-figured</span><span class="operator">.</span><span class="variable">show-equation</span><span class="punctuation">)</span></pre></td></tr></tbody></table></figure><ul><li>交叉引用 </li></ul><figure class="highlight typst"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="title function_">#</span><span class="title function_">lapreprint</span><span class="punctuation">(</span>  <span class="comment">// Configure Reference Link</span>  <span class="keyword">show</span> <span class="variable">link</span><span class="punctuation">:</span> <span class="variable">it</span> <span class="operator">=&gt;</span> <span class="punctuation">[</span><span class="title function_">#</span><span class="title function_">text</span><span class="punctuation">(</span><span class="variable">fill</span><span class="punctuation">:</span> <span class="variable">theme</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="variable">#</span><span class="variable">it</span><span class="punctuation">]</span><span class="punctuation">]</span>  <span class="keyword">show</span> <span class="variable">ref</span><span class="punctuation">:</span> <span class="variable">it</span> <span class="operator">=&gt;</span> <span class="punctuation">[</span><span class="title function_">#</span><span class="title function_">text</span><span class="punctuation">(</span><span class="variable">fill</span><span class="punctuation">:</span> <span class="variable">theme</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="variable">#</span><span class="variable">it</span><span class="punctuation">]</span><span class="punctuation">]</span>  <span class="keyword">show</span> <span class="variable">ref</span><span class="punctuation">:</span> <span class="variable">it</span> <span class="operator">=&gt;</span> <span class="punctuation">{</span>    <span class="keyword">let</span> <span class="variable">el</span> <span class="operator">=</span> <span class="variable">it</span><span class="operator">.</span><span class="variable">element</span>    <span class="keyword">if</span> <span class="punctuation">(</span><span class="variable">el</span> <span class="operator">!=</span> <span class="keyword">none</span><span class="punctuation">)</span> <span class="punctuation">{</span>      <span class="keyword">let</span> <span class="variable">fn</span> <span class="operator">=</span> <span class="title function_">repr</span><span class="punctuation">(</span><span class="variable">el</span><span class="operator">.</span><span class="title function_">func</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span>      <span class="keyword">if</span> <span class="punctuation">(</span><span class="variable">fn</span> <span class="operator">==</span> <span class="string">"equation"</span><span class="punctuation">)</span> <span class="punctuation">{</span><span class="title function_">link</span><span class="punctuation">(</span>        <span class="variable">it</span><span class="operator">.</span><span class="variable">target</span><span class="punctuation">,</span>        <span class="keyword">if</span> <span class="punctuation">(</span><span class="variable">lang</span> <span class="operator">==</span> <span class="string">"en"</span><span class="punctuation">)</span> <span class="punctuation">{</span><span class="string">"Eq."</span><span class="punctuation">}</span> <span class="keyword">else</span> <span class="punctuation">{</span><span class="string">"式 "</span><span class="punctuation">}</span> <span class="operator">+</span>         <span class="title function_">numbering</span><span class="punctuation">(</span>          <span class="variable">el</span><span class="operator">.</span><span class="variable">numbering</span><span class="punctuation">,</span>          <span class="operator">..</span><span class="title function_">counter</span><span class="punctuation">(</span><span class="variable">math</span><span class="operator">.</span><span class="variable">equation</span><span class="punctuation">)</span><span class="operator">.</span><span class="title function_">at</span><span class="punctuation">(</span><span class="variable">el</span><span class="operator">.</span><span class="title function_">location</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span>        <span class="punctuation">)</span>      <span class="punctuation">)</span><span class="punctuation">}</span> <span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span><span class="variable">fn</span> <span class="operator">==</span> <span class="string">"heading"</span><span class="punctuation">)</span> <span class="punctuation">{</span><span class="title function_">link</span><span class="punctuation">(</span>        <span class="variable">it</span><span class="operator">.</span><span class="variable">target</span><span class="punctuation">,</span>        <span class="keyword">if</span> <span class="punctuation">(</span><span class="variable">lang</span> <span class="operator">==</span> <span class="string">"en"</span><span class="punctuation">)</span> <span class="punctuation">{</span><span class="string">"Section "</span><span class="punctuation">}</span> <span class="keyword">else</span> <span class="punctuation">{</span><span class="string">"第 "</span><span class="punctuation">}</span> <span class="operator">+</span>         <span class="title function_">numbering</span><span class="punctuation">(</span>          <span class="variable">el</span><span class="operator">.</span><span class="variable">numbering</span><span class="punctuation">,</span>          <span class="operator">..</span><span class="title function_">counter</span><span class="punctuation">(</span><span class="variable">heading</span><span class="punctuation">)</span><span class="operator">.</span><span class="title function_">at</span><span class="punctuation">(</span><span class="variable">el</span><span class="operator">.</span><span class="title function_">location</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span>        <span class="punctuation">)</span> <span class="operator">+</span> <span class="keyword">if</span> <span class="punctuation">(</span><span class="variable">lang</span> <span class="operator">==</span> <span class="string">"zh"</span><span class="punctuation">)</span> <span class="punctuation">{</span><span class="string">" 节"</span><span class="punctuation">}</span>      <span class="punctuation">)</span><span class="punctuation">}</span>      <span class="keyword">else</span> <span class="punctuation">{</span> <span class="variable">it</span> <span class="punctuation">}</span>    <span class="punctuation">}</span> <span class="keyword">else</span> <span class="punctuation">{</span><span class="variable">it</span><span class="punctuation">}</span>  <span class="punctuation">}</span><span class="punctuation">)</span></pre></td></tr></tbody></table></figure><h4 id="其他">其他 <a class="header-anchor" href="#其他">¶</a></h4><ol><li> 借助 <a href="https://github.com/PgBiel/typst-tablex">Tablex</a> 可以实现三线表的样式：</li></ol><figure class="highlight typst"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="comment">// 定义</span><span class="keyword">#</span><span class="keyword">import</span> <span class="string">"@preview/tablex:0.0.6"</span><span class="punctuation">:</span> <span class="variable">tablex</span><span class="punctuation">,</span> <span class="variable">rowspanx</span><span class="punctuation">,</span> <span class="variable">colspanx</span><span class="punctuation">,</span> <span class="variable">hlinex</span><span class="punctuation">,</span> <span class="variable">vlinex</span><span class="keyword">#</span><span class="keyword">let</span> <span class="title function_">three-line-table</span><span class="punctuation">(</span><span class="variable">columns</span><span class="punctuation">,</span> <span class="variable">headers</span><span class="punctuation">,</span> <span class="variable">contents</span><span class="punctuation">,</span> <span class="variable">caption</span><span class="punctuation">,</span> <span class="variable">lang</span><span class="punctuation">:</span> <span class="string">"en"</span><span class="punctuation">,</span><span class="variable">rows</span><span class="punctuation">:</span> <span class="keyword">auto</span><span class="punctuation">)</span> <span class="operator">=</span> <span class="punctuation">{</span><span class="title function_">figure</span><span class="punctuation">(</span>  <span class="title function_">tablex</span><span class="punctuation">(</span>    <span class="variable">columns</span><span class="punctuation">:</span> <span class="variable">columns</span><span class="punctuation">,</span>    <span class="variable">rows</span><span class="punctuation">:</span> <span class="variable">rows</span><span class="punctuation">,</span>    <span class="variable">align</span><span class="punctuation">:</span> <span class="variable">center</span> <span class="operator">+</span> <span class="variable">horizon</span><span class="punctuation">,</span>    <span class="variable">auto-lines</span><span class="punctuation">:</span> <span class="literal">false</span><span class="punctuation">,</span>    <span class="variable">repeat-header</span><span class="punctuation">:</span> <span class="literal">true</span><span class="punctuation">,</span>    <span class="title function_">hlinex</span><span class="punctuation">(</span><span class="variable">stroke</span><span class="punctuation">:</span> <span class="number">1.5pt</span><span class="punctuation">)</span><span class="punctuation">,</span>    <span class="operator">..</span><span class="variable">headers</span><span class="punctuation">,</span>    <span class="title function_">hlinex</span><span class="punctuation">(</span><span class="variable">stroke</span><span class="punctuation">:</span> <span class="number">0.75pt</span><span class="punctuation">)</span><span class="punctuation">,</span>    <span class="operator">..</span><span class="variable">contents</span><span class="punctuation">,</span>    <span class="title function_">hlinex</span><span class="punctuation">(</span><span class="variable">stroke</span><span class="punctuation">:</span> <span class="number">1.5pt</span><span class="punctuation">)</span><span class="punctuation">,</span>  <span class="punctuation">)</span><span class="punctuation">,</span>  <span class="variable">kind</span><span class="punctuation">:</span> <span class="variable">table</span><span class="punctuation">,</span>  <span class="variable">supplement</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="keyword">#</span><span class="keyword">if</span> <span class="punctuation">(</span><span class="variable">lang</span> <span class="operator">==</span> <span class="string">"en"</span><span class="punctuation">)</span> <span class="punctuation">{</span><span class="string">"Table"</span><span class="punctuation">}</span> <span class="keyword">else</span> <span class="punctuation">{</span><span class="string">"表"</span><span class="punctuation">}</span><span class="punctuation">]</span><span class="punctuation">,</span>  <span class="variable">caption</span><span class="punctuation">:</span> <span class="variable">caption</span><span class="punctuation">,</span><span class="punctuation">)</span><span class="punctuation">}</span><span class="comment">// 使用</span><span class="title function_">#</span><span class="title function_">three-line-table</span><span class="punctuation">(</span>  <span class="number">2</span><span class="punctuation">,</span>  <span class="punctuation">(</span><span class="punctuation">[</span><span class="strong">*</span><span class="strong">参数</span><span class="strong">*</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="strong">*</span><span class="strong">结果</span><span class="strong">*</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span>  <span class="punctuation">(</span>    <span class="punctuation">[</span><span class="punctuation">$</span><span class="formula">sin</span><span class="formula">^</span><span class="formula">2</span><span class="formula">(</span><span class="formula">2</span><span class="formula"> </span><span class="formula">theta</span><span class="formula">_</span><span class="formula">(</span><span class="formula">12</span><span class="formula">)</span><span class="formula">)</span><span class="punctuation">$</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">$</span><span class="formula">0.857</span><span class="formula"> </span><span class="formula">pm</span><span class="formula"> </span><span class="formula">0.024</span><span class="punctuation">$</span><span class="punctuation">]</span><span class="punctuation">,</span>    <span class="punctuation">[</span><span class="punctuation">$</span><span class="formula">sin</span><span class="formula">^</span><span class="formula">2</span><span class="formula">(</span><span class="formula">2</span><span class="formula"> </span><span class="formula">theta</span><span class="formula">_</span><span class="formula">(</span><span class="formula">23</span><span class="formula">)</span><span class="formula">)</span><span class="punctuation">$</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">$</span><span class="formula">&gt;</span><span class="formula"> </span><span class="formula">0.95</span><span class="punctuation">$</span><span class="punctuation">]</span><span class="punctuation">,</span>    <span class="punctuation">[</span><span class="punctuation">$</span><span class="formula">sin</span><span class="formula">^</span><span class="formula">2</span><span class="formula">(</span><span class="formula">2</span><span class="formula"> </span><span class="formula">theta</span><span class="formula">_</span><span class="formula">(</span><span class="formula">13</span><span class="formula">)</span><span class="formula">)</span><span class="punctuation">$</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">$</span><span class="formula">0.098</span><span class="formula"> </span><span class="formula">pm</span><span class="formula"> </span><span class="formula">0.013</span><span class="punctuation">$</span><span class="punctuation">]</span><span class="punctuation">,</span>    <span class="punctuation">[</span><span class="punctuation">$</span><span class="formula">Delta</span><span class="formula">\m</span><span class="formula">_</span><span class="formula">(</span><span class="formula">12</span><span class="formula">)</span><span class="formula">^</span><span class="formula">2</span><span class="punctuation">$</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">$</span><span class="formula">(</span><span class="formula">7.50</span><span class="formula"> </span><span class="formula">pm</span><span class="formula"> </span><span class="formula">0.20</span><span class="formula">)</span><span class="formula"> </span><span class="formula">times</span><span class="formula"> </span><span class="formula">10</span><span class="formula">^</span><span class="formula">(</span><span class="formula">-</span><span class="formula">5</span><span class="formula">)</span><span class="formula"> </span><span class="formula">"eV"</span><span class="formula">^</span><span class="formula">2</span><span class="punctuation">$</span><span class="punctuation">]</span><span class="punctuation">,</span>    <span class="punctuation">[</span><span class="punctuation">$</span><span class="formula">Delta</span><span class="formula">\m</span><span class="formula">_</span><span class="formula">(</span><span class="formula">23</span><span class="formula">)</span><span class="formula">^</span><span class="formula">2</span><span class="punctuation">$</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">$</span><span class="formula">0.00232</span><span class="formula">_</span><span class="formula">(</span><span class="formula">-</span><span class="formula">0.00008</span><span class="formula">)</span><span class="formula">^</span><span class="formula">(</span><span class="formula">+</span><span class="formula">0.00012</span><span class="formula">)</span><span class="formula"> </span><span class="formula">"eV"</span><span class="formula">^</span><span class="formula">2</span><span class="punctuation">$</span><span class="punctuation">]</span><span class="punctuation">,</span>    <span class="punctuation">[</span><span class="punctuation">$</span><span class="formula">delta</span><span class="formula">\/</span><span class="formula">pi</span><span class="punctuation">$</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">$</span><span class="formula">1.35</span><span class="formula">_</span><span class="formula">(</span><span class="formula">-</span><span class="formula">0.43</span><span class="formula">)</span><span class="formula">^</span><span class="formula">(</span><span class="formula">+</span><span class="formula">0.64</span><span class="formula">)</span><span class="punctuation">$</span><span class="punctuation">]</span>  <span class="punctuation">)</span><span class="punctuation">,</span>  <span class="punctuation">[</span>中微子振荡参数测量结果<span class="title function_">#</span><span class="title function_">super</span><span class="punctuation">[</span><span class="variable">@zqw2015daya</span> <span class="variable">@zym2018daya</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="keyword"></span>  <span class="variable">lang</span><span class="punctuation">:</span> <span class="string">"zh"</span><span class="punctuation">,</span><span class="punctuation">)</span> <span class="variable">&lt;nu_para&gt;</span></pre></td></tr></tbody></table></figure><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/01/05/6596e6d81be91.png" alt="三线表" style="height:300px;"></div><span class="image-caption">三线表</span></div><ol start="2"><li>公式块 </li></ol><figure class="highlight typst"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="keyword">#</span><span class="keyword">let</span> <span class="title function_">box-quote</span><span class="punctuation">(</span><span class="variable">body</span><span class="punctuation">,</span> <span class="variable">width</span><span class="punctuation">:</span> <span class="number">100%</span><span class="punctuation">,</span> <span class="variable">inset</span><span class="punctuation">:</span> <span class="number">5pt</span><span class="punctuation">,</span> <span class="variable">outset</span><span class="punctuation">:</span> <span class="number">0pt</span><span class="punctuation">)</span> <span class="operator">=</span> <span class="punctuation">{</span><span class="title function_">block</span><span class="punctuation">(</span>  <span class="variable">fill</span><span class="punctuation">:</span> <span class="variable">green</span><span class="operator">.</span><span class="title function_">lighten</span><span class="punctuation">(</span><span class="number">80%</span><span class="punctuation">)</span><span class="punctuation">,</span>  <span class="variable">width</span><span class="punctuation">:</span> <span class="variable">width</span><span class="punctuation">,</span>  <span class="variable">inset</span><span class="punctuation">:</span> <span class="variable">inset</span><span class="punctuation">,</span>  <span class="variable">outset</span><span class="punctuation">:</span> <span class="variable">outset</span><span class="punctuation">,</span>  <span class="variable">radius</span><span class="punctuation">:</span> <span class="number">4pt</span><span class="punctuation">,</span>  <span class="variable">stroke</span><span class="punctuation">:</span> <span class="variable">green</span><span class="operator">.</span><span class="title function_">darken</span><span class="punctuation">(</span><span class="number">60%</span><span class="punctuation">)</span><span class="punctuation">,</span>  <span class="variable">breakable</span><span class="punctuation">:</span> <span class="literal">true</span><span class="punctuation">,</span>  <span class="variable">body</span><span class="punctuation">)</span><span class="punctuation">}</span><span class="comment">// 使用</span><span class="title function_">#</span><span class="title function_">box-quote</span><span class="punctuation">[</span><span class="punctuation">$</span><span class="formula"></span><span class="formula">P</span><span class="formula">_</span><span class="formula">(</span><span class="formula">nu</span><span class="formula">_</span><span class="formula">alpha</span><span class="formula"> </span><span class="formula">-&gt;</span><span class="formula"> </span><span class="formula">nu</span><span class="formula">_</span><span class="formula">beta</span><span class="formula">)</span><span class="formula"> </span><span class="formula">approx</span><span class="formula"> </span><span class="formula">sin</span><span class="formula">^</span><span class="formula">(</span><span class="formula">2</span><span class="formula">)</span><span class="formula">2</span><span class="formula">theta</span><span class="formula"> </span><span class="formula">sin</span><span class="formula">^</span><span class="formula">(</span><span class="formula">2</span><span class="formula">)</span><span class="formula">(</span><span class="formula">(</span><span class="formula">m</span><span class="formula">_</span><span class="formula">1</span><span class="formula">^</span><span class="formula">2</span><span class="formula">-</span><span class="formula">m</span><span class="formula">_</span><span class="formula">2</span><span class="formula">^</span><span class="formula">2</span><span class="formula">)</span><span class="formula">/</span><span class="formula">(</span><span class="formula">4</span><span class="formula">p</span><span class="formula">)</span><span class="formula">t</span><span class="formula">)</span><span class="formula"> </span><span class="formula">approx</span><span class="formula"> </span><span class="formula">sin</span><span class="formula">^</span><span class="formula">(</span><span class="formula">2</span><span class="formula">)</span><span class="formula">2</span><span class="formula">theta</span><span class="formula"> </span><span class="formula">sin</span><span class="formula">^</span><span class="formula">(</span><span class="formula">2</span><span class="formula">)</span><span class="formula">(</span><span class="formula">Delta</span><span class="formula">\m</span><span class="formula">^</span><span class="formula">2</span><span class="formula"> </span><span class="formula">L</span><span class="formula">/</span><span class="formula">(</span><span class="formula">4</span><span class="formula">E</span><span class="formula">)</span><span class="formula">)</span><span class="formula"></span><span class="punctuation">$</span> <span class="variable">&lt;2flavor_mix_4&gt;</span><span class="punctuation">]</span></pre></td></tr></tbody></table></figure><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/01/05/6596e74850568.png" alt="公式块" style="width:80%;"></div><span class="image-caption">公式块</span></div><ol start="3"><li>数学符号的简易别名 </li></ol><figure class="highlight typst"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="keyword">#</span><span class="keyword">import</span> <span class="string">"@preview/physica:0.9.0"</span> <span class="keyword">as</span> <span class="variable">ph</span><span class="keyword">#</span><span class="keyword">let</span> <span class="variable">sp</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="title function_">#</span><span class="title function_">h</span><span class="punctuation">(</span><span class="number">0.5em</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="keyword">#</span><span class="keyword">let</span> <span class="variable">pm</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="variable">#</span><span class="variable">sym</span><span class="operator">.</span><span class="variable">plus</span><span class="operator">.</span><span class="variable">minus</span><span class="punctuation">]</span><span class="keyword">#</span><span class="keyword">let</span> <span class="variable">le</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="variable">#</span><span class="variable">sym</span><span class="operator">.</span><span class="variable">lt</span><span class="operator">.</span><span class="variable">eq</span><span class="operator">.</span><span class="variable">slant</span><span class="punctuation">]</span><span class="keyword">#</span><span class="keyword">let</span> <span class="variable">ge</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="variable">#</span><span class="variable">sym</span><span class="operator">.</span><span class="variable">gt</span><span class="operator">.</span><span class="variable">eq</span><span class="operator">.</span><span class="variable">slant</span><span class="punctuation">]</span><span class="keyword">#</span><span class="keyword">let</span> <span class="variable">sim</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="variable">#</span><span class="variable">sym</span><span class="operator">.</span><span class="variable">tilde</span><span class="operator">.</span><span class="variable">op</span><span class="punctuation">]</span><span class="keyword">#</span><span class="keyword">let</span> <span class="variable">inf</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="variable">#</span><span class="variable">sym</span><span class="operator">.</span><span class="variable">infinity</span><span class="punctuation">]</span><span class="keyword">#</span><span class="keyword">let</span> <span class="title function_">rm</span><span class="punctuation">(</span><span class="variable">body</span><span class="punctuation">)</span> <span class="operator">=</span> <span class="punctuation">{</span><span class="variable">math</span><span class="operator">.</span><span class="title function_">upright</span><span class="punctuation">(</span><span class="variable">body</span><span class="punctuation">)</span><span class="punctuation">}</span><span class="keyword">#</span><span class="keyword">let</span> <span class="title function_">iso</span><span class="punctuation">(</span><span class="variable">b</span><span class="punctuation">,</span> <span class="variable">A</span><span class="punctuation">)</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="variable">#</span><span class="variable">ph</span><span class="operator">.</span><span class="title function_">isotope</span><span class="punctuation">(</span><span class="variable">b</span><span class="punctuation">,</span> <span class="variable">a</span><span class="punctuation">:</span> <span class="variable">A</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="keyword">#</span><span class="keyword">let</span> <span class="title function_">isoz</span><span class="punctuation">(</span><span class="variable">b</span><span class="punctuation">,</span> <span class="variable">A</span><span class="punctuation">,</span> <span class="variable">Z</span><span class="punctuation">)</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="variable">#</span><span class="variable">ph</span><span class="operator">.</span><span class="title function_">isotope</span><span class="punctuation">(</span><span class="variable">b</span><span class="punctuation">,</span> <span class="variable">a</span><span class="punctuation">:</span> <span class="variable">A</span><span class="punctuation">,</span> <span class="variable">z</span><span class="punctuation">:</span> <span class="variable">Z</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="comment">// 使用</span><span class="title function_">#</span><span class="title function_">box-quote</span><span class="punctuation">[</span><span class="punctuation">$</span><span class="formula"></span><span class="formula">1</span><span class="formula"> </span><span class="formula">pm</span><span class="formula"> </span><span class="formula">2</span><span class="formula"> </span><span class="formula">le</span><span class="formula"> </span><span class="formula">3</span><span class="formula"> </span><span class="formula">ge</span><span class="formula"> </span><span class="formula">4</span><span class="formula"> </span><span class="formula">sim</span><span class="formula"> </span><span class="formula">5</span><span class="formula"> </span><span class="formula">inf</span><span class="formula"> </span><span class="formula">6</span><span class="formula"> </span><span class="formula">sp</span><span class="formula"> </span><span class="formula">rm</span><span class="formula">(</span><span class="formula">A</span><span class="formula">\b</span><span class="formula">)</span><span class="formula"> </span><span class="formula">sp</span><span class="formula"> </span><span class="formula">7</span><span class="formula"> </span><span class="formula">sp</span><span class="formula"> </span><span class="formula">"Ab"</span><span class="formula"> </span><span class="formula">8</span><span class="formula"> </span><span class="formula">sp</span><span class="formula"> </span><span class="formula">iso</span><span class="formula">(</span><span class="formula">U</span><span class="formula">,</span><span class="formula"> </span><span class="formula">235</span><span class="formula">)</span><span class="formula"> </span><span class="formula">sp</span><span class="formula"> </span><span class="formula">9</span><span class="formula"> </span><span class="formula">sp</span><span class="formula"> </span><span class="formula">isoz</span><span class="formula">(</span><span class="formula">L</span><span class="formula">\i</span><span class="formula">,</span><span class="formula"> </span><span class="formula">7</span><span class="formula">,</span><span class="formula"> </span><span class="formula">3</span><span class="formula">)</span><span class="formula"></span><span class="punctuation">$</span><span class="punctuation">]</span></pre></td></tr></tbody></table></figure><div class="img-wrap"><div class="img-bg"><img class="lazyload lazyload-gif zooming" src="https://asset.foolishfox.cn/2024/01/05/6596e8661e0e6.png" alt="数学符号" style="width:80%;"></div><span class="image-caption">数学符号</span></div><h2 id="参考资料">参考资料 <a class="header-anchor" href="#参考资料">¶</a></h2><ol><li><span id="refer-1"><a href="https://github.com/typst/typst">Typst</a></span></li><li><span id="refer-2"><a href="https://typst.app/docs">Documentation</a></span></li><li><span id="refer-3"><a href="https://zhuanlan.zhihu.com/p/646119837">为 LaTeX 用户准备的 Typst 入门</a></span></li><li><span id="refer-4"><a href="https://www.el42.cc/posts/typst-tablex-usage/">Typst Tablex 简单教程</a></span></li><li><span id="refer-5"><a href="https://repology.org/project/typst/versions">Typst on Repology</a></span></li><li><span id="refer-6"><a href="https://typst-doc-cn.github.io/docs/chinese/">中文用户指南</a></span></li><li><span id="refer-7"><a href="https://zhuanlan.zhihu.com/p/618910802">Typst-"超越"LaTeX 的文档排版工具</a></span></li><li><span id="refer-8"><a href="https://sitandr.github.io/typst-examples-book/book/">Typst Examples Book</a></span></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;note info flat&quot;&gt;&lt;p&gt;个人的自用模板代码可以查看 &lt;a href=&quot;https://git.foolishfox.cn/fox/Typst-Snippets&quot;&gt;Typst-Snippets&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Typst 是</summary>
      
    
    
    
    <category term="软件/程序" scheme="https://foolishfox.cn/categories/%E8%BD%AF%E4%BB%B6-%E7%A8%8B%E5%BA%8F/"/>
    
    
    <category term="教程" scheme="https://foolishfox.cn/tags/%E6%95%99%E7%A8%8B/"/>
    
    <category term="typst" scheme="https://foolishfox.cn/tags/typst/"/>
    
  </entry>
  
</feed>
